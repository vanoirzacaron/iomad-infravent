{"version":3,"sources":["reports/studentengagement.js"],"names":["define","$","ajax","Notification","common","CFG","SELECTOR","PAGE","TABLE","FORMFILTER","COHORT","COURSE","INACTIVE","GROUP","SUMMARY","SEARCH","LENGTH","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","dataTable","filter","inactive","enrolment","dir","attr","flatpickr","PROMISES","GET_DATA","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","JSON","stringify","GET_SUMMARY_CARD_DATA","call","methodname","args","report","filters","initializeDatatable","statuses","concat","util","get_string","DataTable","paging","processing","serverSide","rowId","scrollCollapse","columnDefs","className","targets","orderable","columns","width","render","console","log","timeFormatter","dom","language","info","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","callback","settings","loader","show","val","cohort","course","group","length","search","start","order","done","response","hide","setTimeout","css","border-left","border-bottom","border-top","border-left-color","border-right-width","border-right","border-right-color","border-left-width","empty","fail","ex","exception","always","reloadFilter","types","reload","_init","updateTimeLabel","find","select2","on","parse","refreshSummarycard","mode","altInput","altFormat","dateFormat","maxDate","appendTo","get","onOpen","addClass","offset","left","parent","closest","onChange","onClose","removeClass","date","dateAlternate","replace","stringarr","split","startdate","enddate","direction","text-align","includes","html","clear","customDateSelected","text","allCourses","column","visible","value","draw","page","len","handleSearchInput","init","document","ready"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * All learner summary report page.\n *\n * @package     local_edwiserreports\n * @author      Yogesh Shirsath\n * @copyright   2022 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine('local_edwiserreports/reports/studentengagement', [\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'local_edwiserreports/common',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/select2',\n    'local_edwiserreports/flatpickr'\n], function(\n    $,\n    ajax,\n    Notification,\n    common,\n    CFG\n) {\n\n    /**\n     * Selector\n     */\n    var SELECTOR = {\n        PAGE: '#studentengagement',\n        TABLE: '#studentengagement table',\n        FORMFILTER: '#studentengagement .download-links [name=\"filter\"]',\n        COHORT: '#studentengagement .cohort-select',\n        COURSE: '#studentengagement .course-select',\n        INACTIVE: '#studentengagement .inactive-select',\n        GROUP: '#studentengagement .group-select',\n        SUMMARY: '#studentengagement .summary-card',\n        SEARCH: '#studentengagement .table-search-input input',\n        LENGTH: '#studentengagement .length-select',\n        DATE: '.edwiserreports-calendar',\n        DATEMENU: '.edwiserreports-calendar + .dropdown-menu',\n        DATEITEM: '.edwiserreports-calendar + .dropdown-menu .dropdown-item',\n        DATEPICKER: '.edwiserreports-calendar + .dropdown-menu .dropdown-calendar',\n        DATEPICKERINPUT: '.edwiserreports-calendar + .dropdown-menu .flatpickr',\n    };\n\n    /**\n     * Datatable object.\n     */\n    var dataTable = null;\n\n    /**\n     * Filter object.\n     */\n    var filter = {\n        inactive: 'all',\n        enrolment: 'all',\n        dir: $('html').attr('dir')\n    };\n\n    let flatpickr = null;\n\n    /**\n     * All promises.\n     */\n    var PROMISES = {\n        /**\n         * Get student engagement table data based on filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_DATA: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_studentengagement_table_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        },\n        /**\n         * Get summary card data.\n         *\n         * @param   {Integer}   courseid    Course id\n         * @param   {String}    cohortid   Cohort id all/id\n         * @param   {String}    groupid   group id all/id\n         * @returns {PROMISE}\n         */\n        GET_SUMMARY_CARD_DATA: function(filter) {\n            return ajax.call([{\n                methodname: 'local_edwiserreports_get_summary_card_data',\n                args: {\n                    report: \"\\\\local_edwiserreports\\\\blocks\\\\studentengagement\",\n                    filters: JSON.stringify(filter)\n                }\n            }], false)[0];\n        }\n\n    }\n\n    /**\n     * After Select Custom date get active users details.\n     */\n    function customDateSelected() {\n        let date = $(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n        let dateAlternate = $(SELECTOR.DATEPICKERINPUT).next().val().replace(\"to\", \"-\"); // d M Y format\n        // RTL support\n        // Split string in 2 parts\n        let stringarr = dateAlternate.split('-');\n        // Formating date for rtl\n        if(filter.dir == 'rtl'){\n            // format for rtl : yyyy mm dd\n            let startdate = stringarr[0].split(' ');\n            let enddate = stringarr[1].split(' ');\n\n            startdate = startdate[2] + ' ' + startdate[1] + ' ' + startdate[0];\n            enddate = enddate[3] + ' ' + enddate[2] + ' ' + enddate[1];\n            dateAlternate = enddate + '-' + startdate;\n\n            // Making direction ltr for date selector and aligning text to right\n            $(SELECTOR.DATE).css({'direction':'ltr','text-align': 'right'});\n            $(SELECTOR.DATEPICKERINPUT).css({'direction':'ltr','text-align': 'right'});\n        }\n\n        $(SELECTOR.DATEPICKERINPUT).next().val(dateAlternate);\n\n        /* If correct date is not selected then return false */\n        if (!date.includes(\" to \")) {\n            flatpickr.clear();\n            return;\n        }\n\n        // Set active class to custom date selector item.\n        $(SELECTOR.DATEITEM).removeClass('active');\n        $(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n        // Show custom date to dropdown button.\n        $(SELECTOR.DATE).html(dateAlternate);\n\n        filter.enrolment = date;\n\n         // Fetching summary card data here\n         PROMISES.GET_SUMMARY_CARD_DATA(filter)\n         .done(function(response) {\n             response = JSON.parse(response);\n             common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n             //     initializeDatatable();\n             });\n         });\n\n        //initializeDatatable();\n        if (dataTable === null) {\n            initializeDatatable();\n            return;\n        }\n        dataTable.ajax.reload();\n        common.updateTimeLabel(date);\n    }\n\n    /**\n     * Initialize datable.\n     */\n    function initializeDatatable() {\n        let statuses = [\n            `<span class=\"success-tag\">${M.util.get_string('active', 'local_edwiserreports')}</span>`,\n            `<span class=\"danger-tag\">${M.util.get_string('suspended', 'local_edwiserreports')}</span>`\n        ];\n\n        dataTable = $(SELECTOR.TABLE).DataTable({\n            paging: true,\n            processing: true,\n            serverSide: true,\n            rowId: 'DT_RowId',\n            scrollCollapse: true,\n            columnDefs: [\n\n                { className: \"fixed-column\", targets: 0 },\n                { className: \"text-left\", targets: [0, 1, 2] },\n                { orderable: true, targets: [0, 1, 2, 3] },\n                { className: \"text-center\", orderable: false, targets: \"_all\" }\n            ],\n            columns: [\n                { data: \"student\", width: \"12rem\" },\n                { data: \"email\" },\n                {\n                    data: \"status\",\n                    render: function(data) {\n                        return statuses[data];\n                    },\n                    width: \"4rem\"\n                },\n                { \n                    data: \"lastaccesson\",\n                    render: function(data) {\n                        console.log(data);\n                        return data;\n                        // return common.timeFormatter(data);\n                    },\n                    width: \"10rem\"\n                },\n                { data: \"enrolledcourses\", width: \"4rem\" },\n                { data: \"inprogresscourses\", width: \"10rem\" },\n                { data: \"completedcourses\", width: \"5rem\" },\n                { data: \"completionprogress\", width: \"6rem\" },\n                { data: \"totalgrade\", width: \"3rem\" },\n                {\n                    data: \"timespentonlms\",\n                    render: function(data) {\n                        return common.timeFormatter(data);\n                    },\n                    width: \"10rem\"\n                },\n                {\n                    data: \"timespentoncourse\",\n                    render: function(data) {\n                        return common.timeFormatter(data);\n                    },\n                    width: \"10rem\"\n                },\n                { data: \"activitiescompleted\", width: \"5rem\" },\n                { data: \"visitsoncourse\", width: \"10rem\" },\n                { data: \"completedassignments\", width: \"6rem\" },\n                { data: \"completedquizzes\", width: \"6rem\" },\n                { data: \"completedscorms\", width: \"6rem\" }\n            ],\n            dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n            language: {\n                info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                emptyTable: M.util.get_string('emptytable', 'local_edwiserreports'),\n                zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                paginate: {\n                    previous: \"&nbsp;\",\n                    next: \"&nbsp;\"\n                }\n            },\n            drawCallback: function() {\n                common.stylePaginationButton(this);\n            },\n            // eslint-disable-next-line no-unused-vars\n            ajax: function(data, callback, settings) {\n                common.loader.show(SELECTOR.PAGE);\n\n                // Updated export filter values.\n                $(SELECTOR.FORMFILTER).val(\n                    JSON.stringify({\n                        'cohort': $(SELECTOR.COHORT).val(),\n                        'course': $(SELECTOR.COURSE).val(),\n                        'group': $(SELECTOR.GROUP).val(),\n                        'inactive': $(SELECTOR.INACTIVE).val(),\n                        'enrolment': filter.enrolment,\n                        'dir': $('html').attr('dir')\n                    })\n                );\n\n                // Fetching data for table.\n                PROMISES.GET_DATA({\n                    'cohort': $(SELECTOR.COHORT).val(),\n                    'course': $(SELECTOR.COURSE).val(),\n                    'group': $(SELECTOR.GROUP).val(),\n                    'length': $(SELECTOR.LENGTH).val(),\n                    'inactive': $(SELECTOR.INACTIVE).val(),\n                    'enrolment': filter.enrolment,\n                    'search': $(SELECTOR.SEARCH).val(),\n                    'start': data.start,\n                    'order': data.order[0],\n                    'dir': filter.dir\n                }).done(function(response) {\n                    common.loader.hide(SELECTOR.PAGE);\n                    callback(response);\n\n                    // RTL support for arrows\n                    setTimeout(function(){\n                        \n                        var attr = $('html').attr('dir');\n                        // For some browsers, `attr` is undefined; for others,\n                        // `attr` is false.  Check for both.\n                        if (typeof attr !== 'undefined' && attr !== false && attr == 'rtl') {\n                            $('.edwiserreports-table .page-item.next a:before').css({'border-left': '11px solid transparent', 'border-bottom': '6px solid transparent','border-top': '6px solid transparent','border-left-color': '#ccc','border-right-width': '0px'});\n                            $('.edwiserreports-table .page-item.previous a:before').css({'border-bottom': '6px solid transparent','border-top': '6px solid transparent','border-right':' 10px solid transparent','border-right-color': '#ccc','border-left-width': '0px'});\n                        }\n                    }, 1000);\n\n                    $('.edwiserreports-table .page-item.next a').empty();\n                    $('.edwiserreports-table .page-item.previous a').empty();\n\n                }).fail(function(ex) {\n                    Notification.exception(ex);\n                }).always(function() {\n                    common.loader.hide(SELECTOR.PAGE);\n                });\n            }\n        });\n    }\n\n    /**\n     * Reload filters.\n     */\n    function reloadFilter(types, cohort, course, group) {\n        common.loader.show(SELECTOR.PAGE);\n        common.reloadFilter(\n            SELECTOR.PAGE,\n            types,\n            cohort,\n            course,\n            group,\n            function() {\n                if (dataTable === null) {\n                    initializeDatatable();\n                    return;\n                }\n                dataTable.ajax.reload();\n            });\n    }\n\n    /**\n     * Initialize\n     */\n    function init() {\n\n        // Show time period in table info.\n        common.updateTimeLabel('all');\n\n        // Initialize select2.\n        $(SELECTOR.PAGE).find('.singleselect').select2();\n\n        // Observer cohort change.\n        $('body').on('change', SELECTOR.COHORT, function() {\n            filter.cohort = $(SELECTOR.COHORT).val();\n            filter.course = 0;\n            reloadFilter(['course', 'group'], $(SELECTOR.COHORT).val(), filter.course, $(SELECTOR.GROUP).val());\n            // Fetching summary card data here\n            PROMISES.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n        });\n\n        flatpickr = $(SELECTOR.DATEPICKERINPUT).flatpickr({\n            mode: 'range',\n            altInput: true,\n            altFormat: \"d M Y\",\n            dateFormat: \"Y-m-d\",\n            maxDate: \"today\",\n            appendTo: $(SELECTOR.DATEPICKER).get(0),\n            onOpen: function() {\n                $(SELECTOR.DATEMENU).addClass('withcalendar');\n                setTimeout(function() {\n                    if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                        $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                    }\n                }, 500);\n            },\n            onChange: function() {\n                if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                    $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                }\n            },\n            onClose: function() {\n                $(SELECTOR.DATEMENU).removeClass('withcalendar');\n                customDateSelected();\n            }\n        });\n\n\n        /* Date selector listener */\n        $('body').on('click', SELECTOR.DATEITEM + \":not(.custom)\", function() {\n            // Set custom selected item as active.\n            $(SELECTOR.DATEITEM).removeClass('active');\n            $(this).addClass('active');\n\n            // Show selected item on dropdown button.\n            $(SELECTOR.DATE).html($(this).text());\n\n            // Clear custom date.\n            flatpickr.clear();\n\n            filter.enrolment = $(this).data('value');\n\n             // Fetching summary card data here\n             PROMISES.GET_SUMMARY_CARD_DATA(filter)\n             .done(function(response) {\n                 response = JSON.parse(response);\n                 common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                 //     initializeDatatable();\n                 });\n             });\n\n            //initializeDatatable();\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.ajax.reload();\n            common.updateTimeLabel(filter.enrolment);\n        });\n\n        // Observer course change event.\n        $('body').on('change', SELECTOR.COURSE, function() {\n            filter.course = $(SELECTOR.COURSE).val();\n\n             // Fetching summary card data here\n            PROMISES.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n\n            // Check if all courses is selected.\n            var allCourses = $(this).val() == 0;\n\n            // Hide enrolled courses.\n            dataTable.column(4).visible(allCourses);\n\n            // Hide In-progress courses\n            dataTable.column(5).visible(allCourses);\n\n            // Completed courses.\n            dataTable.column(6).visible(allCourses);\n            reloadFilter(['group'], $(SELECTOR.COHORT).val(), $(SELECTOR.COURSE).val(), $(SELECTOR.GROUP).val());\n        });\n\n        // Observer group change.\n        $('body').on('change', SELECTOR.GROUP, function() {\n            filter.group = $(SELECTOR.GROUP).val();\n             // Fetching summary card data here\n             PROMISES.GET_SUMMARY_CARD_DATA(filter)\n             .done(function(response) {\n                 response = JSON.parse(response);\n                 common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                 //     initializeDatatable();\n                 });\n             });\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.ajax.reload();\n        });\n\n        // Search in table.\n        $('body').on('input', SELECTOR.SEARCH, function() {\n            dataTable.search(this.value).draw();\n        });\n\n        // Observer INACTIVE change.\n        $('body').on('change', SELECTOR.INACTIVE, function() {\n            filter.inactive = $(this).val();\n\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.ajax.reload();\n        });\n\n        // Observer length change.\n        $('body').on('change', SELECTOR.LENGTH, function() {\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.page.len(this.value);\n            dataTable.ajax.reload();\n        });\n\n        initializeDatatable();\n\n        common.handleSearchInput();\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n                init();\n            });\n        }\n    };\n\n});\n"],"file":"studentengagement.min.js"}
