{"version":3,"sources":["reports/learnercourseactivities.js"],"names":["define","$","Notification","Ajax","common","CFG","SELECTOR","PAGE","SEARCH","COURSE","STUDENT","SECTION","MODULE","SUMMARY","COMPLETION","LENGTH","LEARNER","TABLE","FORMFILTER","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","dataTable","filter","learner","course","section","module","completion","enrolment","dir","attr","rtl","PROMISE","GET_DATA","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","JSON","stringify","GET_FILTER_DATA","types","courseid","sectionid","call","methodname","args","GET_SUMMARY_CARD_DATA","report","filters","initializeDatatable","loader","show","setTimeout","lastaccess","util","get_string","formatDate","Date","text","css","val","statuses","concat","done","response","destroy","never","DataTable","paging","deferRendering","columnDefs","className","targets","columns","width","render","tempdate","substring","timeFormatter","dom","language","info","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","hide","search","page","len","draw","fail","ex","exception","_init","updateTimeLabel","flatpickr","mode","altInput","altFormat","dateFormat","maxDate","appendTo","get","onOpen","addClass","offset","left","parent","closest","onChange","onClose","removeClass","date","dateAlternate","replace","stringarr","split","startdate","enddate","direction","text-align","includes","html","parse","refreshSummarycard","clear","customDateSelected","on","select2","templateResult","state","id","find","not","reloadFilter","length","refreshFilter","column","value","handleSearchInput","handleReportCapability","init","document","ready"],"mappings":"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","sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Learner course progress report page.\n *\n * @package     local_edwiserreports\n * @author      Yogesh Shirsath\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine('local_edwiserreports/reports/learnercourseactivities', [\n    'jquery',\n    'core/notification',\n    'core/ajax',\n    'local_edwiserreports/common',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/select2',\n    'local_edwiserreports/flatpickr'\n], function(\n    $,\n    Notification,\n    Ajax,\n    common,\n    CFG\n) {\n\n    /**\n     * Selector\n     */\n    var SELECTOR = {\n        PAGE: '#learnercourseactivities',\n        SEARCH: '#learnercourseactivities .table-search-input input',\n        COURSE: '#learnercourseactivities .course-select',\n        STUDENT: '#learnercourseactivities .student-select',\n        SECTION: '#learnercourseactivities .section-select',\n        MODULE: '#learnercourseactivities .module-select',\n        SUMMARY: '#learnercourseactivities .summary-card',\n        COMPLETION: '#learnercourseactivities .completion-select',\n        LENGTH: '#learnercourseactivities .length-select',\n        LEARNER: '#learnercourseactivities .student-select',\n        TABLE: '#learnercourseactivities table',\n        FORMFILTER: '#learnercourseactivities .download-links [name=\"filter\"]',\n        DATE: '.edwiserreports-calendar',\n        DATEMENU: '.edwiserreports-calendar + .dropdown-menu',\n        DATEITEM: '.edwiserreports-calendar + .dropdown-menu .dropdown-item',\n        DATEPICKER: '.edwiserreports-calendar + .dropdown-menu .dropdown-calendar',\n        DATEPICKERINPUT: '.edwiserreports-calendar + .dropdown-menu .flatpickr'\n    };\n\n    /**\n     * Datatable object.\n     */\n    var dataTable = null;\n\n    /**\n     * Filter object.\n     */\n    var filter = {\n        learner: null,\n        course: null,\n        section: 0,\n        module: 'all',\n        completion: 'all',\n        enrolment: 'all',\n        dir: $('html').attr('dir'),\n        rtl: $('html').attr('dir') == 'rtl' ? 1 : 0\n    };\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get learner course activities table data based on filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_DATA: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_learnercourseactivities_data',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify(filter)\n                },\n            });\n        },\n        /**\n         * Get filter data.\n         *\n         * @param   {Array}     types       Type of filters to get\n         * @param   {Integer}   courseid    Course id\n         * @param   {String}    sectionid   Section id all/id\n         * @returns {PROMISE}\n         */\n        GET_FILTER_DATA: function(types, courseid, sectionid) {\n            return Ajax.call([{\n                methodname: 'local_edwiserreports_get_filter_data',\n                args: {\n                    types: types,\n                    course: courseid,\n                    section: sectionid\n                }\n            }], false)[0];\n        },\n        /**\n         * Get summary card data.\n         *\n         * @param   {Integer}   courseid    Course id\n         * @param   {String}    cohortid   Cohort id all/id\n         * @param   {String}    groupid   group id all/id\n         * @returns {PROMISE}\n         */\n        GET_SUMMARY_CARD_DATA: function(filter) {\n            return Ajax.call([{\n                methodname: 'local_edwiserreports_get_summary_card_data',\n                args: {\n                    report: \"\\\\local_edwiserreports\\\\reports\\\\learnercourseactivities\",\n                    filters: JSON.stringify(filter)\n                }\n            }], false)[0];\n        }\n    }\n\n    /**\n     * Initialize datable.\n     */\n    function initializeDatatable() {\n        common.loader.show(SELECTOR.PAGE);\n       \n        setTimeout(function() {\n            let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n\n            lastaccess = $('.learner-course-activties-lastaccess').data('date');\n            // M.util.get_string('tableinfo', 'local_edwiserreports')\n            lastaccess = lastaccess == 0 ? M.util.get_string('never', 'local_edwiserreports') : (rtl ? common.formatDate(new Date(lastaccess * 1000), \"TT mm:hh  yyyy MMM d\") : common.formatDate(new Date(lastaccess * 1000), \"d MMM yyyy hh:mm TT\"));\n            $('.learner-course-activties-lastaccess').text(lastaccess);\n            $('.learner-course-activties-lastaccess').css('display', 'inherit');\n        }, 1500);\n\n        // Updated export filter values.\n        filter.dir = $('html').attr('dir');\n        $(SELECTOR.FORMFILTER).val(JSON.stringify(filter));\n        let statuses = [\n            `<span class=\"danger-tag\">${M.util.get_string('notyetstarted', 'core_completion')}</span>`,\n            `<span class=\"success-tag\">${M.util.get_string('completed', 'core_completion')}</span>`,\n            `<span class=\"warning-tag\">${M.util.get_string('inprogress', 'core_completion')}</span>`\n        ];\n\n        PROMISE.GET_DATA(filter)\n            .done(function(response) {\n                if (dataTable !== null) {\n                    dataTable.destroy();\n                    dataTable = null;\n                }\n                let never = M.util.get_string('never', 'local_edwiserreports');\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    data: response,\n                    paging: true,\n                    deferRendering: true,\n                    columnDefs: [\n                        { className: \"fixed-column\", targets: 0 },\n                        { className: \"text-left\", targets: [0, 1] },\n                        { className: \"text-center\", targets: \"_all\" }\n                    ],\n                    columns: [\n                        { data: 'activity', width: \"14rem\" },\n                        { data: 'type' },\n                        {\n                            data: 'status',\n                            render: function(data) {\n                                return statuses[data];\n                            },\n                            width: \"4rem\"\n                        },\n                        {\n                            data: 'completedon',\n                            render: function(data) {\n                                let tempdate = common.formatDate(new Date(data * 1000), \"d MMM yyyy\");\n                                let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0\n\n                                if(rtl){\n                                    tempdate = common.formatDate(new Date(data * 1000), \"yyyy MMM d\");\n                                }\n                                return `<p class=\"erp-time-rtl\"><span class=\"d-none\">${data}</span>` +\n                                    (data == 0 ? '-' : tempdate) + '</p>';\n                            },\n                            width: \"10rem\"\n                        },\n                        { data: 'grade' },\n                        {\n                            data: 'gradedon',\n                            render: function(data) {\n                                let tempdate = common.formatDate(new Date(data * 1000), \"d MMM yyyy\");\n                                let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0\n\n                                if(rtl){\n                                    tempdate = common.formatDate(new Date(data * 1000), \"yyyy MMM d\");\n                                }\n                                return `<p class=\"erp-time-rtl\"><span class=\"d-none\">${data}</span>` +\n                                    (data == 0 ? '-' : tempdate) + '</p>';\n                            },\n                            width: \"10rem\"\n                        },\n                        { data: 'attempts' },\n                        { data: 'highestgrade', width: \"4rem\" },\n                        { data: 'lowestgrade', width: \"4rem\" },\n                        {\n                            data: 'firstaccess',\n                            render: function(data) {\n                                let tempdate = common.formatDate(new Date(data * 1000), \"d MMM yyyy hh:mm TT\").substring(0,11) + '<br>' + common.formatDate(new Date(data * 1000), \"d MMM yyyy hh:mm TT\").substring(11,20);\n                                let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0\n\n                                if(rtl){\n                                    tempdate = common.formatDate(new Date(data * 1000), \"TT mm:hh yyyy MMM d\").substring(8, 20) + '<br>' + common.formatDate(new Date(data * 1000), \"TT mm:hh yyyy MMM d\").substring(0,8);\n                                }\n                                return `<p class=\"erp-time-rtl\"><span class=\"d-none\">${data}</span>` +\n                                    (data == 0 ? never : tempdate) + '</p>';\n                            },\n                            width: \"10rem\"\n                        },\n                        {\n                            data: 'lastaccess',\n                            render: function(data) {\n                                let tempdate = common.formatDate(new Date(data * 1000), \"d MMM yyyy hh:mm TT\").substring(0,11) + '<br>' + common.formatDate(new Date(data * 1000), \"d MMM yyyy hh:mm TT\").substring(11,20);\n                                let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0\n\n                                if(rtl){\n                                    tempdate = common.formatDate(new Date(data * 1000), \"TT mm:hh yyyy MMM d\").substring(8, 20) + '<br>' + common.formatDate(new Date(data * 1000), \"TT mm:hh yyyy MMM d\").substring(0,8);\n                                }\n                                return `<p class=\"erp-time-rtl\"><span class=\"d-none\">${data}</span>` +\n                                    (data == 0 ? never : tempdate) + '</p>';\n                            },\n                            width: \"10rem\"\n                        },\n                        { data: 'visits' },\n                        {\n                            data: 'timespent',\n                            render: function(data) {\n                                return common.timeFormatter(data);\n                            }\n                        },\n                    ],\n                    dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('emptytable', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: \" \",\n                            next: \" \"\n                        }\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                        common.loader.hide(SELECTOR.PAGE);\n                    }\n                });\n                dataTable.columns(0).search($(SELECTOR.SEARCH).val());\n                dataTable.page.len($(SELECTOR.LENGTH).val()).draw();\n            })\n            .fail(function(ex) {\n                Notification.exception(ex);\n                common.loader.hide(SELECTOR.PAGE);\n            });\n    }\n\n    /**\n     * After Select Custom date get active users details.\n     */\n    function customDateSelected() {\n        let date = $(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n        let dateAlternate = $(SELECTOR.DATEPICKERINPUT).next().val().replace(\"to\", \"-\"); // d M Y format\n        // RTL support\n        // Split string in 2 parts\n        let stringarr = dateAlternate.split('-');\n        // Formating date for rtl\n        if(filter.dir == 'rtl'){\n            // format for rtl : yyyy mm dd\n            let startdate = stringarr[0].split(' ');\n            let enddate = stringarr[1].split(' ');\n\n            startdate = startdate[2] + ' ' + startdate[1] + ' ' + startdate[0];\n            enddate = enddate[3] + ' ' + enddate[2] + ' ' + enddate[1];\n            dateAlternate = enddate + '-' + startdate;\n\n            // Making direction ltr for date selector and aligning text to right\n            $(SELECTOR.DATE).css({'direction':'ltr','text-align': 'right'});\n            $(SELECTOR.DATEPICKERINPUT).css({'direction':'ltr','text-align': 'right'});\n        }\n\n        $(SELECTOR.DATEPICKERINPUT).next().val(dateAlternate);\n\n        /* If correct date is not selected then return false */\n        if (!date.includes(\" to \")) {\n            flatpickr.clear();\n            return;\n        }\n\n        // Set active class to custom date selector item.\n        $(SELECTOR.DATEITEM).removeClass('active');\n        $(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n        // Show custom date to dropdown button.\n        $(SELECTOR.DATE).html(dateAlternate);\n\n        filter.enrolment = date;\n\n        // Fetching summary card data here\n        PROMISE.GET_SUMMARY_CARD_DATA(filter)\n        .done(function(response) {\n            response = JSON.parse(response);\n            common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n            //     initializeDatatable();\n            });\n        });\n\n        initializeDatatable();\n        common.updateTimeLabel(date);\n    }\n\n    /**\n     * Initialize\n     */\n    function init() {\n        \n        // Show time period in table info.\n        common.updateTimeLabel('all');\n\n        flatpickr = $(SELECTOR.DATEPICKERINPUT).flatpickr({\n            mode: 'range',\n            altInput: true,\n            altFormat: \"d M Y\",\n            dateFormat: \"Y-m-d\",\n            maxDate: \"today\",\n            appendTo: $(SELECTOR.DATEPICKER).get(0),\n            onOpen: function() {\n                $(SELECTOR.DATEMENU).addClass('withcalendar');\n                setTimeout(function() {\n                    if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                        $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                    }\n                }, 500);\n            },\n            onChange: function() {\n                if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                    $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                }\n            },\n            onClose: function() {\n                $(SELECTOR.DATEMENU).removeClass('withcalendar');\n                customDateSelected();\n            }\n        });\n\n        /* Date selector listener */\n        $('body').on('click', SELECTOR.DATEITEM + \":not(.custom)\", function() {\n            // Set custom selected item as active.\n            $(SELECTOR.DATEITEM).removeClass('active');\n            $(this).addClass('active');\n\n            // Show selected item on dropdown button.\n            $(SELECTOR.DATE).html($(this).text());\n\n            // Clear custom date.\n            flatpickr.clear();\n\n            filter.enrolment = $(this).data('value');\n\n            // Fetching summary card data here\n            PROMISE.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n\n            initializeDatatable();\n            common.updateTimeLabel(filter.enrolment);\n        });\n\n        \n        filter = JSON.parse($(SELECTOR.FORMFILTER).val());\n\n        // Initialize select2.\n        $(SELECTOR.COURSE).select2({\n            templateResult: function(state) {\n                if (!state.id) {\n                    return state.text;\n                }\n                var $state = $(\n                    '<span class=\"pl-3 d-block\">' + state.text + '</span>'\n                );\n                return $state;\n            }\n        });\n\n        $(SELECTOR.PAGE).find('.singleselect').not(SELECTOR.COURSE).select2();\n\n        // Observer course change.\n        $('body').on('change', SELECTOR.COURSE, function() {\n            filter.course = $(this).val();\n            filter.section = 0;\n            filter.module = 'all';\n            filter.learner = null;\n\n            // common.loader.show(SELECTOR.PAGE);\n            common.reloadFilter(\n            SELECTOR.PAGE, ['student', 'section', 'module', 'noallusers'],\n            0,\n            filter.course,\n            0,\n            function() {\n                if ($(SELECTOR.LEARNER).find('option:first-child').length) {\n                    filter.learner = $(SELECTOR.LEARNER).find('option:first-child').attr('value');\n                }\n                initializeDatatable();\n                setTimeout(function() {\n\n                    // Fetching summary card data here\n                    PROMISE.GET_SUMMARY_CARD_DATA(filter)\n                    .done(function(response) {\n                        response = JSON.parse(response);\n                        common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                            let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n                            lastaccess = $('.learner-course-activties-lastaccess').data('date');\n                            // M.util.get_string('tableinfo', 'local_edwiserreports')\n                            lastaccess = lastaccess == 0 ? M.util.get_string('never', 'local_edwiserreports') : (rtl ? common.formatDate(new Date(lastaccess * 1000), \"TT mm:hh  yyyy MMM d\") : common.formatDate(new Date(lastaccess * 1000), \"d MMM yyyy hh:mm TT\"));\n                            // lastaccess = lastaccess == 0 ? M.util.get_string('never', 'local_edwiserreports') : common.formatDate(new Date(lastaccess * 1000), \"d MMM yyyy hh:mm TT\");\n                            $('.learner-course-activties-lastaccess').text(lastaccess);\n                            $('.learner-course-activties-lastaccess').css('display', 'inherit');\n                            // lastaccess = $('.learner-course-activties-lastaccess').data('date');\n                        });\n                    });\n                }, 500);\n\n                setTimeout(function() {\n                    lastaccess = $('.learner-course-activties-lastaccess').data('date');\n                            // M.util.get_string('tableinfo', 'local_edwiserreports')\n                    lastaccess = lastaccess == 0 ? M.util.get_string('never', 'local_edwiserreports') : (rtl ? common.formatDate(new Date(lastaccess * 1000), \"TT mm:hh  yyyy MMM d\") : common.formatDate(new Date(lastaccess * 1000), \"d MMM yyyy hh:mm TT\"));\n                    // lastaccess = $('.learner-course-activties-lastaccess').data('date');\n                    // lastaccess = lastaccess == 0 ? M.util.get_string('never', 'local_edwiserreports') : common.formatDate(new Date(lastaccess * 1000), \"d MMM yyyy hh:mm TT\");\n                    $('.learner-course-activties-lastaccess').text(lastaccess);\n                    $('.learner-course-activties-lastaccess').css('display', 'inherit');\n                }, 1500);\n\n            });\n\n        });\n\n        // Observer learner change.\n        $('body').on('change', SELECTOR.LEARNER, function() {\n            filter.learner = $(this).val();\n            initializeDatatable();\n\n            setTimeout(function() {\n                // Fetching summary card data here\n                PROMISE.GET_SUMMARY_CARD_DATA(filter)\n                .done(function(response) {\n                    response = JSON.parse(response);\n                    common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                    });\n                });\n            }, 500);\n\n            \n        });\n\n        // Observer section change.\n        $('body').on('change', SELECTOR.SECTION, function() {\n            filter.section = $(this).val();\n            filter.module = 'all';\n\n            PROMISE.GET_FILTER_DATA(['module'], filter.course, filter.section)\n                .done(function(response) {\n                    response = JSON.parse(response);\n                    common.refreshFilter('module', response.module, SELECTOR.PAGE, function() {\n                        initializeDatatable();\n                    });\n                });\n            initializeDatatable();\n\n            // Fetching summary card data here\n            PROMISE.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                });\n            });\n\n            \n            setTimeout(function() {\n                lastaccess = $('.learner-course-activties-lastaccess').data('date');\n                            // M.util.get_string('tableinfo', 'local_edwiserreports')\n                lastaccess = lastaccess == 0 ? M.util.get_string('never', 'local_edwiserreports') : (rtl ? common.formatDate(new Date(lastaccess * 1000), \"TT mm:hh  yyyy MMM d\") : common.formatDate(new Date(lastaccess * 1000), \"d MMM yyyy hh:mm TT\"));\n                    \n                // lastaccess = $('.learner-course-activties-lastaccess').data('date');\n                // lastaccess = lastaccess == 0 ? M.util.get_string('never', 'local_edwiserreports') : common.formatDate(new Date(lastaccess * 1000), \"d MMM yyyy hh:mm TT\");\n                $('.learner-course-activties-lastaccess').text(lastaccess);\n                $('.learner-course-activties-lastaccess').css('display', 'inherit');\n            }, 600);\n\n        });\n\n        // Observer module change.\n        $('body').on('change', SELECTOR.MODULE, function() {\n            filter.module = $(this).val();\n            initializeDatatable();\n        });\n\n        // Observer completion change.\n        $('body').on('change', SELECTOR.COMPLETION, function() {\n            filter.completion = $(this).val();\n            initializeDatatable();\n        });\n\n        // Search in table.\n        $('body').on('input', SELECTOR.SEARCH, function() {\n            dataTable.column(0).search(this.value).draw();\n        });\n\n        // Observer length change.\n        $('body').on('change', SELECTOR.LENGTH, function() {\n            dataTable.page.len(this.value).draw();\n        });\n\n\n        initializeDatatable();\n        common.handleSearchInput();\n\n        // Handle report page capability manager.\n        common.handleReportCapability();\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n                init();\n            });\n        }\n    };\n\n});\n"],"file":"learnercourseactivities.min.js"}
