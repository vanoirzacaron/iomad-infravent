{"version":3,"sources":["reports/completion.js"],"names":["define","$","Ajax","Notification","common","CFG","SELECTOR","PAGE","EXPORT","COHORT","COURSE","GROUP","EXCLUDE","INACTIVE","PROGRESS","GRADE","LENGTH","SEARCH","PAGETITLE","FORMFILTER","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","SUMMARY","filter","cohort","course","group","exclude","enrolment","inactive","progress","grade","groupname","cohortname","dir","attr","flatpickr","dataTable","PROMISES","GET_DATA","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","sesskey","M","local_edwiserreports","secret","lang","JSON","stringify","GET_SUMMARY_CARD_DATA","call","methodname","args","report","filters","initializeDatatable","loader","show","val","find","statuses","concat","util","get_string","never","done","response","destroy","text","name","DataTable","dom","pageLength","deferRendering","language","info","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","columnDefs","className","targets","columns","width","render","tempdate","formatDate","Date","substring","timeFormatter","drawCallback","stylePaginationButton","this","initComplete","hide","search","page","len","draw","fail","ex","exception","reloadFilter","types","callback","_init","CONTEXTID","updateTimeLabel","handleSearchInput","not","select2","placeholder","allowClear","mode","altInput","altFormat","dateFormat","maxDate","appendTo","get","onOpen","addClass","setTimeout","offset","left","parent","css","closest","onChange","onClose","removeClass","date","dateAlternate","replace","stringarr","split","startdate","enddate","direction","text-align","includes","html","parse","refreshSummarycard","clear","customDateSelected","on","value","column","toggleClass","length","toggle","indexOf","init","document","ready"],"mappings":"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","sourcesContent":["/**\n * Course Completion report page.\n *\n * @package     local_edwiserreports\n * @author      Yogesh Shirsath\n * @copyright   2022 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine('local_edwiserreports/reports/completion', [\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'local_edwiserreports/common',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/select2',\n    'local_edwiserreports/flatpickr'\n], function($, Ajax, Notification, common, CFG) {\n\n    /**\n     * Selectors list.\n     */\n    var SELECTOR = {\n        PAGE: \".report-content\",\n        EXPORT: \".report-export\",\n        COHORT: \".report-content .cohort-select\",\n        COURSE: \".report-content .course-select\",\n        GROUP: \".report-content .group-select\",\n        EXCLUDE: '.report-content .exclude-select',\n        INACTIVE: '.report-content .inactive-select',\n        PROGRESS: '.report-content .progress-select',\n        GRADE: '.report-content .grade-select',\n        LENGTH: \".report-content .length-select\",\n        SEARCH: \".report-content .table-search-input input\",\n        PAGETITLE: \".report-header .page-title h2\",\n        FORMFILTER: '.report-content .download-links [name=\"filter\"]',\n        DATE: '.edwiserreports-calendar',\n        DATEMENU: '.edwiserreports-calendar + .dropdown-menu',\n        DATEITEM: '.edwiserreports-calendar + .dropdown-menu .dropdown-item',\n        DATEPICKER: '.edwiserreports-calendar + .dropdown-menu .dropdown-calendar',\n        DATEPICKERINPUT: '.edwiserreports-calendar + .dropdown-menu .flatpickr',\n        SUMMARY: '#wdm-completion-individual .summary-card'\n    };\n\n    /**\n     * Filter object.\n     */\n    var filter = {\n        cohort: 0,\n        course: null,\n        group: 0,\n        exclude: [],\n        enrolment: 'all',\n        inactive: 'all',\n        progress: 'all',\n        grade: 'all',\n        groupname: '',\n        cohortname :'',\n        dir: $('html').attr('dir')    };\n\n    /**\n     * Flat picker object.\n     */\n    let flatpickr = null;\n\n    /**\n     * Datatable object.\n     */\n    var dataTable = null;\n\n    /**\n     * Promise lists.\n     */\n    let PROMISES = {\n        /**\n         * Get all courses summary table data based on filters.\n         * @returns {PROMISE}\n         */\n        GET_DATA: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_completion_data_ajax',\n                    sesskey: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify(filter)\n                },\n            });\n        },\n        /**\n         * Get summary card data.\n         *\n         * @param   {Integer}   courseid    Course id\n         * @param   {String}    cohortid   Cohort id all/id\n         * @param   {String}    groupid   group id all/id\n         * @returns {PROMISE}\n         */\n        GET_SUMMARY_CARD_DATA: function(filter) {\n            return Ajax.call([{\n                methodname: 'local_edwiserreports_get_summary_card_data',\n                args: {\n                    report: \"\\\\local_edwiserreports\\\\blocks\\\\completionblock\",\n                    filters: JSON.stringify(filter)\n                }\n            }], false)[0];\n        }\n    };\n\n    /**\n     * After Select Custom date get active users details.\n     */\n    function customDateSelected() {\n        let date = $(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n        let dateAlternate = $(SELECTOR.DATEPICKERINPUT).next().val().replace(\"to\", \"-\"); // d M Y format\n\n        \n    // RTL support\n        // Split string in 2 parts\n        let stringarr = dateAlternate.split('-');\n        // Formating date for rtl\n        if(filter.dir == 'rtl'){\n            // format for rtl : yyyy mm dd\n            let startdate = stringarr[0].split(' ');\n            let enddate = stringarr[1].split(' ');\n\n            startdate = startdate[2] + ' ' + startdate[1] + ' ' + startdate[0];\n            enddate = enddate[3] + ' ' + enddate[2] + ' ' + enddate[1];\n            dateAlternate = enddate + '-' + startdate;\n\n            // Making direction ltr for date selector and aligning text to right\n            $(SELECTOR.DATE).css({'direction':'ltr','text-align': 'right'});\n            $(SELECTOR.DATEPICKERINPUT).css({'direction':'ltr','text-align': 'right'});\n        }\n\n        $(SELECTOR.DATEPICKERINPUT).next().val(dateAlternate);\n\n        /* If correct date is not selected then return false */\n        if (!date.includes(\" to \")) {\n            flatpickr.clear();\n            return;\n        }\n\n        // Set active class to custom date selector item.\n        $(SELECTOR.DATEITEM).removeClass('active');\n        $(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n        // Show custom date to dropdown button.\n        $(SELECTOR.DATE).html(dateAlternate);\n\n        filter.enrolment = date;\n\n        // Get summary card data\n        filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n        filter.cohortname = $(SELECTOR.COHORT).find(`option:selected`).text();\n\n        PROMISES.GET_SUMMARY_CARD_DATA(filter)\n        .done(function(response) {\n            response = JSON.parse(response);\n            common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n            //     initializeDatatable();\n            });\n        });\n\n        initializeDatatable();\n        common.updateTimeLabel(date);\n    }\n\n    /**\n     * Get Course Completion\n     */\n    function initializeDatatable() {\n        common.loader.show(SELECTOR.PAGE);\n\n        // Updated export filter values.\n        filter.dir = $('html').attr('dir');\n        $(SELECTOR.FORMFILTER).val(JSON.stringify(filter));\n        \n        $(SELECTOR.PAGE).find('.download-links input[name=\"filter\"]').val(JSON.stringify(filter));\n        let statuses = [\n            `<span class=\"danger-tag\">${M.util.get_string('notyetstarted', 'core_completion')}</span>`,\n            `<span class=\"success-tag\">${M.util.get_string('completed', 'core_completion')}</span>`,\n            `<span class=\"warning-tag\">${M.util.get_string('inprogress', 'core_completion')}</span>`\n        ];\n        let never = M.util.get_string('never', 'local_edwiserreports');\n\n        PROMISES.GET_DATA(filter).done(function(response) {\n            if (dataTable != null) {\n                dataTable.destroy();\n            }\n            $(SELECTOR.PAGETITLE).text(response.name);\n            dataTable = $(SELECTOR.PAGE).find(\".table\").DataTable({\n                dom: '<\"edwiserreports-table\"<\"table-filter d-flex\"i><t><\"table-pagination\"p>>',\n                data: response.data,\n                pageLength: $(SELECTOR.LENGTH).val(),\n                deferRendering: true,\n                language: {\n                    info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                    infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                    emptyTable: M.util.get_string('nostudentsenrolled', 'local_edwiserreports'),\n                    zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                    paginate: {\n                        previous: \" \",\n                        next: \" \"\n                    }\n                },\n                columnDefs: [\n                    { className: \"fixed-column\", targets: 0 },\n                    { className: \"text-left\", targets: [0, 1, 2] },\n                    { className: \"text-center\", targets: \"_all\" }\n                ],\n                columns: [\n                    { data: \"learner\", width: \"12rem\" },\n                    { data: \"email\" },\n                    {\n                        data: \"status\",\n                        render: function(data) {\n                            return statuses[data];\n                        },\n                        width: \"4rem\"\n                    },\n                    {\n                        data: \"enrolledon\",\n                        render: function(data) { \n                            let tempdate = common.formatDate(new Date(data * 1000), \"d MMM yyyy\");\n                            let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0\n\n                            if(rtl){\n                                tempdate = common.formatDate(new Date(data * 1000), \"yyyy MMM d\");\n                            }\n                            return `<p class=\"erp-time-rtl\"><span class=\"d-none\">${data}</span>` +\n                                (data == 0 ? '-' : tempdate) + '</p>';\n                        },\n                        width: \"10rem\"\n                    },\n                    {\n                        data: \"completedon\",\n                        render: function(data) {\n                            let tempdate = common.formatDate(new Date(data * 1000), \"d MMM yyyy\");\n                            let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0\n\n                            if(rtl){\n                                tempdate = common.formatDate(new Date(data * 1000), \"yyyy MMM d\");\n                            }\n                            return `<p class=\"erp-time-rtl\"><span class=\"d-none\">${data}</span>` +\n                                (data == 0 ? '-' : tempdate) + '</p>';\n                        },\n                        width: \"10rem\"\n                    },\n                    {\n                        data: \"lastaccess\",\n                        render: function(data) {\n\n                            let tempdate = common.formatDate(new Date(data * 1000), \"d MMM yyyy hh:mm TT\").substring(0,11) + '<br>' + common.formatDate(new Date(data * 1000), \"d MMM yyyy hh:mm TT\").substring(11,20);\n                            let rtl = $('html').attr('dir') == 'rtl' ? 1 : 0\n\n                            if(rtl){\n                                tempdate = common.formatDate(new Date(data * 1000), \"TT mm:hh yyyy MMM d\").substring(8, 20) + '<br>' + common.formatDate(new Date(data * 1000), \"TT mm:hh yyyy MMM d\").substring(0,8);\n                            }\n\n                            return `<p class=\"erp-time-rtl\"><span class=\"d-none\">${data}</span>` +\n                                (data == 0 ? never : tempdate) + '</p>';\n                        },\n                        width: \"10rem\"\n                    },\n                    { data: \"progress\" },\n                    { data: \"grade\" },\n                    { data: \"completedactivities\", width: \"5rem\" },\n                    { data: \"assignment\", width: \"6rem\" },\n                    { data: \"quiz\", width: \"5rem\" },\n                    { data: \"scorm\", width: \"5rem\" },\n                    { data: \"visits\", width: \"2rem\" },\n                    {\n                        data: \"timespent\",\n                        render: function(data) {\n                            return common.timeFormatter(data);\n                        }\n                    }\n                ],\n                drawCallback: function() {\n                    common.stylePaginationButton(this);\n                },\n                initComplete: function() {\n                    common.loader.hide(SELECTOR.PAGE);\n                }\n            });\n            dataTable.columns(0).search($(SELECTOR.SEARCH).val());\n            dataTable.page.len($(SELECTOR.LENGTH).val()).draw();\n        }).fail(function(ex) {\n            Notification.exception(ex);\n            common.loader.hide(SELECTOR.PAGE);\n        });\n    }\n\n    /**\n     * Reload filters.\n     */\n    function reloadFilter(types, cohort, course, callback) {\n        common.loader.show(SELECTOR.PAGE);\n        common.reloadFilter(\n            SELECTOR.PAGE,\n            types,\n            cohort,\n            course,\n            0,\n            callback\n        );\n    }\n\n    /* eslint-disable no-unused-vars */\n    /**\n     * Initialize\n     * @param {integer} CONTEXTID Current page context id\n     */\n    function init(CONTEXTID) {\n\n        filter.dir = $('html').attr('dir');\n\n        // Show time period in table info.\n        common.updateTimeLabel('all');\n\n        common.handleSearchInput();\n\n        // Initialize select2.\n        $(SELECTOR.PAGE).find('.singleselect').not(SELECTOR.EXCLUDE).select2();\n        $(SELECTOR.EXCLUDE).select2({\n            placeholder: M.util.get_string('exclude', 'local_edwiserreports'),\n            allowClear: true\n        });\n\n        flatpickr = $(SELECTOR.DATEPICKERINPUT).flatpickr({\n            mode: 'range',\n            altInput: true,\n            altFormat: \"d M Y\",\n            dateFormat: \"Y-m-d\",\n            maxDate: \"today\",\n            appendTo: $(SELECTOR.DATEPICKER).get(0),\n            onOpen: function() {\n                $(SELECTOR.DATEMENU).addClass('withcalendar');\n                setTimeout(function() {\n                    if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                        $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                    }\n                }, 500);\n            },\n            onChange: function() {\n                if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                    $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                }\n            },\n            onClose: function() {\n                $(SELECTOR.DATEMENU).removeClass('withcalendar');\n                customDateSelected();\n            }\n        });\n\n\n        /* Date selector listener */\n        $('body').on('click', SELECTOR.DATEITEM + \":not(.custom)\", function() {\n            // Set custom selected item as active.\n            $(SELECTOR.DATEITEM).removeClass('active');\n            $(this).addClass('active');\n\n            // Show selected item on dropdown button.\n            $(SELECTOR.DATE).html($(this).text());\n\n            // Clear custom date.\n            flatpickr.clear();\n\n            filter.enrolment = $(this).data('value');\n\n            // Get summary card data\n            filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n            filter.cohortname = $(SELECTOR.COHORT).find(`option:selected`).text();\n            PROMISES.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n\n            initializeDatatable();\n            common.updateTimeLabel(filter.enrolment);\n        });\n\n        // Get course id\n        filter.course = $(SELECTOR.COURSE).val();\n\n        // Select cohort filter for completion table.\n        $('body').on('change', SELECTOR.COHORT, function() {\n            filter.cohort = $(this).val();\n            filter.group = 0;\n\n            reloadFilter(['course', 'noallcourses'], filter.cohort, filter.course, function() {\n                // if ($(SELECTOR.COURSE).find(`option[value=\"${filter.course}\"]`).length == 0) {\n                    filter.course = $(SELECTOR.COURSE).find(`option:first`).attr('value');\n                // }\n                reloadFilter(['group'], filter.cohort, filter.course, function() {\n                    initializeDatatable();\n                    // setTimeout(function() {\n                        // Get summary card data\n                        filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n                        filter.cohortname = $(SELECTOR.COHORT).find(`option:selected`).text();\n                        PROMISES.GET_SUMMARY_CARD_DATA(filter)\n                        .done(function(response) {\n                            response = JSON.parse(response);\n                            common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                            //     initializeDatatable();\n                            });\n                        });\n                    // }, 500);\n                });\n            });\n\n\n\n        });\n\n        // Select course filter for completion table.\n        $('body').on('change', SELECTOR.COURSE, function() {\n            filter.course = $(this).val();\n            filter.group = 0;\n\n            // Get summary card data\n            filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n            filter.cohortname = $(SELECTOR.COHORT).find(`option:selected`).text();\n\n            PROMISES.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n\n\n            reloadFilter(['group'], filter.cohort, filter.course, function() {\n                initializeDatatable();\n            });\n        });\n\n        // Select group filter for completion table.\n        $('body').on('change', SELECTOR.GROUP, function() {\n            filter.group = $(this).val();\n\n            // Get summary card data\n            filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n            filter.cohortname = $(SELECTOR.COHORT).find(`option:selected`).text();\n\n            PROMISES.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n\n            initializeDatatable();\n            \n        });\n\n        // Observer length change.\n        $('body').on('change', SELECTOR.LENGTH, function() {\n            dataTable.page.len(this.value).draw();\n        });\n\n        // Search in table.\n        $('body').on('input', SELECTOR.SEARCH, function() {\n            dataTable.column(0).search(this.value).draw();\n        });\n\n        // Observer exclude change.\n        $('body').on('change', SELECTOR.EXCLUDE, function() {\n            filter.exclude = $(this).val();\n            $(this).toggleClass('notselected', filter.exclude.length == 0);\n            $(this).toggleClass('selected', filter.exclude.length != 0);\n            // Display none to inactive users if exclude is selected.\n            $(SELECTOR.INACTIVE).closest('.filter-selector')\n                .toggle(filter.exclude.indexOf('2') == -1 && filter.exclude.indexOf('3') == -1);\n            initializeDatatable();\n        });\n\n        // Observer progress change.\n        $('body').on('change', SELECTOR.PROGRESS, function() {\n            filter.progress = $(this).val();\n            initializeDatatable();\n        });\n\n        // Observer inactive users change.\n        $('body').on('change', SELECTOR.INACTIVE, function() {\n            filter.inactive = $(this).val();\n            initializeDatatable();\n        });\n\n        // Observer grade change.\n        $('body').on('change', SELECTOR.GRADE, function() {\n            filter.grade = $(this).val();\n            initializeDatatable();\n        });\n\n        initializeDatatable();\n    }\n\n    return {\n        init: function(CONTEXTID) {\n            $(document).ready(function() {\n                init(CONTEXTID);\n            });\n        }\n    };\n\n});\n"],"file":"completion.min.js"}
