{"version":3,"sources":["reports/courseactivitiessummary.js"],"names":["define","$","Notification","Ajax","common","CFG","SELECTOR","PAGE","SEARCH","LENGTH","COURSE","GROUP","SECTION","SUMMARY","MODULE","EXCLUDE","TABLE","FORMFILTER","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","flatpickr","dataTable","filter","course","section","module","group","exclude","enrolment","sectionname","activityname","dir","attr","rtl","PROMISE","GET_DATA","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","JSON","stringify","GET_FILTER_DATA","types","courseid","sectionid","call","methodname","args","GET_SUMMARY_CARD_DATA","report","filters","initializeDatatable","val","loader","show","concat","closest","toggleClass","find","length","statuses","util","get_string","done","response","destroy","DataTable","paging","deferRendering","columnDefs","className","targets","columns","render","width","timeFormatter","dom","language","info","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","hide","search","page","len","draw","fail","ex","exception","_init","parse","updateTimeLabel","css","direction","text-align","not","select2","templateResult","state","id","text","placeholder","allowClear","mode","altInput","altFormat","dateFormat","maxDate","appendTo","get","onOpen","addClass","setTimeout","offset","left","parent","onChange","onClose","removeClass","date","dateAlternate","replace","stringarr","split","startdate","enddate","includes","html","groupname","refreshSummarycard","clear","customDateSelected","on","reloadFilter","refreshFilter","value","handleSearchInput","handleReportCapability","init","document","ready"],"mappings":"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","sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Course Activities Summary report page.\n *\n * @package     local_edwiserreports\n * @author      Yogesh Shirsath\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine('local_edwiserreports/reports/courseactivitiessummary', [\n    'jquery',\n    'core/notification',\n    'core/ajax',\n    'local_edwiserreports/common',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/select2',\n    'local_edwiserreports/flatpickr'\n], function(\n    $,\n    Notification,\n    Ajax,\n    common,\n    CFG\n) {\n\n    /**\n     * Selector\n     */\n    var SELECTOR = {\n        PAGE: '#courseactivitiessummary',\n        SEARCH: '#courseactivitiessummary .table-search-input input',\n        LENGTH: '#courseactivitiessummary .length-select',\n        COURSE: '#courseactivitiessummary .course-select',\n        GROUP: '#courseactivitiessummary .group-select',\n        SECTION: '#courseactivitiessummary .section-select',\n        SUMMARY: '#courseactivitiessummary .summary-card',\n        MODULE: '#courseactivitiessummary .module-select',\n        EXCLUDE: '#courseactivitiessummary .exclude-select',\n        TABLE: '#courseactivitiessummary table',\n        FORMFILTER: '#courseactivitiessummary .download-links [name=\"filter\"]',\n        DATE: '.edwiserreports-calendar',\n        DATEMENU: '.edwiserreports-calendar + .dropdown-menu',\n        DATEITEM: '.edwiserreports-calendar + .dropdown-menu .dropdown-item',\n        DATEPICKER: '.edwiserreports-calendar + .dropdown-menu .dropdown-calendar',\n        DATEPICKERINPUT: '.edwiserreports-calendar + .dropdown-menu .flatpickr'\n    };\n\n    /**\n     * Flat picker object.\n     */\n    let flatpickr = null;\n\n    /**\n     * Datatable object.\n     */\n    var dataTable = null;\n\n    /**\n     * Filter object.\n     */\n    var filter = {\n        course: null,\n        section: 0,\n        module: 'all',\n        group: 0,\n        exclude: [],\n        enrolment: 'all',\n        sectionname: '',\n        activityname: '',\n        dir: $('html').attr('dir'),\n        rtl: $('html').attr('dir') == 'rtl' ? 1 : 0\n    };\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get course activities summary table data based on filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_DATA: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_courseactivitiessummary_data',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify(filter)\n                },\n            });\n        },\n\n        /**\n         * Get filter data.\n         *\n         * @param   {Array}     types       Type of filters to get\n         * @param   {Integer}   courseid    Course id\n         * @param   {String}    sectionid   Section id all/id\n         * @returns {PROMISE}\n         */\n        GET_FILTER_DATA: function(types, courseid, sectionid) {\n            return Ajax.call([{\n                methodname: 'local_edwiserreports_get_filter_data',\n                args: {\n                    types: types,\n                    course: courseid,\n                    section: sectionid\n                }\n            }], false)[0];\n        },\n        /**\n         * Get summary card data.\n         *\n         * @param   {Integer}   courseid    Course id\n         * @param   {String}    cohortid   Cohort id all/id\n         * @param   {String}    groupid   group id all/id\n         * @returns {PROMISE}\n         */\n        GET_SUMMARY_CARD_DATA: function(filter) {\n            return Ajax.call([{\n                methodname: 'local_edwiserreports_get_summary_card_data',\n                args: {\n                    report: \"\\\\local_edwiserreports\\\\reports\\\\courseactivitiessummary\",\n                    filters: JSON.stringify(filter)\n                }\n            }], false)[0];\n        }\n    }\n\n    /**\n     * Initialize datable.\n     */\n    function initializeDatatable() {\n        // Updated export filter values.\n        filter.dir = $('html').attr('dir');\n        $(SELECTOR.FORMFILTER).val(JSON.stringify(filter));\n\n        common.loader.show(SELECTOR.PAGE);\n        $(`${SELECTOR.SEARCH}, ${SELECTOR.COURSE}, ${SELECTOR.EXCLUDE}`).closest('.filter-selector').toggleClass('col-lg-4', $(SELECTOR.PAGE).find('.filter-selector.d-none').length == 3)\n            .toggleClass('col-lg-3', $(SELECTOR.PAGE).find('.filter-selector.d-none').length != 3);\n\n        let statuses = [\n            `<span class=\"danger-tag\">${M.util.get_string('notyetstarted', 'core_completion')}</span>`,\n            `<span class=\"success-tag\">${M.util.get_string('completed', 'core_completion')}</span>`,\n            `<span class=\"warning-tag\">${M.util.get_string('inprogress', 'core_completion')}</span>`\n        ];\n        PROMISE.GET_DATA(filter)\n            .done(function(response) {\n                if (dataTable !== null) {\n                    dataTable.destroy();\n                    dataTable = null;\n                }\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    data: response,\n                    paging: true,\n                    deferRendering: true,\n                    columnDefs: [\n                        { className: \"fixed-column\", targets: 0 },\n                        { className: \"text-left\", targets: [0, 1] },\n                        { className: \"text-center\", targets: \"_all\" }\n                    ],\n                    columns: [\n                        { \n                            'data': 'activity',\n                            render: function(data) {\n                                return '<span class=\"ed-reports-large-column\">' + data + '</span>';\n                            }\n                            , width: \"14rem\"\n                        },\n                        { 'data': 'type' },\n                        {\n                            'data': 'status',\n                            render: function(data) {\n                                return statuses[data];\n                            },\n                            width: \"4rem\"\n                        },\n                        { 'data': 'learnerscompleted', width: \"5rem\" },\n                        { 'data': 'completionrate', width: \"6rem\" },\n                        { 'data': 'maxgrade', width: \"3rem\" },\n                        { 'data': 'passgrade', width: \"4rem\" },\n                        { 'data': 'averagegrade', width: \"4rem\" },\n                        { 'data': 'highestgrade', width: \"4rem\" },\n                        { 'data': 'lowestgrade', width: \"4rem\" },\n                        {\n                            'data': 'totaltimespent',\n                            render: function(data) {\n                                return common.timeFormatter(data, [], filter.rtl);\n                            },\n                            width: \"10rem\"\n                        },\n                        {\n                            'data': 'averagetimespent',\n                            render: function(data) {\n                                return common.timeFormatter(data, [], filter.rtl);\n                            },\n                            width: \"10rem\"\n                        },\n                        { 'data': 'totalvisits', width: \"3rem\" },\n                        { 'data': 'averagevisits', width: \"4rem\" }\n                    ],\n                    dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('emptytable', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: \" \",\n                            next: \" \"\n                        }\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                        common.loader.hide(SELECTOR.PAGE);\n                    }\n                });\n                dataTable.columns(0).search($(SELECTOR.SEARCH).val());\n                dataTable.page.len($(SELECTOR.LENGTH).val()).draw();\n            })\n            .fail(function(ex) {\n                Notification.exception(ex);\n                common.loader.hide(SELECTOR.PAGE);\n            });\n    }\n\n    /**\n     * After Select Custom date get active users details.\n     */\n    function customDateSelected() {\n        let date = $(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n        let dateAlternate = $(SELECTOR.DATEPICKERINPUT).next().val().replace(\"to\", \"-\"); // d M Y format\n\n        // RTL support\n        // Split string in 2 parts\n        let stringarr = dateAlternate.split('-');\n        // Formating date for rtl\n        if(filter.dir == 'rtl'){\n            // format for rtl : yyyy mm dd\n            let startdate = stringarr[0].split(' ');\n            let enddate = stringarr[1].split(' ');\n\n            startdate = startdate[2] + ' ' + startdate[1] + ' ' + startdate[0];\n            enddate = enddate[3] + ' ' + enddate[2] + ' ' + enddate[1];\n            dateAlternate = enddate + '-' + startdate;\n\n            // Making direction ltr for date selector and aligning text to right\n            $(SELECTOR.DATE).css({'direction':'ltr','text-align': 'right'});\n            $('.dropdown-item.custom').css({'direction':'ltr','text-align': 'right'});\n        }\n\n        $(SELECTOR.DATEPICKERINPUT).next().val(dateAlternate);\n\n        /* If correct date is not selected then return false */\n        if (!date.includes(\" to \")) {\n            flatpickr.clear();\n            return;\n        }\n\n        // Set active class to custom date selector item.\n        $(SELECTOR.DATEITEM).removeClass('active');\n        $(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n        // Show custom date to dropdown button.\n        $(SELECTOR.DATE).html(dateAlternate);\n\n        filter.enrolment = date;\n\n        // Fetching summary card data here\n        filter.sectionname = $(SELECTOR.SECTION).find(`option:selected`).text();\n        filter.activityname = $(SELECTOR.MODULE).find(`option:selected`).text();\n        filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n\n        PROMISE.GET_SUMMARY_CARD_DATA(filter)\n        .done(function(response) {\n            response = JSON.parse(response);\n            common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n            //     initializeDatatable();\n            });\n        });\n\n        initializeDatatable();\n        common.updateTimeLabel(date);\n    }\n\n    /**\n     * Reload filters.\n     */\n    function reloadFilter(types, course) {\n        common.loader.show(SELECTOR.PAGE);\n        common.reloadFilter(\n            SELECTOR.PAGE,\n            types,\n            0,\n            course,\n            0,\n            function() {\n                initializeDatatable();\n            });\n    }\n\n    /**\n     * Initialize\n     */\n    function init() {\n\n        filter = JSON.parse($(SELECTOR.FORMFILTER).val());\n        filter.rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n\n        // Show time period in table info.\n        common.updateTimeLabel('all');\n\n        if(filter.dir == 'rtl'){\n            $('.dropdown-item.custom').css({'direction':'ltr','text-align': 'right'});\n        }\n\n        // Initialize select2.\n        $(SELECTOR.PAGE).find('.singleselect').not(SELECTOR.COURSE).not(SELECTOR.EXCLUDE).select2();\n        $(SELECTOR.COURSE).select2({\n            templateResult: function(state) {\n                if (!state.id) {\n                    return state.text;\n                }\n                var $state = $(\n                    '<span class=\"pl-3 d-block\">' + state.text + '</span>'\n                );\n                return $state;\n            }\n        });\n        $(SELECTOR.EXCLUDE).select2({\n            placeholder: M.util.get_string('exclude', 'local_edwiserreports'),\n            allowClear: true\n        });\n\n        flatpickr = $(SELECTOR.DATEPICKERINPUT).flatpickr({\n            mode: 'range',\n            altInput: true,\n            altFormat: \"d M Y\",\n            dateFormat: \"Y-m-d\",\n            maxDate: \"today\",\n            appendTo: $(SELECTOR.DATEPICKER).get(0),\n            onOpen: function() {\n                $(SELECTOR.DATEMENU).addClass('withcalendar');\n                setTimeout(function() {\n                    if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                        $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                    }\n                }, 500);\n            },\n            onChange: function() {\n                if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                    $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                }\n            },\n            onClose: function() {\n                $(SELECTOR.DATEMENU).removeClass('withcalendar');\n                customDateSelected();\n            }\n        });\n\n        /* Date selector listener */\n        $('body').on('click', SELECTOR.DATEITEM + \":not(.custom)\", function() {\n            // Set custom selected item as active.\n            $(SELECTOR.DATEITEM).removeClass('active');\n            $(this).addClass('active');\n\n            // Show selected item on dropdown button.\n            $(SELECTOR.DATE).html($(this).text());\n\n            // Clear custom date.\n            flatpickr.clear();\n\n            filter.enrolment = $(this).data('value');\n\n            // Fetching summary card data here\n            filter.sectionname = $(SELECTOR.SECTION).find(`option:selected`).text();\n            filter.activityname = $(SELECTOR.MODULE).find(`option:selected`).text();\n            filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n\n            PROMISE.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n\n\n            initializeDatatable();\n            common.updateTimeLabel(filter.enrolment);\n        });\n\n        // Observer course change.\n        $('body').on('change', SELECTOR.COURSE, function() {\n            filter.course = $(this).val();\n\n            filter.section = 0;\n            filter.module = 'all';\n            filter.group = 0;\n            reloadFilter(['section', 'module', 'group'], filter.course);\n\n            // Fetching summary card data here\n            filter.sectionname = $(SELECTOR.SECTION).find(`option:selected`).text();\n            filter.activityname = $(SELECTOR.MODULE).find(`option:selected`).text();\n            filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n\n            PROMISE.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n            \n        });\n\n        // Observer section change.\n        $('body').on('change', SELECTOR.SECTION, function() {\n            filter.section = $(this).val();\n            filter.module = 'all';\n            PROMISE.GET_FILTER_DATA(['module'], filter.course, filter.section)\n                .done(function(response) {\n                    response = JSON.parse(response);\n                    common.refreshFilter('module', response.module, SELECTOR.PAGE, function() {\n                        initializeDatatable();\n                    });\n                });\n            initializeDatatable();\n\n            // Fetching summary card data here\n            filter.sectionname = $(SELECTOR.SECTION).find(`option:selected`).text();\n            filter.activityname = $(SELECTOR.MODULE).find(`option:selected`).text();\n            filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n\n            PROMISE.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n\n            if(filter.section != 0){\n                $('.summary-footer-div:last-child').attr(\"style\", \"display: none !important\");\n            } else {\n                $('.summary-footer-div:last-child').attr(\"style\", \"display: flex !important\");\n            }\n\n        });\n\n        // Observer module change.\n        $('body').on('change', SELECTOR.MODULE, function() {\n            filter.module = $(this).val();\n            initializeDatatable();\n\n            // Fetching summary card data here\n            filter.sectionname = $(SELECTOR.SECTION).find(`option:selected`).text();\n            filter.activityname = $(SELECTOR.MODULE).find(`option:selected`).text();\n            filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n\n            PROMISE.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n        });\n\n        // Observer group change.\n        $('body').on('change', SELECTOR.GROUP, function() {\n            // Fetching summary card data here\n            filter.sectionname = $(SELECTOR.SECTION).find(`option:selected`).text();\n            filter.activityname = $(SELECTOR.MODULE).find(`option:selected`).text();\n\n            filter.group = $(this).val();\n            initializeDatatable();\n\n            filter.groupname = $(SELECTOR.GROUP).find(`option:selected`).text();\n\n            PROMISE.GET_SUMMARY_CARD_DATA(filter)\n            .done(function(response) {\n                response = JSON.parse(response);\n                common.refreshSummarycard('group', response, SELECTOR.SUMMARY, function() {\n                //     initializeDatatable();\n                });\n            });\n        });\n\n        // Observer exclude change.\n        $('body').on('change', SELECTOR.EXCLUDE, function() {\n            filter.exclude = $(this).val();\n            $(this).toggleClass('notselected', filter.exclude.length == 0);\n            $(this).toggleClass('selected', filter.exclude.length != 0);\n            initializeDatatable();\n        });\n\n        // Search in table.\n        $('body').on('input', SELECTOR.SEARCH, function() {\n            dataTable.columns(0).search(this.value).draw();\n        });\n\n        // Observer length change.\n        $('body').on('change', SELECTOR.LENGTH, function() {\n            dataTable.page.len(this.value).draw();\n        });\n\n        initializeDatatable();\n        common.handleSearchInput();\n\n        // Handle report page capability manager.\n        common.handleReportCapability();\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n                init();\n            });\n        }\n    };\n\n});\n"],"file":"courseactivitiessummary.min.js"}
