"use strict";define("local_edwiserreports/reports/studentengagement",["jquery","core/ajax","core/notification","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/select2","local_edwiserreports/flatpickr"],function(e,t,r,a,n){var o={PAGE:"#studentengagement",TABLE:"#studentengagement table",FORMFILTER:'#studentengagement .download-links [name="filter"]',COHORT:"#studentengagement .cohort-select",COURSE:"#studentengagement .course-select",INACTIVE:"#studentengagement .inactive-select",GROUP:"#studentengagement .group-select",SUMMARY:"#studentengagement .summary-card",SEARCH:"#studentengagement .table-search-input input",LENGTH:"#studentengagement .length-select",DATE:".edwiserreports-calendar",DATEMENU:".edwiserreports-calendar + .dropdown-menu",DATEITEM:".edwiserreports-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".edwiserreports-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".edwiserreports-calendar + .dropdown-menu .flatpickr"},s=null,l={inactive:"all",enrolment:"all",dir:e("html").attr("dir")},i=null,d={GET_DATA:function(t){return e.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_studentengagement_table_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:t})}})},GET_SUMMARY_CARD_DATA:function(e){return t.call([{methodname:"local_edwiserreports_get_summary_card_data",args:{report:"\\local_edwiserreports\\blocks\\studentengagement",filters:JSON.stringify(e)}}],!1)[0]}};function c(){var t=['<span class="success-tag">'.concat(M.util.get_string("active","local_edwiserreports"),"</span>"),'<span class="danger-tag">'.concat(M.util.get_string("suspended","local_edwiserreports"),"</span>")];s=e(o.TABLE).DataTable({paging:!0,processing:!0,serverSide:!0,rowId:"DT_RowId",scrollCollapse:!0,columnDefs:[{className:"fixed-column",targets:0},{className:"text-left",targets:[0,1,2]},{orderable:!0,targets:[0,1,2,3]},{className:"text-center",orderable:!1,targets:"_all"}],columns:[{data:"student",width:"12rem"},{data:"email"},{data:"status",render:function(e){return t[e]},width:"4rem"},{data:"lastaccesson",render:function(e){return console.log(e),e},width:"10rem"},{data:"enrolledcourses",width:"4rem"},{data:"inprogresscourses",width:"10rem"},{data:"completedcourses",width:"5rem"},{data:"completionprogress",width:"6rem"},{data:"totalgrade",width:"3rem"},{data:"timespentonlms",render:function(e){return a.timeFormatter(e)},width:"10rem"},{data:"timespentoncourse",render:function(e){return a.timeFormatter(e)},width:"10rem"},{data:"activitiescompleted",width:"5rem"},{data:"visitsoncourse",width:"10rem"},{data:"completedassignments",width:"6rem"},{data:"completedquizzes",width:"6rem"},{data:"completedscorms",width:"6rem"}],dom:'<"edwiserreports-table"i<t><"table-pagination"p>>',language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("emptytable","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:"&nbsp;",next:"&nbsp;"}},drawCallback:function(){a.stylePaginationButton(this)},ajax:function(t,n,s){a.loader.show(o.PAGE),e(o.FORMFILTER).val(JSON.stringify({cohort:e(o.COHORT).val(),course:e(o.COURSE).val(),group:e(o.GROUP).val(),inactive:e(o.INACTIVE).val(),enrolment:l.enrolment,dir:e("html").attr("dir")})),d.GET_DATA({cohort:e(o.COHORT).val(),course:e(o.COURSE).val(),group:e(o.GROUP).val(),length:e(o.LENGTH).val(),inactive:e(o.INACTIVE).val(),enrolment:l.enrolment,search:e(o.SEARCH).val(),start:t.start,order:t.order[0],dir:l.dir}).done(function(t){a.loader.hide(o.PAGE),n(t),setTimeout(function(){var t=e("html").attr("dir");void 0!==t&&!1!==t&&"rtl"==t&&(e(".edwiserreports-table .page-item.next a:before").css({"border-left":"11px solid transparent","border-bottom":"6px solid transparent","border-top":"6px solid transparent","border-left-color":"#ccc","border-right-width":"0px"}),e(".edwiserreports-table .page-item.previous a:before").css({"border-bottom":"6px solid transparent","border-top":"6px solid transparent","border-right":" 10px solid transparent","border-right-color":"#ccc","border-left-width":"0px"}))},1e3),e(".edwiserreports-table .page-item.next a").empty(),e(".edwiserreports-table .page-item.previous a").empty()}).fail(function(e){r.exception(e)}).always(function(){a.loader.hide(o.PAGE)})}})}function u(e,t,r,n){a.loader.show(o.PAGE),a.reloadFilter(o.PAGE,e,t,r,n,function(){null!==s?s.ajax.reload():c()})}function p(){a.updateTimeLabel("all"),e(o.PAGE).find(".singleselect").select2(),e("body").on("change",o.COHORT,function(){l.cohort=e(o.COHORT).val(),l.course=0,u(["course","group"],e(o.COHORT).val(),l.course,e(o.GROUP).val()),d.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),a.refreshSummarycard("group",e,o.SUMMARY,function(){})})}),i=e(o.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d M Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(o.DATEPICKER).get(0),onOpen:function(){e(o.DATEMENU).addClass("withcalendar"),setTimeout(function(){e(o.DATEMENU).offset().left<e(o.PAGE).parent().offset().left&&e(o.DATEMENU).css("left",e(o.DATEMENU).closest(".filter-selector").css("padding-left"))},500)},onChange:function(){e(o.DATEMENU).offset().left<e(o.PAGE).parent().offset().left&&e(o.DATEMENU).css("left",e(o.DATEMENU).closest(".filter-selector").css("padding-left"))},onClose:function(){e(o.DATEMENU).removeClass("withcalendar"),function(){var t=e(o.DATEPICKERINPUT).val(),r=e(o.DATEPICKERINPUT).next().val().replace("to","-"),n=r.split("-");if("rtl"==l.dir){var u=n[0].split(" "),p=n[1].split(" ");u=u[2]+" "+u[1]+" "+u[0],r=(p=p[3]+" "+p[2]+" "+p[1])+"-"+u,e(o.DATE).css({direction:"ltr","text-align":"right"}),e(o.DATEPICKERINPUT).css({direction:"ltr","text-align":"right"})}e(o.DATEPICKERINPUT).next().val(r),t.includes(" to ")?(e(o.DATEITEM).removeClass("active"),e(o.DATEITEM+".custom").addClass("active"),e(o.DATE).html(r),l.enrolment=t,d.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),a.refreshSummarycard("group",e,o.SUMMARY,function(){})}),null!==s?(s.ajax.reload(),a.updateTimeLabel(t)):c()):i.clear()}()}}),e("body").on("click",o.DATEITEM+":not(.custom)",function(){e(o.DATEITEM).removeClass("active"),e(this).addClass("active"),e(o.DATE).html(e(this).text()),i.clear(),l.enrolment=e(this).data("value"),d.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),a.refreshSummarycard("group",e,o.SUMMARY,function(){})}),null!==s?(s.ajax.reload(),a.updateTimeLabel(l.enrolment)):c()}),e("body").on("change",o.COURSE,function(){l.course=e(o.COURSE).val(),d.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),a.refreshSummarycard("group",e,o.SUMMARY,function(){})});var t=0==e(this).val();s.column(4).visible(t),s.column(5).visible(t),s.column(6).visible(t),u(["group"],e(o.COHORT).val(),e(o.COURSE).val(),e(o.GROUP).val())}),e("body").on("change",o.GROUP,function(){l.group=e(o.GROUP).val(),d.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),a.refreshSummarycard("group",e,o.SUMMARY,function(){})}),null!==s?s.ajax.reload():c()}),e("body").on("input",o.SEARCH,function(){s.search(this.value).draw()}),e("body").on("change",o.INACTIVE,function(){l.inactive=e(this).val(),null!==s?s.ajax.reload():c()}),e("body").on("change",o.LENGTH,function(){null!==s?(s.page.len(this.value),s.ajax.reload()):c()}),c(),a.handleSearchInput()}return{init:function(){e(document).ready(function(){p()})}}});
//# sourceMappingURL=studentengagement.min.js.map
