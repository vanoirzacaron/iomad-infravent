"use strict";define("local_edwiserreports/reports/learnercourseprogress",["jquery","core/ajax","core/notification","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/select2","local_edwiserreports/flatpickr"],function(e,t,r,a,n){var s={PAGE:"#learnercourseprogress",SEARCH:"#learnercourseprogress .table-search-input input",LENGTH:"#learnercourseprogress .length-select",LEARNER:"#learnercourseprogress .student-select",SUMMARY:"#learnercourseprogress .summary-card",TABLE:"#learnercourseprogress table",FORMFILTER:'#learnercourseprogress .download-links [name="filter"]',DATE:".edwiserreports-calendar",DATEMENU:".edwiserreports-calendar + .dropdown-menu",DATEITEM:".edwiserreports-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".edwiserreports-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".edwiserreports-calendar + .dropdown-menu .flatpickr"},o=null,l=null,i={enrolment:"all",dir:e("html").attr("dir")},c={GET_DATA:function(t){return e.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_learnercourseprogress_data",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify(t)}})},GET_SUMMARY_CARD_DATA:function(e){return t.call([{methodname:"local_edwiserreports_get_summary_card_data",args:{report:"\\local_edwiserreports\\reports\\learnercourseprogress",filters:JSON.stringify(e)}}],!1)[0]}};function d(){a.loader.show(s.PAGE),learner||(i.dir=e("html").attr("dir"),e(s.FORMFILTER).val(JSON.stringify(i)));var t=['<span class="danger-tag">'.concat(M.util.get_string("notyetstarted","core_completion"),"</span>"),'<span class="success-tag">'.concat(M.util.get_string("completed","core_completion"),"</span>"),'<span class="warning-tag">'.concat(M.util.get_string("inprogress","core_completion"),"</span>")];c.GET_DATA(i).done(function(r){null!==l&&(l.destroy(),l=null);var n=M.util.get_string("never","local_edwiserreports");(l=e(s.TABLE).DataTable({data:r,paging:!0,deferRendering:!0,columnDefs:[{className:"fixed-column",targets:0},{className:"text-left",targets:[0,1]},{className:"text-center",targets:"_all"}],columns:[{data:"course",render:function(e){return'<span class="ed-reports-large-column">'+e+"</span>"},width:"12rem"},{data:"status",render:function(e){return t[e]},width:"4rem"},{data:"enrolledon",render:function(t){var r=a.formatDate(new Date(1e3*t),"d MMM yyyy");return("rtl"==e("html").attr("dir")?1:0)&&(r=a.formatDate(new Date(1e3*t),"yyyy MMM d")),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?"-":r)+"</p>"},width:"10rem"},{data:"completedon",render:function(t){var r=a.formatDate(new Date(1e3*t),"d MMM yyyy");return("rtl"==e("html").attr("dir")?1:0)&&(r=a.formatDate(new Date(1e3*t),"yyyy MMM d")),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?"-":r)+"</p>"},width:"10rem"},{data:"lastaccess",render:function(t){var r=a.formatDate(new Date(1e3*t),"d MMM yyyy hh:mm TT").substring(0,11)+"<br>"+a.formatDate(new Date(1e3*t),"d MMM yyyy hh:mm TT").substring(11,20);return("rtl"==e("html").attr("dir")?1:0)&&(r=a.formatDate(new Date(1e3*t),"TT mm:hh yyyy MMM d").substring(8,20)+"<br>"+a.formatDate(new Date(1e3*t),"TT mm:hh yyyy MMM d").substring(0,8)),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?n:r)+"</p>"},width:"10rem"},{data:"progress"},{data:"grade"},{data:"totalactivities",width:"5rem"},{data:"completedactivities",width:"6rem"},{data:"attemptedactivities",width:"6rem"},{data:"visits"},{data:"timespent",render:function(e){return a.timeFormatter(e)}}],dom:'<"edwiserreports-table"i<t><"table-pagination"p>>',language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("emptytable","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},drawCallback:function(){a.stylePaginationButton(this),a.loader.hide(s.PAGE)}})).columns(0).search(e(s.SEARCH).val()),l.page.len(e(s.LENGTH).val()).draw()}).fail(function(e){r.exception(e),a.loader.hide(s.PAGE)})}function p(){a.updateTimeLabel("all"),learner||(i=JSON.parse(e(s.FORMFILTER).val())),e(s.PAGE).find(".singleselect").select2(),o=e(s.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d M Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(s.DATEPICKER).get(0),onOpen:function(){e(s.DATEMENU).addClass("withcalendar"),setTimeout(function(){e(s.DATEMENU).offset().left<e(s.PAGE).parent().offset().left&&e(s.DATEMENU).css("left",e(s.DATEMENU).closest(".filter-selector").css("padding-left"))},500)},onChange:function(){e(s.DATEMENU).offset().left<e(s.PAGE).parent().offset().left&&e(s.DATEMENU).css("left",e(s.DATEMENU).closest(".filter-selector").css("padding-left"))},onClose:function(){e(s.DATEMENU).removeClass("withcalendar"),function(){var t=e(s.DATEPICKERINPUT).val(),r=e(s.DATEPICKERINPUT).next().val().replace("to","-"),n=r.split("-");if("rtl"==i.dir){var l=n[0].split(" "),p=n[1].split(" ");l=l[2]+" "+l[1]+" "+l[0],r=(p=p[3]+" "+p[2]+" "+p[1])+"-"+l,e(s.DATE).css({direction:"ltr","text-align":"right"}),e(s.DATEPICKERINPUT).css({direction:"ltr","text-align":"right"})}e(s.DATEPICKERINPUT).next().val(r),t.includes(" to ")?(e(s.DATEITEM).removeClass("active"),e(s.DATEITEM+".custom").addClass("active"),e(s.DATE).html(r),i.enrolment=t,c.GET_SUMMARY_CARD_DATA(i).done(function(e){e=JSON.parse(e),a.refreshSummarycard("group",e,s.SUMMARY,function(){})}),d(),a.updateTimeLabel(t)):o.clear()}()}}),e("body").on("click",s.DATEITEM+":not(.custom)",function(){e(s.DATEITEM).removeClass("active"),e(this).addClass("active"),e(s.DATE).html(e(this).text()),o.clear(),i.enrolment=e(this).data("value"),c.GET_SUMMARY_CARD_DATA(i).done(function(e){e=JSON.parse(e),a.refreshSummarycard("group",e,s.SUMMARY,function(){})}),d(),a.updateTimeLabel(i.enrolment)}),learner||e("body").on("change",s.LEARNER,function(){i.learner=e(this).val(),c.GET_SUMMARY_CARD_DATA(i).done(function(e){e=JSON.parse(e),a.refreshSummarycard("group",e,s.SUMMARY,function(){})}),d()}),e("body").on("input",s.SEARCH,function(){l.column(0).search(this.value).draw()}),e("body").on("change",s.LENGTH,function(){l.page.len(this.value).draw()}),d(),a.handleSearchInput(),a.handleReportCapability()}return{init:function(){e(document).ready(function(){p()})}}});
//# sourceMappingURL=learnercourseprogress.min.js.map
