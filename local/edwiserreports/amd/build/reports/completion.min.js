"use strict";define("local_edwiserreports/reports/completion",["jquery","core/ajax","core/notification","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/select2","local_edwiserreports/flatpickr"],function(e,t,r,n,o){var a={PAGE:".report-content",EXPORT:".report-export",COHORT:".report-content .cohort-select",COURSE:".report-content .course-select",GROUP:".report-content .group-select",EXCLUDE:".report-content .exclude-select",INACTIVE:".report-content .inactive-select",PROGRESS:".report-content .progress-select",GRADE:".report-content .grade-select",LENGTH:".report-content .length-select",SEARCH:".report-content .table-search-input input",PAGETITLE:".report-header .page-title h2",FORMFILTER:'.report-content .download-links [name="filter"]',DATE:".edwiserreports-calendar",DATEMENU:".edwiserreports-calendar + .dropdown-menu",DATEITEM:".edwiserreports-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".edwiserreports-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".edwiserreports-calendar + .dropdown-menu .flatpickr",SUMMARY:"#wdm-completion-individual .summary-card"},l={cohort:0,course:null,group:0,exclude:[],enrolment:"all",inactive:"all",progress:"all",grade:"all",groupname:"",cohortname:"",dir:e("html").attr("dir")},s=null,i=null,c={GET_DATA:function(){return e.ajax({url:o.requestUrl,type:o.requestType,dataType:o.requestDataType,data:{action:"get_completion_data_ajax",sesskey:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify(l)}})},GET_SUMMARY_CARD_DATA:function(e){return t.call([{methodname:"local_edwiserreports_get_summary_card_data",args:{report:"\\local_edwiserreports\\blocks\\completionblock",filters:JSON.stringify(e)}}],!1)[0]}};function d(){n.loader.show(a.PAGE),l.dir=e("html").attr("dir"),e(a.FORMFILTER).val(JSON.stringify(l)),e(a.PAGE).find('.download-links input[name="filter"]').val(JSON.stringify(l));var t=['<span class="danger-tag">'.concat(M.util.get_string("notyetstarted","core_completion"),"</span>"),'<span class="success-tag">'.concat(M.util.get_string("completed","core_completion"),"</span>"),'<span class="warning-tag">'.concat(M.util.get_string("inprogress","core_completion"),"</span>")],o=M.util.get_string("never","local_edwiserreports");c.GET_DATA(l).done(function(r){null!=i&&i.destroy(),e(a.PAGETITLE).text(r.name),(i=e(a.PAGE).find(".table").DataTable({dom:'<"edwiserreports-table"<"table-filter d-flex"i><t><"table-pagination"p>>',data:r.data,pageLength:e(a.LENGTH).val(),deferRendering:!0,language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nostudentsenrolled","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},columnDefs:[{className:"fixed-column",targets:0},{className:"text-left",targets:[0,1,2]},{className:"text-center",targets:"_all"}],columns:[{data:"learner",width:"12rem"},{data:"email"},{data:"status",render:function(e){return t[e]},width:"4rem"},{data:"enrolledon",render:function(t){var r=n.formatDate(new Date(1e3*t),"d MMM yyyy");return("rtl"==e("html").attr("dir")?1:0)&&(r=n.formatDate(new Date(1e3*t),"yyyy MMM d")),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?"-":r)+"</p>"},width:"10rem"},{data:"completedon",render:function(t){var r=n.formatDate(new Date(1e3*t),"d MMM yyyy");return("rtl"==e("html").attr("dir")?1:0)&&(r=n.formatDate(new Date(1e3*t),"yyyy MMM d")),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?"-":r)+"</p>"},width:"10rem"},{data:"lastaccess",render:function(t){var r=n.formatDate(new Date(1e3*t),"d MMM yyyy hh:mm TT").substring(0,11)+"<br>"+n.formatDate(new Date(1e3*t),"d MMM yyyy hh:mm TT").substring(11,20);return("rtl"==e("html").attr("dir")?1:0)&&(r=n.formatDate(new Date(1e3*t),"TT mm:hh yyyy MMM d").substring(8,20)+"<br>"+n.formatDate(new Date(1e3*t),"TT mm:hh yyyy MMM d").substring(0,8)),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?o:r)+"</p>"},width:"10rem"},{data:"progress"},{data:"grade"},{data:"completedactivities",width:"5rem"},{data:"assignment",width:"6rem"},{data:"quiz",width:"5rem"},{data:"scorm",width:"5rem"},{data:"visits",width:"2rem"},{data:"timespent",render:function(e){return n.timeFormatter(e)}}],drawCallback:function(){n.stylePaginationButton(this)},initComplete:function(){n.loader.hide(a.PAGE)}})).columns(0).search(e(a.SEARCH).val()),i.page.len(e(a.LENGTH).val()).draw()}).fail(function(e){r.exception(e),n.loader.hide(a.PAGE)})}function u(e,t,r,o){n.loader.show(a.PAGE),n.reloadFilter(a.PAGE,e,t,r,0,o)}function p(t){l.dir=e("html").attr("dir"),n.updateTimeLabel("all"),n.handleSearchInput(),e(a.PAGE).find(".singleselect").not(a.EXCLUDE).select2(),e(a.EXCLUDE).select2({placeholder:M.util.get_string("exclude","local_edwiserreports"),allowClear:!0}),s=e(a.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d M Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(a.DATEPICKER).get(0),onOpen:function(){e(a.DATEMENU).addClass("withcalendar"),setTimeout(function(){e(a.DATEMENU).offset().left<e(a.PAGE).parent().offset().left&&e(a.DATEMENU).css("left",e(a.DATEMENU).closest(".filter-selector").css("padding-left"))},500)},onChange:function(){e(a.DATEMENU).offset().left<e(a.PAGE).parent().offset().left&&e(a.DATEMENU).css("left",e(a.DATEMENU).closest(".filter-selector").css("padding-left"))},onClose:function(){e(a.DATEMENU).removeClass("withcalendar"),function(){var t=e(a.DATEPICKERINPUT).val(),r=e(a.DATEPICKERINPUT).next().val().replace("to","-"),o=r.split("-");if("rtl"==l.dir){var i=o[0].split(" "),u=o[1].split(" ");i=i[2]+" "+i[1]+" "+i[0],r=(u=u[3]+" "+u[2]+" "+u[1])+"-"+i,e(a.DATE).css({direction:"ltr","text-align":"right"}),e(a.DATEPICKERINPUT).css({direction:"ltr","text-align":"right"})}e(a.DATEPICKERINPUT).next().val(r),t.includes(" to ")?(e(a.DATEITEM).removeClass("active"),e(a.DATEITEM+".custom").addClass("active"),e(a.DATE).html(r),l.enrolment=t,l.groupname=e(a.GROUP).find("option:selected").text(),l.cohortname=e(a.COHORT).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),n.refreshSummarycard("group",e,a.SUMMARY,function(){})}),d(),n.updateTimeLabel(t)):s.clear()}()}}),e("body").on("click",a.DATEITEM+":not(.custom)",function(){e(a.DATEITEM).removeClass("active"),e(this).addClass("active"),e(a.DATE).html(e(this).text()),s.clear(),l.enrolment=e(this).data("value"),l.groupname=e(a.GROUP).find("option:selected").text(),l.cohortname=e(a.COHORT).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),n.refreshSummarycard("group",e,a.SUMMARY,function(){})}),d(),n.updateTimeLabel(l.enrolment)}),l.course=e(a.COURSE).val(),e("body").on("change",a.COHORT,function(){l.cohort=e(this).val(),l.group=0,u(["course","noallcourses"],l.cohort,l.course,function(){l.course=e(a.COURSE).find("option:first").attr("value"),u(["group"],l.cohort,l.course,function(){d(),l.groupname=e(a.GROUP).find("option:selected").text(),l.cohortname=e(a.COHORT).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),n.refreshSummarycard("group",e,a.SUMMARY,function(){})})})})}),e("body").on("change",a.COURSE,function(){l.course=e(this).val(),l.group=0,l.groupname=e(a.GROUP).find("option:selected").text(),l.cohortname=e(a.COHORT).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),n.refreshSummarycard("group",e,a.SUMMARY,function(){})}),u(["group"],l.cohort,l.course,function(){d()})}),e("body").on("change",a.GROUP,function(){l.group=e(this).val(),l.groupname=e(a.GROUP).find("option:selected").text(),l.cohortname=e(a.COHORT).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),n.refreshSummarycard("group",e,a.SUMMARY,function(){})}),d()}),e("body").on("change",a.LENGTH,function(){i.page.len(this.value).draw()}),e("body").on("input",a.SEARCH,function(){i.column(0).search(this.value).draw()}),e("body").on("change",a.EXCLUDE,function(){l.exclude=e(this).val(),e(this).toggleClass("notselected",0==l.exclude.length),e(this).toggleClass("selected",0!=l.exclude.length),e(a.INACTIVE).closest(".filter-selector").toggle(-1==l.exclude.indexOf("2")&&-1==l.exclude.indexOf("3")),d()}),e("body").on("change",a.PROGRESS,function(){l.progress=e(this).val(),d()}),e("body").on("change",a.INACTIVE,function(){l.inactive=e(this).val(),d()}),e("body").on("change",a.GRADE,function(){l.grade=e(this).val(),d()}),d()}return{init:function(t){e(document).ready(function(){p()})}}});
//# sourceMappingURL=completion.min.js.map
