{"version":3,"sources":["reports/allcoursessummary.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","toPrimitive","undefined","res","call","TypeError","Number","define","$","Ajax","Notification","ModalFactory","ModalEvents","Fragment","CFG","common","SELECTOR","PAGE","TABLE","FORMFILTER","COHORT","EXCLUDE","GROUP","SEARCH","LENGTH","MODALTRIGGER","MODALSEARCH","DATE","DATEMENU","DATEITEM","DATEPICKER","DATEPICKERINPUT","flatpickr","dataTable","filter","cohort","coursegroup","exclude","enrolment","dir","attr","rtl","PROMISE","GET_DATA","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","JSON","stringify","GET_FILTER_DATA","types","cohortid","methodname","args","initializeDatatable","val","loader","show","destroy","then","response","_$$DataTable","DataTable","dom","columnDefs","className","targets","columns","render","width","timeFormatter","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","stylePaginationButton","this","hide","search","page","len","draw","fail","ex","exception","modalTable","_init","updateTimeLabel","find","not","select2","placeholder","allowClear","handleSearchInput","on","column","done","parse","refreshFilter","toggleClass","length","mode","altInput","altFormat","dateFormat","maxDate","appendTo","get","onOpen","addClass","setTimeout","offset","left","parent","css","closest","onChange","onClose","removeClass","date","dateAlternate","replace","stringarr","split","startdate","enddate","direction","text-align","includes","html","clear","customDateSelected","text","_this","ModalRoot","group","create","body","loadFragment","minval","maxval","course","modal","getRoot","getBody","setTitle","hidden","bodyRendered","ModalTable","hasClass","empty","language","drawCallback","lengthChange","handleReportCapability","init","document","ready"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * All courses summary report page.\n *\n * @package     local_edwiserreports\n * @author      Yogesh Shirsath\n * @copyright   2022 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine('local_edwiserreports/reports/allcoursessummary', [\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/fragment',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/common',\n    'local_edwiserreports/jquery.dataTables',\n    'local_edwiserreports/dataTables.bootstrap4',\n    'local_edwiserreports/select2',\n    'local_edwiserreports/flatpickr'\n\n], function($, Ajax, Notification, ModalFactory, ModalEvents, Fragment, CFG, common) {\n\n    /**\n     * Selector\n     */\n    var SELECTOR = {\n        PAGE: '#allcoursessummary',\n        TABLE: '#allcoursessummary table',\n        FORMFILTER: '#allcoursessummary .download-links [name=\"filter\"]',\n        COHORT: '#allcoursessummary .cohort-select',\n        EXCLUDE: '#allcoursessummary .exclude-select',\n        GROUP: '#allcoursessummary .group-select',\n        SEARCH: '#allcoursessummary .table-search-input input',\n        LENGTH: '#allcoursessummary .length-select',\n        MODALTRIGGER: '#allcoursessummary table a.modal-trigger',\n        MODALSEARCH: '.allcoursessummary-modal .table-search-input input',\n        DATE: '.edwiserreports-calendar',\n        DATEMENU: '.edwiserreports-calendar + .dropdown-menu',\n        DATEITEM: '.edwiserreports-calendar + .dropdown-menu .dropdown-item',\n        DATEPICKER: '.edwiserreports-calendar + .dropdown-menu .dropdown-calendar',\n        DATEPICKERINPUT: '.edwiserreports-calendar + .dropdown-menu .flatpickr'\n    };\n\n    /**\n     * Flat picker object.\n     */\n    let flatpickr = null;\n\n\n    /**\n     * Datatable object.\n     */\n    var dataTable = null;\n\n    /**\n     * Filters\n     */\n    var filter = {\n        cohort: 0,\n        coursegroup: 0,\n        exclude: [],\n        enrolment: 'all',\n        dir: $('html').attr('dir'),\n        rtl: $('html').attr('dir') == 'rtl' ? 1 : 0\n    };\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get all courses summary table data based on filters.\n         * @returns {PROMISE}\n         */\n        GET_DATA: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_allcoursessummary_data',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify(filter)\n                },\n            });\n        },\n\n        /**\n         * Get filter data.\n         *\n         * @param {Array}   types       Type of filters to get\n         * @param {Integer} cohortid    Cohort id\n         * @returns {PROMISE}\n         */\n        GET_FILTER_DATA: function(types, cohortid) {\n            return Ajax.call([{\n                methodname: 'local_edwiserreports_get_filter_data',\n                args: {\n                    types: types,\n                    cohort: cohortid\n                }\n            }], false)[0];\n        }\n    }\n\n    /**\n     * After Select Custom date get active users details.\n     */\n    function customDateSelected() {\n        let date = $(SELECTOR.DATEPICKERINPUT).val(); // Y-m-d format\n        let dateAlternate = $(SELECTOR.DATEPICKERINPUT).next().val().replace(\"to\", \"-\"); // d M Y format\n        // RTL support\n        // Split string in 2 parts\n        let stringarr = dateAlternate.split('-');\n        // Formating date for rtl\n        if(filter.dir == 'rtl'){\n            // format for rtl : yyyy mm dd\n            let startdate = stringarr[0].split(' ');\n            let enddate = stringarr[1].split(' ');\n\n            startdate = startdate[2] + ' ' + startdate[1] + ' ' + startdate[0];\n            enddate = enddate[3] + ' ' + enddate[2] + ' ' + enddate[1];\n            dateAlternate = enddate + '-' + startdate;\n\n            // Making direction ltr for date selector and aligning text to right\n            $(SELECTOR.DATE).css({'direction':'ltr','text-align': 'right'});\n            $(SELECTOR.DATEPICKERINPUT).css({'direction':'ltr','text-align': 'right'});\n        }\n\n        $(SELECTOR.DATEPICKERINPUT).next().val(dateAlternate);\n\n        /* If correct date is not selected then return false */\n        if (!date.includes(\" to \")) {\n            flatpickr.clear();\n            return;\n        }\n\n        // Set active class to custom date selector item.\n        $(SELECTOR.DATEITEM).removeClass('active');\n        $(SELECTOR.DATEITEM + '.custom').addClass('active');\n\n        // Show custom date to dropdown button.\n        $(SELECTOR.DATE).html(dateAlternate);\n\n        filter.enrolment = date;\n        initializeDatatable();\n        common.updateTimeLabel(date);\n    }\n\n    /**\n     * ----------\n     *  END - Functions added for date selector\n     * -----------\n     */\n\n\n\n    /**\n     * Generate course progress table\n     */\n    function initializeDatatable() {\n        $(SELECTOR.FORMFILTER).val(JSON.stringify(filter));\n        common.loader.show(SELECTOR.PAGE);\n        if (dataTable !== null) {\n            dataTable.destroy();\n        }\n\n        // Fetch data using ajax.\n        PROMISE.GET_DATA(filter).then(function(response) {\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    data: response,\n                    dom: '<\"edwiserreports-table\"<\"p-2\"i><t><\"table-pagination\"p>>',\n                    columnDefs: [\n                        { className: \"fixed-column\", targets: 0 },\n                        { className: \"text-left\", targets: [0, 1, 2] },\n                        { className: \"text-center\", targets: \"_all\" }\n                    ],\n                    columns: [\n                        {\n                            data: \"coursename\",\n                            render: function(data) {\n                                return '<span class=\"ed-reports-large-column\">' + data + '</span>';\n                            },\n                            width: \"14rem\"\n                        },\n                        { \"data\": \"category\", width: \"14rem\" },\n                        { \"data\": \"enrolments\" },\n                        { \"data\": \"completed\" },\n                        { \"data\": \"notstarted\" },\n                        { \"data\": \"inprogress\" },\n                        { \"data\": \"atleastoneactivitystarted\", width: \"12rem\" },\n                        { \"data\": \"totalactivities\", width: \"5rem\" },\n                        { \"data\": \"avgprogress\", width: \"6rem\" },\n                        { \"data\": \"avggrade\", width: \"4rem\" },\n                        { \"data\": \"highestgrade\", width: \"4rem\" },\n                        { \"data\": \"lowestgrade\", width: \"4rem\" },\n                        {\n                            data: \"totaltimespent\",\n                            render: function(data) {\n                                return common.timeFormatter(data, [], filter.rtl);\n                            },\n                            width: \"10rem\"\n                        },\n                        {\n                            data: \"avgtimespent\",\n                            render: function(data) {\n                                return common.timeFormatter(data, [], filter.rtl);\n                            },\n                            width: \"10rem\"\n                        }\n                    ],\n                    columnDefs: [\n                        { className: \"fixed-column\", targets: 0 },\n                        { className: \"text-left\", targets: [0, 1] },\n                        { className: \"text-right\", targets: \"_all\" }\n                    ],\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('nocourses', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: \" \",\n                            next: \" \"\n                        }\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                    },\n                    initComplete: function() {\n                        common.loader.hide(SELECTOR.PAGE);\n                    }\n                });\n                dataTable.columns(0).search($(SELECTOR.SEARCH).val());\n                dataTable.page.len($(SELECTOR.LENGTH).val()).draw();\n            })\n            .fail(function(ex) {\n                Notification.exception(ex);\n                common.loader.hide(SELECTOR.PAGE);\n            });\n    }\n\n    /**\n     * Modal table.\n     */\n    var modalTable = null;\n\n    /**\n     * Initialize\n     */\n    function init() {\n\n        // Show time period in table info.\n        common.updateTimeLabel('all');\n\n        // Initialize select2.\n        $(SELECTOR.PAGE).find('.singleselect').not(SELECTOR.EXCLUDE).select2();\n        $(SELECTOR.EXCLUDE).select2({\n            placeholder: M.util.get_string('exclude', 'local_edwiserreports'),\n            allowClear: true\n        });\n\n        // Handle search input highlight.\n        common.handleSearchInput();\n\n        // Generate table.\n        initializeDatatable();\n\n        // Observer length change.\n        $('body').on('change', SELECTOR.LENGTH, function() {\n            dataTable.page.len(this.value).draw();\n        });\n\n        // Search in table.\n        $('body').on('input', SELECTOR.SEARCH, function() {\n            dataTable.column(0).search(this.value).draw();\n        });\n\n        // Search in modal table.\n        $('body').on('input', SELECTOR.MODALSEARCH, function() {\n            modalTable.search(this.value).draw();\n        });\n\n        // Observer cohort change.\n        $('body').on('change', SELECTOR.COHORT, function() {\n            filter.cohort = $(this).val();\n            filter.coursegroup = 0;\n            PROMISE.GET_FILTER_DATA(['coursegroup'], filter.cohort)\n                .done(function(response) {\n                    response = JSON.parse(response);\n                    common.refreshFilter('group', response, SELECTOR.PAGE, function() {\n                        initializeDatatable();\n                    });\n                });\n        });\n\n        // Observer exclude change.\n        $('body').on('change', SELECTOR.EXCLUDE, function() {\n            filter.exclude = $(this).val();\n            $(this).toggleClass('notselected', filter.exclude.length == 0);\n            $(this).toggleClass('selected', filter.exclude.length != 0);\n            initializeDatatable();\n        });\n\n        flatpickr = $(SELECTOR.DATEPICKERINPUT).flatpickr({\n            mode: 'range',\n            altInput: true,\n            altFormat: \"d M Y\",\n            dateFormat: \"Y-m-d\",\n            maxDate: \"today\",\n            appendTo: $(SELECTOR.DATEPICKER).get(0),\n            onOpen: function() {\n                $(SELECTOR.DATEMENU).addClass('withcalendar');\n                setTimeout(function() {\n                    if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                        $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                    }\n                }, 500);\n            },\n            onChange: function() {\n                if ($(SELECTOR.DATEMENU).offset().left < $(SELECTOR.PAGE).parent().offset().left) {\n                    $(SELECTOR.DATEMENU).css('left', $(SELECTOR.DATEMENU).closest('.filter-selector').css('padding-left'));\n                }\n            },\n            onClose: function() {\n                $(SELECTOR.DATEMENU).removeClass('withcalendar');\n                customDateSelected();\n            }\n        });\n\n\n        /* Date selector listener */\n        $('body').on('click', SELECTOR.DATEITEM + \":not(.custom)\", function() {\n            // Set custom selected item as active.\n            $(SELECTOR.DATEITEM).removeClass('active');\n            $(this).addClass('active');\n\n            // Show selected item on dropdown button.\n            $(SELECTOR.DATE).html($(this).text());\n\n            // Clear custom date.\n            flatpickr.clear();\n\n            filter.enrolment = $(this).data('value');\n            initializeDatatable();\n            common.updateTimeLabel(filter.enrolment);\n        });\n\n        // Observer group change.\n        $('body').on('change', SELECTOR.GROUP, function() {\n            filter.coursegroup = $(this).val();\n            initializeDatatable();\n        });\n\n        // Open user list modal on number click.\n        $('body').on('click', SELECTOR.MODALTRIGGER, function() {\n            let _this = $(this);\n            let ModalRoot = null;\n            let coursegroup = $(SELECTOR.GROUP).length != 0 ? $(SELECTOR.GROUP).val() : '0,0';\n            let group = 0;\n            if (coursegroup == 0) {\n                group = 0;\n            } else {\n                coursegroup = coursegroup.split(',');\n                group = coursegroup[1];\n            }\n\n            // eslint-disable-next-line promise/catch-or-return\n            ModalFactory.create({\n                body: Fragment.loadFragment(\n                    'local_edwiserreports',\n                    'userslist',\n                    1, {\n                        page: 'allcoursessummary',\n                        minval: _this.data(\"minvalue\"),\n                        maxval: _this.data(\"maxvalue\"),\n                        course: _this.data(\"courseid\"),\n                        cohortid: filter.cohort,\n                        group: group\n                    }\n                )\n            }).then(function(modal) {\n                ModalRoot = modal.getRoot();\n                modal.getBody().addClass('allcoursessummary-modal');\n                ModalRoot.find('.modal-dialog').addClass('modal-lg');\n                modal.setTitle(_this.data(\"coursename\"));\n                modal.show();\n                ModalRoot.on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n\n                ModalRoot.on(ModalEvents.bodyRendered, function() {\n                    var ModalTable = ModalRoot.find(\".modal-table\");\n\n                    // If empty then remove colspan\n                    if (ModalTable.find(\"tbody\").hasClass(\"empty\")) {\n                        ModalTable.find(\"tbody\").empty();\n                    }\n\n                    // Create dataTable for userslist\n                    modalTable = ModalTable.DataTable({\n                        language: {\n                            info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                            infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                            emptyTable: M.util.get_string('nousers', 'local_edwiserreports'),\n                            zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                            paginate: {\n                                previous: \" \",\n                                next: \" \"\n                            }\n                        },\n                        dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n                        drawCallback: function() {\n                            common.stylePaginationButton(this);\n                        },\n                        lengthChange: false\n                    });\n                });\n                return;\n            });\n        });\n\n        // Handle report page capability manager.\n        common.handleReportCapability();\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n                init();\n            });\n        }\n    };\n\n});\n"],"file":"allcoursessummary.min.js"}
