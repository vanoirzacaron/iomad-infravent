"use strict";define("local_edwiserreports/reports/courseactivitiessummary",["jquery","core/notification","core/ajax","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/select2","local_edwiserreports/flatpickr"],function(e,t,a,r,n){var o={PAGE:"#courseactivitiessummary",SEARCH:"#courseactivitiessummary .table-search-input input",LENGTH:"#courseactivitiessummary .length-select",COURSE:"#courseactivitiessummary .course-select",GROUP:"#courseactivitiessummary .group-select",SECTION:"#courseactivitiessummary .section-select",SUMMARY:"#courseactivitiessummary .summary-card",MODULE:"#courseactivitiessummary .module-select",EXCLUDE:"#courseactivitiessummary .exclude-select",TABLE:"#courseactivitiessummary table",FORMFILTER:'#courseactivitiessummary .download-links [name="filter"]',DATE:".edwiserreports-calendar",DATEMENU:".edwiserreports-calendar + .dropdown-menu",DATEITEM:".edwiserreports-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".edwiserreports-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".edwiserreports-calendar + .dropdown-menu .flatpickr"},i=null,s=null,l={course:null,section:0,module:"all",group:0,exclude:[],enrolment:"all",sectionname:"",activityname:"",dir:e("html").attr("dir"),rtl:"rtl"==e("html").attr("dir")?1:0},c={GET_DATA:function(t){return e.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_courseactivitiessummary_data",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify(t)}})},GET_FILTER_DATA:function(e,t,r){return a.call([{methodname:"local_edwiserreports_get_filter_data",args:{types:e,course:t,section:r}}],!1)[0]},GET_SUMMARY_CARD_DATA:function(e){return a.call([{methodname:"local_edwiserreports_get_summary_card_data",args:{report:"\\local_edwiserreports\\reports\\courseactivitiessummary",filters:JSON.stringify(e)}}],!1)[0]}};function d(){l.dir=e("html").attr("dir"),e(o.FORMFILTER).val(JSON.stringify(l)),r.loader.show(o.PAGE),e("".concat(o.SEARCH,", ").concat(o.COURSE,", ").concat(o.EXCLUDE)).closest(".filter-selector").toggleClass("col-lg-4",3==e(o.PAGE).find(".filter-selector.d-none").length).toggleClass("col-lg-3",3!=e(o.PAGE).find(".filter-selector.d-none").length);var a=['<span class="danger-tag">'.concat(M.util.get_string("notyetstarted","core_completion"),"</span>"),'<span class="success-tag">'.concat(M.util.get_string("completed","core_completion"),"</span>"),'<span class="warning-tag">'.concat(M.util.get_string("inprogress","core_completion"),"</span>")];c.GET_DATA(l).done(function(t){null!==s&&(s.destroy(),s=null),(s=e(o.TABLE).DataTable({data:t,paging:!0,deferRendering:!0,columnDefs:[{className:"fixed-column",targets:0},{className:"text-left",targets:[0,1]},{className:"text-center",targets:"_all"}],columns:[{data:"activity",render:function(e){return'<span class="ed-reports-large-column">'+e+"</span>"},width:"14rem"},{data:"type"},{data:"status",render:function(e){return a[e]},width:"4rem"},{data:"learnerscompleted",width:"5rem"},{data:"completionrate",width:"6rem"},{data:"maxgrade",width:"3rem"},{data:"passgrade",width:"4rem"},{data:"averagegrade",width:"4rem"},{data:"highestgrade",width:"4rem"},{data:"lowestgrade",width:"4rem"},{data:"totaltimespent",render:function(e){return r.timeFormatter(e,[],l.rtl)},width:"10rem"},{data:"averagetimespent",render:function(e){return r.timeFormatter(e,[],l.rtl)},width:"10rem"},{data:"totalvisits",width:"3rem"},{data:"averagevisits",width:"4rem"}],dom:'<"edwiserreports-table"i<t><"table-pagination"p>>',language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("emptytable","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},drawCallback:function(){r.stylePaginationButton(this),r.loader.hide(o.PAGE)}})).columns(0).search(e(o.SEARCH).val()),s.page.len(e(o.LENGTH).val()).draw()}).fail(function(e){t.exception(e),r.loader.hide(o.PAGE)})}function u(){(l=JSON.parse(e(o.FORMFILTER).val())).rtl="rtl"==e("html").attr("dir")?1:0,r.updateTimeLabel("all"),"rtl"==l.dir&&e(".dropdown-item.custom").css({direction:"ltr","text-align":"right"}),e(o.PAGE).find(".singleselect").not(o.COURSE).not(o.EXCLUDE).select2(),e(o.COURSE).select2({templateResult:function(t){return t.id?e('<span class="pl-3 d-block">'+t.text+"</span>"):t.text}}),e(o.EXCLUDE).select2({placeholder:M.util.get_string("exclude","local_edwiserreports"),allowClear:!0}),i=e(o.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d M Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(o.DATEPICKER).get(0),onOpen:function(){e(o.DATEMENU).addClass("withcalendar"),setTimeout(function(){e(o.DATEMENU).offset().left<e(o.PAGE).parent().offset().left&&e(o.DATEMENU).css("left",e(o.DATEMENU).closest(".filter-selector").css("padding-left"))},500)},onChange:function(){e(o.DATEMENU).offset().left<e(o.PAGE).parent().offset().left&&e(o.DATEMENU).css("left",e(o.DATEMENU).closest(".filter-selector").css("padding-left"))},onClose:function(){e(o.DATEMENU).removeClass("withcalendar"),function(){var t=e(o.DATEPICKERINPUT).val(),a=e(o.DATEPICKERINPUT).next().val().replace("to","-"),n=a.split("-");if("rtl"==l.dir){var s=n[0].split(" "),u=n[1].split(" ");s=s[2]+" "+s[1]+" "+s[0],a=(u=u[3]+" "+u[2]+" "+u[1])+"-"+s,e(o.DATE).css({direction:"ltr","text-align":"right"}),e(".dropdown-item.custom").css({direction:"ltr","text-align":"right"})}e(o.DATEPICKERINPUT).next().val(a),t.includes(" to ")?(e(o.DATEITEM).removeClass("active"),e(o.DATEITEM+".custom").addClass("active"),e(o.DATE).html(a),l.enrolment=t,l.sectionname=e(o.SECTION).find("option:selected").text(),l.activityname=e(o.MODULE).find("option:selected").text(),l.groupname=e(o.GROUP).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,o.SUMMARY,function(){})}),d(),r.updateTimeLabel(t)):i.clear()}()}}),e("body").on("click",o.DATEITEM+":not(.custom)",function(){e(o.DATEITEM).removeClass("active"),e(this).addClass("active"),e(o.DATE).html(e(this).text()),i.clear(),l.enrolment=e(this).data("value"),l.sectionname=e(o.SECTION).find("option:selected").text(),l.activityname=e(o.MODULE).find("option:selected").text(),l.groupname=e(o.GROUP).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,o.SUMMARY,function(){})}),d(),r.updateTimeLabel(l.enrolment)}),e("body").on("change",o.COURSE,function(){var t,a;l.course=e(this).val(),l.section=0,l.module="all",l.group=0,t=["section","module","group"],a=l.course,r.loader.show(o.PAGE),r.reloadFilter(o.PAGE,t,0,a,0,function(){d()}),l.sectionname=e(o.SECTION).find("option:selected").text(),l.activityname=e(o.MODULE).find("option:selected").text(),l.groupname=e(o.GROUP).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,o.SUMMARY,function(){})})}),e("body").on("change",o.SECTION,function(){l.section=e(this).val(),l.module="all",c.GET_FILTER_DATA(["module"],l.course,l.section).done(function(e){e=JSON.parse(e),r.refreshFilter("module",e.module,o.PAGE,function(){d()})}),d(),l.sectionname=e(o.SECTION).find("option:selected").text(),l.activityname=e(o.MODULE).find("option:selected").text(),l.groupname=e(o.GROUP).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,o.SUMMARY,function(){})}),0!=l.section?e(".summary-footer-div:last-child").attr("style","display: none !important"):e(".summary-footer-div:last-child").attr("style","display: flex !important")}),e("body").on("change",o.MODULE,function(){l.module=e(this).val(),d(),l.sectionname=e(o.SECTION).find("option:selected").text(),l.activityname=e(o.MODULE).find("option:selected").text(),l.groupname=e(o.GROUP).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,o.SUMMARY,function(){})})}),e("body").on("change",o.GROUP,function(){l.sectionname=e(o.SECTION).find("option:selected").text(),l.activityname=e(o.MODULE).find("option:selected").text(),l.group=e(this).val(),d(),l.groupname=e(o.GROUP).find("option:selected").text(),c.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,o.SUMMARY,function(){})})}),e("body").on("change",o.EXCLUDE,function(){l.exclude=e(this).val(),e(this).toggleClass("notselected",0==l.exclude.length),e(this).toggleClass("selected",0!=l.exclude.length),d()}),e("body").on("input",o.SEARCH,function(){s.columns(0).search(this.value).draw()}),e("body").on("change",o.LENGTH,function(){s.page.len(this.value).draw()}),d(),r.handleSearchInput(),r.handleReportCapability()}return{init:function(){e(document).ready(function(){u()})}}});
//# sourceMappingURL=courseactivitiessummary.min.js.map
