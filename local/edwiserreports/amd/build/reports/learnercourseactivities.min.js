"use strict";define("local_edwiserreports/reports/learnercourseactivities",["jquery","core/notification","core/ajax","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/select2","local_edwiserreports/flatpickr"],function(e,t,a,r,s){var n={PAGE:"#learnercourseactivities",SEARCH:"#learnercourseactivities .table-search-input input",COURSE:"#learnercourseactivities .course-select",STUDENT:"#learnercourseactivities .student-select",SECTION:"#learnercourseactivities .section-select",MODULE:"#learnercourseactivities .module-select",SUMMARY:"#learnercourseactivities .summary-card",COMPLETION:"#learnercourseactivities .completion-select",LENGTH:"#learnercourseactivities .length-select",LEARNER:"#learnercourseactivities .student-select",TABLE:"#learnercourseactivities table",FORMFILTER:'#learnercourseactivities .download-links [name="filter"]',DATE:".edwiserreports-calendar",DATEMENU:".edwiserreports-calendar + .dropdown-menu",DATEITEM:".edwiserreports-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".edwiserreports-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".edwiserreports-calendar + .dropdown-menu .flatpickr"},c=null,l={learner:null,course:null,section:0,module:"all",completion:"all",enrolment:"all",dir:e("html").attr("dir"),rtl:"rtl"==e("html").attr("dir")?1:0},i={GET_DATA:function(t){return e.ajax({url:s.requestUrl,type:s.requestType,dataType:s.requestDataType,data:{action:"get_learnercourseactivities_data",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify(t)}})},GET_FILTER_DATA:function(e,t,r){return a.call([{methodname:"local_edwiserreports_get_filter_data",args:{types:e,course:t,section:r}}],!1)[0]},GET_SUMMARY_CARD_DATA:function(e){return a.call([{methodname:"local_edwiserreports_get_summary_card_data",args:{report:"\\local_edwiserreports\\reports\\learnercourseactivities",filters:JSON.stringify(e)}}],!1)[0]}};function o(){r.loader.show(n.PAGE),setTimeout(function(){var t="rtl"==e("html").attr("dir")?1:0;lastaccess=e(".learner-course-activties-lastaccess").data("date"),lastaccess=0==lastaccess?M.util.get_string("never","local_edwiserreports"):t?r.formatDate(new Date(1e3*lastaccess),"TT mm:hh  yyyy MMM d"):r.formatDate(new Date(1e3*lastaccess),"d MMM yyyy hh:mm TT"),e(".learner-course-activties-lastaccess").text(lastaccess),e(".learner-course-activties-lastaccess").css("display","inherit")},1500),l.dir=e("html").attr("dir"),e(n.FORMFILTER).val(JSON.stringify(l));var a=['<span class="danger-tag">'.concat(M.util.get_string("notyetstarted","core_completion"),"</span>"),'<span class="success-tag">'.concat(M.util.get_string("completed","core_completion"),"</span>"),'<span class="warning-tag">'.concat(M.util.get_string("inprogress","core_completion"),"</span>")];i.GET_DATA(l).done(function(t){null!==c&&(c.destroy(),c=null);var s=M.util.get_string("never","local_edwiserreports");(c=e(n.TABLE).DataTable({data:t,paging:!0,deferRendering:!0,columnDefs:[{className:"fixed-column",targets:0},{className:"text-left",targets:[0,1]},{className:"text-center",targets:"_all"}],columns:[{data:"activity",width:"14rem"},{data:"type"},{data:"status",render:function(e){return a[e]},width:"4rem"},{data:"completedon",render:function(t){var a=r.formatDate(new Date(1e3*t),"d MMM yyyy");return("rtl"==e("html").attr("dir")?1:0)&&(a=r.formatDate(new Date(1e3*t),"yyyy MMM d")),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?"-":a)+"</p>"},width:"10rem"},{data:"grade"},{data:"gradedon",render:function(t){var a=r.formatDate(new Date(1e3*t),"d MMM yyyy");return("rtl"==e("html").attr("dir")?1:0)&&(a=r.formatDate(new Date(1e3*t),"yyyy MMM d")),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?"-":a)+"</p>"},width:"10rem"},{data:"attempts"},{data:"highestgrade",width:"4rem"},{data:"lowestgrade",width:"4rem"},{data:"firstaccess",render:function(t){var a=r.formatDate(new Date(1e3*t),"d MMM yyyy hh:mm TT").substring(0,11)+"<br>"+r.formatDate(new Date(1e3*t),"d MMM yyyy hh:mm TT").substring(11,20);return("rtl"==e("html").attr("dir")?1:0)&&(a=r.formatDate(new Date(1e3*t),"TT mm:hh yyyy MMM d").substring(8,20)+"<br>"+r.formatDate(new Date(1e3*t),"TT mm:hh yyyy MMM d").substring(0,8)),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?s:a)+"</p>"},width:"10rem"},{data:"lastaccess",render:function(t){var a=r.formatDate(new Date(1e3*t),"d MMM yyyy hh:mm TT").substring(0,11)+"<br>"+r.formatDate(new Date(1e3*t),"d MMM yyyy hh:mm TT").substring(11,20);return("rtl"==e("html").attr("dir")?1:0)&&(a=r.formatDate(new Date(1e3*t),"TT mm:hh yyyy MMM d").substring(8,20)+"<br>"+r.formatDate(new Date(1e3*t),"TT mm:hh yyyy MMM d").substring(0,8)),'<p class="erp-time-rtl"><span class="d-none">'.concat(t,"</span>")+(0==t?s:a)+"</p>"},width:"10rem"},{data:"visits"},{data:"timespent",render:function(e){return r.timeFormatter(e)}}],dom:'<"edwiserreports-table"i<t><"table-pagination"p>>',language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("emptytable","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},drawCallback:function(){r.stylePaginationButton(this),r.loader.hide(n.PAGE)}})).columns(0).search(e(n.SEARCH).val()),c.page.len(e(n.LENGTH).val()).draw()}).fail(function(e){t.exception(e),r.loader.hide(n.PAGE)})}function d(){r.updateTimeLabel("all"),flatpickr=e(n.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d M Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(n.DATEPICKER).get(0),onOpen:function(){e(n.DATEMENU).addClass("withcalendar"),setTimeout(function(){e(n.DATEMENU).offset().left<e(n.PAGE).parent().offset().left&&e(n.DATEMENU).css("left",e(n.DATEMENU).closest(".filter-selector").css("padding-left"))},500)},onChange:function(){e(n.DATEMENU).offset().left<e(n.PAGE).parent().offset().left&&e(n.DATEMENU).css("left",e(n.DATEMENU).closest(".filter-selector").css("padding-left"))},onClose:function(){e(n.DATEMENU).removeClass("withcalendar"),function(){var t=e(n.DATEPICKERINPUT).val(),a=e(n.DATEPICKERINPUT).next().val().replace("to","-"),s=a.split("-");if("rtl"==l.dir){var c=s[0].split(" "),d=s[1].split(" ");c=c[2]+" "+c[1]+" "+c[0],a=(d=d[3]+" "+d[2]+" "+d[1])+"-"+c,e(n.DATE).css({direction:"ltr","text-align":"right"}),e(n.DATEPICKERINPUT).css({direction:"ltr","text-align":"right"})}e(n.DATEPICKERINPUT).next().val(a),t.includes(" to ")?(e(n.DATEITEM).removeClass("active"),e(n.DATEITEM+".custom").addClass("active"),e(n.DATE).html(a),l.enrolment=t,i.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,n.SUMMARY,function(){})}),o(),r.updateTimeLabel(t)):flatpickr.clear()}()}}),e("body").on("click",n.DATEITEM+":not(.custom)",function(){e(n.DATEITEM).removeClass("active"),e(this).addClass("active"),e(n.DATE).html(e(this).text()),flatpickr.clear(),l.enrolment=e(this).data("value"),i.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,n.SUMMARY,function(){})}),o(),r.updateTimeLabel(l.enrolment)}),l=JSON.parse(e(n.FORMFILTER).val()),e(n.COURSE).select2({templateResult:function(t){return t.id?e('<span class="pl-3 d-block">'+t.text+"</span>"):t.text}}),e(n.PAGE).find(".singleselect").not(n.COURSE).select2(),e("body").on("change",n.COURSE,function(){l.course=e(this).val(),l.section=0,l.module="all",l.learner=null,r.reloadFilter(n.PAGE,["student","section","module","noallusers"],0,l.course,0,function(){e(n.LEARNER).find("option:first-child").length&&(l.learner=e(n.LEARNER).find("option:first-child").attr("value")),o(),setTimeout(function(){i.GET_SUMMARY_CARD_DATA(l).done(function(t){t=JSON.parse(t),r.refreshSummarycard("group",t,n.SUMMARY,function(){var t="rtl"==e("html").attr("dir")?1:0;lastaccess=e(".learner-course-activties-lastaccess").data("date"),lastaccess=0==lastaccess?M.util.get_string("never","local_edwiserreports"):t?r.formatDate(new Date(1e3*lastaccess),"TT mm:hh  yyyy MMM d"):r.formatDate(new Date(1e3*lastaccess),"d MMM yyyy hh:mm TT"),e(".learner-course-activties-lastaccess").text(lastaccess),e(".learner-course-activties-lastaccess").css("display","inherit")})})},500),setTimeout(function(){lastaccess=e(".learner-course-activties-lastaccess").data("date"),lastaccess=0==lastaccess?M.util.get_string("never","local_edwiserreports"):rtl?r.formatDate(new Date(1e3*lastaccess),"TT mm:hh  yyyy MMM d"):r.formatDate(new Date(1e3*lastaccess),"d MMM yyyy hh:mm TT"),e(".learner-course-activties-lastaccess").text(lastaccess),e(".learner-course-activties-lastaccess").css("display","inherit")},1500)})}),e("body").on("change",n.LEARNER,function(){l.learner=e(this).val(),o(),setTimeout(function(){i.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,n.SUMMARY,function(){})})},500)}),e("body").on("change",n.SECTION,function(){l.section=e(this).val(),l.module="all",i.GET_FILTER_DATA(["module"],l.course,l.section).done(function(e){e=JSON.parse(e),r.refreshFilter("module",e.module,n.PAGE,function(){o()})}),o(),i.GET_SUMMARY_CARD_DATA(l).done(function(e){e=JSON.parse(e),r.refreshSummarycard("group",e,n.SUMMARY,function(){})}),setTimeout(function(){lastaccess=e(".learner-course-activties-lastaccess").data("date"),lastaccess=0==lastaccess?M.util.get_string("never","local_edwiserreports"):rtl?r.formatDate(new Date(1e3*lastaccess),"TT mm:hh  yyyy MMM d"):r.formatDate(new Date(1e3*lastaccess),"d MMM yyyy hh:mm TT"),e(".learner-course-activties-lastaccess").text(lastaccess),e(".learner-course-activties-lastaccess").css("display","inherit")},600)}),e("body").on("change",n.MODULE,function(){l.module=e(this).val(),o()}),e("body").on("change",n.COMPLETION,function(){l.completion=e(this).val(),o()}),e("body").on("input",n.SEARCH,function(){c.column(0).search(this.value).draw()}),e("body").on("change",n.LENGTH,function(){c.page.len(this.value).draw()}),o(),r.handleSearchInput(),r.handleReportCapability()}return{init:function(){e(document).ready(function(){d()})}}});
//# sourceMappingURL=learnercourseactivities.min.js.map
