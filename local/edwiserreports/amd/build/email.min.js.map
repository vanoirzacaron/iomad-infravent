{"version":3,"sources":["email.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","$","Notification","ModalFactory","Fragment","ModalEvents","common","v","emailListTable","formRoot","SELECTOR","DROPDOWNS","DROPDOWNSELECTOR","DURATIONSELECTOR","DURATIONINPUT","TIMESDROPDOWNBTN","TIMESDROPDOWNLINK","DAILYDROPDOWNBTN","WEEKLYDROPDOWNBTN","MONTHLYDROPDOWNBTN","TIMEINPUT","FORMATSELECTOR","EDITBTN","DELETEBTN","EMAILLISTTOGGLESWITCH","TABS","FORMTAB","FORMLISTTAB","LISTSEARCH","SCHEDULEDEMAILDROPDOWN","ID","NAME","SUBJECT","RECEPIENT","BLOCKNAME","REGION","FILTERDATA","FORMAT","GRAPHICAL","RESET","SAVE","SEND","emailRegex","renderAllScheduledEmails","data","modal","table","getRoot","find","document","on","window","resize","DataTable","ajax","url","requestUrl","sesskey","type","requestType","action","JSON","stringify","blockname","block","region","dom","language","info","M","util","get_string","infoEmpty","emptyTable","zeroRecords","sClass","paginate","previous","next","drawCallback","stylePaginationButton","this","order","columns","orderable","responsive","lengthChange","emailScheduleSettingInit","_this","root","id","done","response","parse","error","console","log","esrDurationVal","esrTimeVal","each","idx","val","click","prop","length","trigger","undefined","esrfilterdata","esrformat","format","subSelectedDropdpown","subDropdown","setEmailSheduleFormValues","removeClass","addClass","fail","exception","emailListInit","e","confirm","proxy","errorBox","loader","show","html","destroy","always","delay","fadeOut","hide","emailScheduleDeleteInit","currentTarget","switchElement","attr","errormsg","successmsg","changeScheduledEmailStatusInit","emailScheduleFormInit","text","dropdownBtn","closest","timeval","durationDropdownInit","form","esrname","esrsubject","valid","validateEmails","validateEmailScheduledForm","filter","cohortid","cfg","wwwroot","serialize","parseJSON","setTimeout","sendMailToUser","formats","index","element","emails","duplicate","highlight","arguments","domElement","get","duplicates","replaceAll","split","forEach","email","test","setCustomValidity","init","concat","name","recepient","subject","invalid","toggleClass","getScheduledEmailFormContext","graphical","is","formData","serializeArray","$k","$d","value","modalTitle","includes","create","title","body","loadFragment","bodyRendered","hidden","search","draw"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/notification',\n    'core/modal_factory',\n    'core/fragment',\n    'core/modal_events',\n    './common',\n    './variables'\n], function(\n    $,\n    Notification,\n    ModalFactory,\n    Fragment,\n    ModalEvents,\n    common,\n    v\n) {\n    var emailListTable = null;\n    /**\n     * Email Shcedule Modal Related Psrametres start\n     */\n    // Form root\n    var formRoot = '#scheduletab';\n\n    /**\n     * Selectors list.\n     */\n    var SELECTOR = {\n        // Dropdowns.\n        DROPDOWNS: formRoot + ' .dropdown a.dropdown-item',\n        DROPDOWNSELECTOR: 'button.dropdown-toggle',\n\n        // Duration dropdown selectors.\n        DURATIONSELECTOR: formRoot + ' .dropdown.duration-dropdown a.dropdown-item',\n        DURATIONINPUT: formRoot + ' input[name=\"esrduration\"]',\n\n        // Times dropdown selector.\n        TIMESDROPDOWNBTN: formRoot + ' .date-filters .dropdown:not(.duration-dropdown) button.dropdown-toggle',\n        TIMESDROPDOWNLINK: formRoot + ' .date-filters .dropdown:not(.duration-dropdown) a.dropdown-item',\n        DAILYDROPDOWNBTN: formRoot + ' .dropdown.daily-dropdown button.dropdown-toggle',\n        WEEKLYDROPDOWNBTN: formRoot + ' .dropdown.weekly-dropdown button.dropdown-toggle',\n        MONTHLYDROPDOWNBTN: formRoot + ' .dropdown.monthly-dropdown button.dropdown-toggle',\n        TIMEINPUT: formRoot + ' input[name=\"esrtime\"]',\n\n        // Format Dropdown.\n        FORMATSELECTOR: formRoot + ' .dropdown.format-dropdown a.dropdown-item',\n\n        // For email schedule setting.\n        EDITBTN: \"#listemailstab .esr-email-sched-edit\",\n        DELETEBTN: \"#listemailstab .esr-email-sched-delete\",\n        EMAILLISTTOGGLESWITCH: \"#listemailstab .esr-email-toggle\",\n\n        // Tabs.\n        TABS: '[data-plugin=\"tabs\"] .nav-link, [data-plugin=\"tabs\"] .tab-pane',\n        FORMTAB: '[aria-controls=\"scheduletab\"], #scheduletab',\n        FORMLISTTAB: '[href=\"#listemailstab\"]',\n        LISTSEARCH: '#listemailstab .table-search-input input',\n\n        // Schedule email dropdown.\n        SCHEDULEDEMAILDROPDOWN: '.download-links button[value=\"email\"]',\n\n        // Inputs.\n        ID: '[name=\"esrid\"]',\n        NAME: '[name=\"esrname\"]',\n        SUBJECT: '[name=\"esrsubject\"]',\n        RECEPIENT: '[name=\"esrrecepient\"]',\n        BLOCKNAME: '[name=\"blockname\"]',\n        REGION: '[name=\"region\"]',\n        FILTERDATA: '[name=\"esrfilterdata\"]',\n        FORMAT: '[name=\"esrformat\"]',\n        GRAPHICAL: '[name=\"esrgraphical\"]',\n\n        // Form actions.\n        RESET: '[data-action=\"reset\"]',\n        SAVE: '[data-action=\"save\"]',\n        SEND: '[data-action=\"send\"]'\n    };\n\n    // Regular expression for email validation.\n    var emailRegex = /^[a-zA-Z0-9]+[a-zA-Z0-9+_.-]+[a-zA-Z0-9]+@[a-zA-Z0-9]+[a-zA-Z0-9.-]*\\.[a-zA-Z]{2,}$/;\n\n    /**\n     * Render all emails in modal\n     * @param {object} data Data for datatable\n     * @param {Object} modal Modal object\n     * @return {Object} Datatable object\n     */\n    function renderAllScheduledEmails(data, modal) {\n        var table = modal.getRoot().find(\"#esr-shceduled-emails\");\n\n        // Resize event to adjust datatable when click on the all list tab\n        // Not able to call resize when ajax completed\n        // So got the temporary solution\n        $(document).on('click', SELECTOR.FORMLISTTAB, function() {\n            $(window).resize();\n        });\n\n        // Create datatable\n        return table.DataTable({\n            ajax: {\n                url: v.requestUrl + '?sesskey=' + data.sesskey,\n                type: v.requestType,\n                data: {\n                    action: 'get_scheduled_emails_ajax',\n                    data: JSON.stringify({\n                        blockname: data.block,\n                        region: data.region\n                    })\n                }\n            },\n            dom: '<\"edwiserreports-table\"i<t><\"table-pagination\"p>>',\n            language: {\n                info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                emptyTable: M.util.get_string('noscheduleemails', 'local_edwiserreports'),\n                zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                sClass: 'text-center',\n                paginate: {\n                    previous: \" \",\n                    next: \" \"\n                }\n            },\n            drawCallback: function() {\n                common.stylePaginationButton(this);\n            },\n            order: [\n                [2, \"asc\"]\n            ],\n            columns: [{\n                \"data\": \"esrname\",\n                \"orderable\": true\n            }, {\n                \"data\": \"esrnextrun\",\n                \"orderable\": true\n            }, {\n                \"data\": \"esrfrequency\",\n                \"orderable\": true\n            }, {\n                \"data\": \"esrmanage\",\n                \"orderable\": false\n            }],\n            responsive: true,\n            lengthChange: false,\n        });\n    }\n\n    /**\n     * Validate email shceduled form\n     * @param  {object} form Form object\n     * @param  {object} errorBox Box to show error\n     * @return {boolean} Return form validation status\n     */\n    function validateEmailScheduledForm(form, errorBox) {\n        var esrname = form.find(SELECTOR.NAME).val();\n        var esrsubject = form.find(SELECTOR.SUBJECT).val();\n        var valid = true;\n        if (esrname == \"\" || esrsubject == \"\") {\n            errorBox.html(M.util.get_string('emptyerrormsg', 'local_edwiserreports')).show();\n            valid = false;\n        }\n        if (!validateEmails(form.find(SELECTOR.RECEPIENT).val())) {\n            valid = false;\n            errorBox.html(M.util.get_string('emailinvaliderrormsg', 'local_edwiserreports')).show();\n        }\n        return valid;\n    }\n\n    /**\n     * Update dropdown button text\n     * @param  {object} _this click object\n     */\n    function updateDropdownBtnText(_this) {\n        var val = $(_this).data('value');\n        var text = $(_this).text();\n        var dropdownBtn = $(_this).closest(\".dropdown\").find(SELECTOR.DROPDOWNSELECTOR);\n\n        // Set button values\n        dropdownBtn.text(text);\n        dropdownBtn.data(\"value\", val);\n    }\n\n    /**\n     * Duration dropdown init\n     * @param {object} _this click object\n     * @param {Object} root Modal root obuject\n     */\n    function durationDropdownInit(_this, root) {\n        var val = $(_this).data('value');\n\n        root.find(SELECTOR.DURATIONINPUT).val(val);\n        $(SELECTOR.TIMESDROPDOWNBTN).hide();\n\n        // Show only selected dropdown\n        var subDropdown = null;\n        switch (val) {\n            case 1: // Weekly\n                subDropdown = $(SELECTOR.WEEKLYDROPDOWNBTN);\n                break;\n            case 2: // Monthly\n                subDropdown = $(SELECTOR.MONTHLYDROPDOWNBTN);\n                break;\n            default: // Daily\n                subDropdown = $(SELECTOR.DAILYDROPDOWNBTN);\n        }\n\n        // Show subdropdown\n        subDropdown.show();\n\n        // Set values to hidden input fieds\n        var timeval = subDropdown.data(\"value\");\n        $(SELECTOR.TIMEINPUT).val(timeval);\n    }\n\n    /**\n     * Email schedle setting session initialization\n     * @param {object} _this click object\n     * @param {Object} root Modal root obuject\n     */\n    function emailScheduleSettingInit(_this, root) {\n        var id = $(_this).data(\"id\");\n        var blockname = $(_this).data(\"blockname\");\n        var region = $(_this).data(\"region\");\n\n        $.ajax({\n            url: v.requestUrl,\n            type: v.requestType,\n            sesskey: $(_this).data(\"sesskey\"),\n            data: {\n                action: 'get_scheduled_email_detail_ajax',\n                sesskey: $(_this).data(\"sesskey\"),\n                data: JSON.stringify({\n                    id: id,\n                    blockname: blockname,\n                    region: region\n                })\n            }\n        }).done(function(response) {\n            response = JSON.parse(response);\n            if (!response.error) {\n                setEmailSheduleFormValues(response, _this, root);\n\n                root.find(SELECTOR.TABS).removeClass(\"active show\");\n                root.find(SELECTOR.FORMTAB).addClass(\"active show\");\n            } else {\n                console.log(response);\n            }\n        }).fail(Notification.exception);\n    }\n\n    /**\n     * Set email shcedule values in form\n     * @param {Object} response Response object\n     * @param {object} _this click object\n     * @param {Object} root Modal root obuject\n     */\n    function setEmailSheduleFormValues(response, _this, root) {\n        var esrDurationVal = null;\n        var esrTimeVal = null;\n\n        $.each(response.data, function(idx, val) {\n            if (typeof val === 'object') {\n                // Set block value name\n                root.find(SELECTOR.BLOCKNAME).val(val.blockname);\n                root.find(SELECTOR.REGION).val(val.region);\n                return;\n            }\n            switch (idx) {\n                case \"esrduration\":\n                    esrDurationVal = val;\n                    // Trigger click event\n                    root.find('.duration-dropdown .dropdown-item[data-value=\"' + val + '\"]').click();\n                case \"esrtime\":\n                    esrTimeVal = val;\n                    break;\n                case \"esremailenable\":\n                case \"esrfilterdata\":\n                    root.find('input[name=\"' + idx + '\"]').prop(\"checked\", val);\n                    break;\n                case \"esrformat\":\n                    root.find('.format-dropdown .dropdown-item[data-value=\"' + val + '\"]').click();\n                    break;\n                default:\n                    // Set values for input text.\n                    if (root.find('[name=\"' + idx + '\"]').val(val).length) {\n                        root.find('[name=\"' + idx + '\"]').trigger('input');\n                    }\n                    break;\n            }\n        });\n\n        // Handling newly added filterdata option.\n        if (response.data.esrfilterdata === undefined) {\n            root.find(SELECTOR.FILTERDATA).prop(\"checked\", true);\n        }\n\n        // Handling newly added filterdata option.\n        if (response.data.esrformat === undefined) {\n            let format = root.find(SELECTOR.GRAPHICAL).val() == 1 ? 'pdfimage' : 'csv';\n            root.find('.format-dropdown .dropdown-item[data-value=\"' + format + '\"]').click();\n        }\n\n        // Subdropdown click event\n        var subSelectedDropdpown = '.dropdown-item[data-value=\"' + esrTimeVal + '\"]';\n\n        // Show only selected dropdown\n        var subDropdown = null;\n        switch (esrDurationVal) {\n            case \"1\": // Weekly\n                subDropdown = $(\".weekly-dropdown\");\n                break;\n            case \"2\": // Monthly\n                subDropdown = $(\".monthly-dropdown\");\n                break;\n            default: // Daily\n                subDropdown = $(\".daily-dropdown\");\n        }\n\n        // Trigger click event\n        subDropdown.find(subSelectedDropdpown).click();\n    }\n\n    /**\n     * Delete Scheduled email\n     * @param {Object} data Data for email\n     * @param {object} root Modal root object\n     * @param {Object} modal Modal object\n     */\n    function emailScheduleDeleteInit(data, root, modal) {\n        var id = data.id;\n        var blockname = data.block;\n        var region = data.region;\n        var errorBox = root.find(\".esr-form-error\");\n        common.loader.show('body');\n\n        $.ajax({\n            url: v.requestUrl,\n            type: v.requestType,\n            sesskey: data.sesskey,\n            data: {\n                action: 'delete_scheduled_email_ajax',\n                sesskey: data.sesskey,\n                data: JSON.stringify({\n                    id: id,\n                    blockname: blockname,\n                    region: region\n                })\n            }\n        }).done(function(response) {\n            if (!response.error) {\n                if (emailListTable) {\n                    emailListTable.destroy();\n                }\n                emailListTable = renderAllScheduledEmails(data, modal);\n                errorBox.html(M.util.get_string('deletesuccessmsg', 'local_edwiserreports'));\n            } else {\n                errorBox.html(M.util.get_string('deleteerrormsg', 'local_edwiserreports'));\n            }\n        }).fail(Notification.exception).always(function() {\n            errorBox.delay(3000).fadeOut('slow');\n            common.loader.hide('body');\n        });\n    }\n\n    /* eslint-disable no-unused-vars */\n    /**\n     * Change scheduled email status\n     * @param {Object} data Data for email\n     * @param {object} root Modal root object\n     * @param {Object} modal Modal object\n     */\n    function changeScheduledEmailStatusInit(data, root, modal) {\n        /* eslint-enable no-unused-vars */\n        var id = data.id;\n        var blockname = data.block;\n        var region = data.region;\n        var sesskey = data.sesskey;\n\n        var errorBox = root.find(\".esr-form-error\");\n\n        $.ajax({\n            url: v.requestUrl,\n            type: v.requestType,\n            data: {\n                action: 'change_scheduled_email_status_ajax',\n                sesskey: sesskey,\n                data: JSON.stringify({\n                    id: id,\n                    blockname: blockname,\n                    region: region\n                })\n            }\n        }).done(function(response) {\n            let switchElement = root.find('.esr-manage-scheduled-emails .esr-switch[data-id=\"' + data.id + '\"]');\n            response = JSON.parse(response);\n            if (switchElement.attr('data-value') == \"0\") {\n                switchElement.attr('data-value', 'on');\n            } else {\n                switchElement.attr('data-value', '0');\n            }\n            if (!response.error) {\n                errorBox.html(response.successmsg);\n                errorBox.show();\n                errorBox.delay(3000).fadeOut('slow');\n            } else {\n                errorBox.html(response.errormsg);\n                errorBox.show();\n                errorBox.delay(3000).fadeOut('slow');\n            }\n        });\n    }\n\n    /**\n     * Email list table events.\n     * @param {Object} data Data for email\n     * @param {object} root Modal root object\n     * @param {Object} modal Modal object\n     */\n    function emailListInit(data, root, modal) {\n        // When setting button clicked then\n        root.on('click', SELECTOR.EDITBTN, function() {\n            emailScheduleSettingInit(this, root);\n        });\n\n        // When delete button clicked then\n        root.on('click', SELECTOR.DELETEBTN, function(e) {\n            data.id = $(this).data(\"id\");\n            Notification.confirm(\n                M.util.get_string('confirmemailremovaltitle', 'local_edwiserreports'),\n                M.util.get_string('confirmemailremovalquestion', 'local_edwiserreports'),\n                M.util.get_string('yes', 'moodle'),\n                M.util.get_string('no', 'moodle'),\n                $.proxy(function() {\n                    emailScheduleDeleteInit(data, root, modal);\n                }, e.currentTarget)\n            );\n        });\n\n        // When toggle switch clicked then\n        root.on('click', SELECTOR.EMAILLISTTOGGLESWITCH, function() {\n            data.id = $(this).data(\"id\");\n            changeScheduledEmailStatusInit(data, root, modal);\n        });\n    }\n\n    /**\n     * Manage schedule emails form initialization\n     * @param {Object} data Data for email\n     * @param {object} root Modal root object\n     * @param {Object} modal Modal object\n     */\n    function emailScheduleFormInit(data, root, modal) {\n        // If dropdown selected then update the button text\n        root.on('click', SELECTOR.DROPDOWNS, function() {\n            updateDropdownBtnText(this);\n        });\n\n        // Select duration for email schedule\n        root.on('click', SELECTOR.DURATIONSELECTOR, function() {\n            durationDropdownInit(this, root);\n        });\n\n        // Select time for schedule\n        root.on('click', SELECTOR.TIMESDROPDOWNLINK, function() {\n            root.find(SELECTOR.TIMEINPUT).val($(this).data('value'));\n        });\n\n        // Select format.\n        root.on('click', SELECTOR.FORMATSELECTOR, function() {\n            root.find(SELECTOR.FORMAT).val($(this).data('value'));\n        });\n\n        // On save perform operation\n        root.on('click', SELECTOR.SAVE, function() {\n            var errorBox = root.find(\".esr-form-error\");\n            common.loader.show('body');\n\n            if (validateEmailScheduledForm(root.find(\"form\"), errorBox)) {\n                var filter = data.filter;\n                var cohortid = data.cohortid;\n                var block = data.block;\n                var url = M.cfg.wwwroot + \"/local/edwiserreports/download.php?type=emailscheduled&filter=\" +\n                    filter + \"&cohortid=\" + cohortid + \"&block=\" + block;\n\n                // Send ajax to save the scheduled email\n                $.ajax({\n                    url: url,\n                    type: \"POST\",\n                    data: root.find(\"form\").serialize()\n                }).done(function(response) {\n                    response = $.parseJSON(response);\n\n                    // If error then log the error\n                    if (response.error) {\n                        errorBox.html(M.util.get_string('scheduleerrormsg', 'local_edwiserreports')).show();\n                        console.log(response.error);\n                    } else {\n                        if (emailListTable) {\n                            emailListTable.destroy();\n                        }\n                        emailListTable = renderAllScheduledEmails(data, modal);\n                        errorBox.html(M.util.get_string('schedulesuccessmsg', 'local_edwiserreports')).show();\n                    }\n                }).fail(Notification.exception).always(function() {\n                    setTimeout(function() {\n                        errorBox.fadeOut('slow');\n                    }, 3000);\n                    common.loader.hide('body');\n                });\n            } else {\n                common.loader.hide('body');\n            }\n        });\n\n        // Send the notification immidiatly\n        root.on('click', SELECTOR.SEND, function() {\n            sendMailToUser(data, this, root);\n        });\n\n        // Reset scheduled form\n        root.on('click', SELECTOR.RESET, function() {\n\n            // Resetting inputs.\n            root.find('[type=\"text\"], textarea').val('').trigger('input');\n\n            // Resetting formats.\n            let formats = root.find('.format-dropdown .dropdown-item');\n            console.log(formats);\n            if (formats.closest('[data-value=\"csv\"]').length) {\n                formats.closest('[data-value=\"csv\"]').trigger('click');\n            } else {\n                formats.closest('[data-value=\"pdfimage\"]').trigger('click');\n            }\n\n            // Resetting time selectors.\n            $('.date-filters .dropdown .dropdown-item:nth-child(1)').trigger('click')\n\n            // Resetting email selector.\n            root.find('[type=\"checkbox\"]').prop(\"checked\", true)\n                .each(function(index, element) {\n                    $(element).trigger(\"input\");\n                });\n            root.find(SELECTOR.ID).val(-1);\n        });\n    }\n\n    /**\n     * Send mail to user\n     * @param {Object} data Data for email\n     * @param {object} _this anchor tag\n     * @param {object} root Modal root object\n     */\n    function sendMailToUser(data, _this, root) {\n        var filter = data.filter;\n        var cohortid = data.cohortid;\n        var block = data.block;\n        var errorBox = root.find(\".esr-form-error\");\n        errorBox.html('').show();\n        common.loader.show(root.closest('.modal'), 'position-fixed');\n\n        $.ajax({\n            url: M.cfg.wwwroot + \"/local/edwiserreports/download.php?type=email&filter=\" +\n                filter + \"&cohortid=\" + cohortid + \"&block=\" + block,\n            type: \"POST\",\n            data: root.find('form').serialize()\n        }).done(function(response) {\n            response = $.parseJSON(response);\n            if (response.error) {\n                errorBox.html('<div class=\"alert alert-danger\"><b>ERROR:</b>' + response.errormsg + '</div>');\n            } else {\n                errorBox.html('<div class=\"alert alert-success\"><b>Success:</b>' + response.errormsg + '</div>');\n            }\n        }).fail(function(response) {\n            errorBox.html('<div class=\"alert alert-danger\"><b>ERROR:</b>' + response.errormsg + '</div>');\n        }).always(function() {\n            errorBox.delay(3000).fadeOut('slow');\n            common.loader.hide(root.closest('.modal'));\n        });\n    }\n\n    /**\n     * Validate comma separated emails.\n     * @param {String} emails Comma separated emails\n     * @param {Boolean} highlight Highlight error if email is invalid\n     * @return {Boolean}\n     */\n    function validateEmails(emails, highlight = true) {\n        var valid = true;\n        var domElement = $(SELECTOR.RECEPIENT).get(0);\n        var duplicates = [],\n            duplicate;\n        emails.replaceAll(' ', '').replaceAll(';', ',').split(',')\n            .forEach(email => {\n                if (duplicates[email] != undefined) {\n                    duplicate = true;\n                }\n                duplicates[email] = true;\n                valid = valid && emailRegex.test(email);\n            });\n        if (duplicate) {\n            if (highlight) {\n                domElement.setCustomValidity('Invalid email');\n                $(domElement).next().text(M.util.get_string('duplicateemail', 'local_edwiserreports'));\n            }\n            return false;\n        }\n        if (!valid) {\n            if (emails == '') {\n                domElement.setCustomValidity('');\n                $(domElement).next().text('');\n            } else if (highlight) {\n                domElement.setCustomValidity('Invalid email');\n                $(domElement).next().text(M.util.get_string('invalidemail', 'local_edwiserreports'));\n            }\n            return false;\n        }\n        if (highlight) {\n            domElement.setCustomValidity('');\n        }\n        return true;\n    }\n\n    /**\n     * Initialize email functionality.\n     */\n    function init() {\n        // Validating email field of schedule email form.\n        $(document).on('input', SELECTOR.RECEPIENT, function() {\n            validateEmails($(this).val());\n        });\n\n        // Validating schedule email form fields.\n        $(document).on('input', `${SELECTOR.NAME}, ${SELECTOR.RECEPIENT}, ${SELECTOR.SUBJECT}`, function() {\n            var name = $(SELECTOR.NAME).val() == \"\";\n            var recepient = !validateEmails($(SELECTOR.RECEPIENT).val(), false);\n            var subject = $(SELECTOR.SUBJECT).val() == \"\";\n            var invalid = name || recepient || subject;\n            $(this).closest('.fitem').addClass('was-validated');\n            $(formRoot).find(`${SELECTOR.SAVE}, ${SELECTOR.SEND}`).prop('disabled', invalid);\n            $(formRoot + ' .form-group.fitem').toggleClass('disabled', invalid);\n        });\n\n        // Highlight invalid input.\n        $(document).on('blur', `${SELECTOR.NAME}, ${SELECTOR.RECEPIENT}, ${SELECTOR.SUBJECT}`, function() {\n            $(this).closest('.fitem').addClass('was-validated');\n        });\n\n        /**\n         * Schedule emails to send reports.\n         */\n        $(document).on(\"click\", SELECTOR.SCHEDULEDEMAILDROPDOWN, function() {\n            var data = v.getScheduledEmailFormContext();\n            data.graphical = $(this).is('[data-type=\"graphical\"]');\n            var form = $(this).closest('form');\n            var formData = form.serializeArray();\n            $(formData).each(function($k, $d) {\n                data[$d.name] = $d.value;\n            });\n\n            var modalTitle = M.util.get_string('scheduleemailfor', 'local_edwiserreports');\n            if (data.block.includes(\"customreportsblock\")) {\n                modalTitle += ' ' + $('#' + data.block).data('blockname');\n            } else {\n                modalTitle += ' ' + M.util.get_string(data.block + 'exportheader', 'local_edwiserreports');\n            }\n\n            ModalFactory.create({\n                    title: modalTitle,\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'email_schedule_tabs',\n                        1, {\n                            data: JSON.stringify(data)\n                        }\n                    )\n                })\n                .done(function(modal) {\n                    var root = modal.getRoot();\n                    root.find('.modal-header').addClass('border-bottom-0');\n                    root.find('.modal-title').addClass('h4 font-weight-600');\n                    modal.modal.addClass(\"modal-lg\");\n\n                    root.on(ModalEvents.bodyRendered, function() {\n                        root.find(SELECTOR.BLOCKNAME).val(data.blockname);\n                        root.find(SELECTOR.REGION).val(data.region);\n                        root.find('[name=\"sesskey\"]').val(data.sesskey);\n                        emailListTable = renderAllScheduledEmails(data, modal);\n                    });\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n\n                    emailScheduleFormInit(data, root, modal);\n                    emailListInit(data, root, modal);\n                    modal.show();\n                });\n        });\n\n        // Search in table.\n        $(document).on('input', SELECTOR.LISTSEARCH, function() {\n            emailListTable.search(this.value).draw();\n        });\n    }\n    return {\n        init: init\n    }\n});\n"],"file":"email.min.js"}
