{"version":3,"sources":["customreports.js"],"names":["define","$","ajax","modalFactory","modalEvents","templates","Notification","Toast","str","common","cfCheckbox","cfSelect","cfCohort","cfCourse","cfSave","cfSaveForm","crDesktopEnableSwitch","crDeleteBtn","crHideBtn","cpHeader","cfPreviewTable","crListTable","customReportSaveTitle","M","util","get_string","selectedFields","courses","cohorts","reportsId","reportsDataLoaded","reportsData","downloadenable","cfPreviewLoader","selector","show","this","removeClass","addClass","hide","cfPreview","empty","crListLoader","crList","getCustomReportsData","val","each","push","length","prop","loader","call","methodname","args","params","JSON","stringify","fields","done","response","success","data","parse","reportsdata","clear","destroy","html","DataTable","columns","dom","language","info","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","bInfo","bFilter","searching","lengthChange","drawCallback","stylePaginationButton","setTimeout","attr","css","border-left","border-bottom","border-top","border-left-color","border-right-width","border-right","border-right-color","border-left-width","always","saveCustomReportsData","create","title","type","types","SAVE_CANCEL","body","render","modal","root","getRoot","find","getFooter","on","hidden","save","e","preventDefault","serializeArray","reduce","obj","item","name","value","ret","reportname","reportshortname","test","validateCustomReprtsSaveData","querydata","selectedfield","saveCustomReportsDataService","add","delay","errormsg","animate","scrollTop","getCustomReportsList","orderable","order","customReportServiceInit","document","enabledesktop","is","reportsid","action","reportId","get_strings","key","component","s","confirm","proxy","message","currentTarget","checkboxId","toggleClass","trigger","column","search","draw","handleSearchInput","init","ready","id","wrap","target","closest","current","concat"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/notification',\n    'core/toast',\n    'core/str',\n    './common',\n    './jquery.dataTables',\n    './dataTables.bootstrap4'\n], function(\n    $,\n    ajax,\n    modalFactory,\n    modalEvents,\n    templates,\n    Notification,\n    Toast,\n    str,\n    common\n) {\n    'use strict';\n\n    // Field group checkbox\n    var cfCheckbox = '.field .custom-field-checkbox';\n    var cfSelect = '.reports-filter-body .custom-field-select';\n    var cfCohort = '#wdm-cohort-select';\n    var cfCourse = '#wdm-course-select';\n    var cfSave = '#wdm-custom-reports-save';\n    var cfSaveForm = '#wdm-customreports-save-form';\n    var crPageId = '#wdm_custom_reports_id';\n    var crPageFullname = '#wdm_custom_reports_fullname';\n    var crPageShortname = '#wdm_custom_reports_shortname';\n    var crPageDownloadEnable = '#wdm_custom_reports_downloadenable';\n    var crPageDesktopEnable = '#wdm_custom_reports_desktopenable';\n    var crDesktopEnableSwitch = '[id^=\"wdm-desktopenable-\"]';\n    var crDeleteBtn = '#cr-list-table a[data-action=\"delete\"]';\n    var crHideBtn = '#cr-list-table a[data-action=\"hide\"]';\n    var cpHeader = '.reports-preview-header .rp-header';\n    var cfPreviewTable = null;\n    var crListTable = null;\n    var customReportSaveTitle = M.util.get_string('savecustomreport', 'local_edwiserreports');\n\n    var selectedFields = [];\n    var courses = [];\n    var cohorts = [];\n    var reportsId = 0;\n    var reportsDataLoaded = true;\n    var reportsData = {\n        downloadenable: true\n    };\n\n    var cfPreviewLoader = {\n        selector: '.reports-preview-body .reports-preview-content.loader',\n\n        show: function() {\n            $(this.selector).removeClass('d-none').addClass('d-flex');\n        },\n\n        hide: function() {\n            $(this.selector).removeClass('d-flex').addClass('d-none');\n        }\n    };\n\n    var cfPreview = {\n        selector: '.reports-preview-body .reports-preview-content',\n\n        show: function() {\n            $(this.selector + ':not(.loader)').removeClass('d-none').addClass('d-flex');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.hide();\n        },\n\n        hide: function() {\n            $(this.selector + ':not(.loader)').removeClass('d-flex').addClass('d-none');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.show();\n        },\n\n        empty: function() {\n            $(this.selector + '.empty').removeClass('d-none').addClass('d-flex');\n            $(this.selector + ':not(.empty)').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.hide();\n        }\n    };\n\n    var crListLoader = {\n        selector: '.reports-list-body .reports-list-content.loader',\n\n        show: function() {\n            $(this.selector).removeClass('d-none').addClass('d-flex');\n        },\n\n        hide: function() {\n            $(this.selector).removeClass('d-flex').addClass('d-none');\n        }\n    };\n\n    var crList = {\n        selector: '.reports-list-body .reports-list-content',\n\n        show: function() {\n            $(this.selector + ':not(.loader)').removeClass('d-none').addClass('d-flex');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            crListLoader.hide();\n        },\n\n        hide: function() {\n            $(this.selector + ':not(.loader)').removeClass('d-flex').addClass('d-none');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            crListLoader.show();\n        },\n\n        empty: function() {\n            $(this.selector + '.empty').removeClass('d-none').addClass('d-flex');\n            $(this.selector + ':not(.empty)').removeClass('d-flex').addClass('d-none');\n            crListLoader.hide();\n        }\n    };\n\n    /**\n     * Get custum reports data.\n     */\n    function getCustomReportsData() {\n        if (reportsDataLoaded) {\n            reportsDataLoaded = false;\n            selectedFields = [];\n            cohorts = $(cfCohort).val();\n            courses = $(cfCourse).val();\n            $(cfCheckbox + \":checked\").each(function() {\n                selectedFields.push($(this).val());\n            });\n\n            if (selectedFields.length == 0) {\n                $(cfSave).prop('disabled', true);\n                reportsDataLoaded = true;\n            }\n            common.loader.show('#wdm-customreports-edit');\n            var getCustomReportsDataAjax = ajax.call([{\n                methodname: 'local_edwiserreports_get_customreports_data',\n                args: {\n                    params: JSON.stringify({\n                        fields: selectedFields,\n                        cohorts: cohorts,\n                        courses: courses\n                    })\n                }\n            }]);\n            getCustomReportsDataAjax[0].done(function(response) {\n                if (response.success) {\n                    var data = JSON.parse(response.data);\n                    if (data.reportsdata.length == 0) {\n                        cfPreview.empty();\n                        $(cfSave).prop('disabled', true);\n                    } else {\n                        if (cfPreviewTable) {\n                            cfPreviewTable.clear().destroy();\n                            $('#cr-preview-table').html('');\n                        }\n                        cfPreview.show();\n                        cfPreviewTable = $('#cr-preview-table').DataTable({\n                            columns: data.columns,\n                            dom: '<\"edwiserreports-table\"<\"table-filter d-flex\"f><t><\"table-pagination\"p>>',\n                            data: data.reportsdata,\n                            language: {\n                                info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                                infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                                emptyTable: M.util.get_string('nodata', 'local_edwiserreports'),\n                                zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                                paginate: {\n                                    previous: \" \",\n                                    next: \" \"\n                                }\n                            },\n                            bInfo: false,\n                            bFilter: false,\n                            searching: false,\n                            lengthChange: false,\n                            drawCallback: function() {\n                                common.stylePaginationButton(this);\n                            }\n                        });\n                        $(cfSave).prop('disabled', false);\n                    }\n                }\n\n                // RTL support for arrows\n                setTimeout(function(){\n                    $('.edwiserreports-table .page-item.next a').empty();\n                    $('.edwiserreports-table .page-item.previous a').empty();\n                    var attr = $('html').attr('dir');\n                    // For some browsers, `attr` is undefined; for others,\n                    // `attr` is false.  Check for both.\n                    if (typeof attr !== 'undefined' && attr !== false && attr == 'rtl') {\n                        $('.edwiserreports-table .page-item.next a:before').css({'border-left': '11px solid transparent', 'border-bottom': '6px solid transparent','border-top': '6px solid transparent','border-left-color': '#ccc','border-right-width': '0px'});\n                        $('.edwiserreports-table .page-item.previous a:before').css({'border-bottom': '6px solid transparent','border-top': '6px solid transparent','border-right':' 10px solid transparent','border-right-color': '#ccc','border-left-width': '0px'});\n                    }\n                }, 1000);\n\n            }).always(function() {\n                reportsDataLoaded = true;\n                common.loader.hide('#wdm-customreports-edit');\n            });\n        }\n    }\n\n    /**\n     * Validate custom reports data to save.\n     * @param {Object} data Custom report data object\n     * @return {Boolean}\n     */\n    function validateCustomReprtsSaveData(data) {\n        var ret = true;\n        if (data.reportname == '') {\n            $('#id_error_crb_reportname')\n                .html(M.util.get_string('emptyfullname', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n\n        if (data.reportshortname == '') {\n            $('#id_error_crb_reportshortname')\n                .html(M.util.get_string('emptyshortname', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n\n        // eslint-disable-next-line no-useless-escape\n        var format = /[ `!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~]/;\n        if (format.test(data.reportshortname)) {\n            $('#id_error_crb_reportshortname')\n                .html(M.util.get_string('nospecialchar', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n        return ret;\n    }\n\n    /**\n     * Save custom reports data confirmation module.\n     */\n    function saveCustomReportsData() {\n        modalFactory.create({\n            title: customReportSaveTitle,\n            type: modalFactory.types.SAVE_CANCEL,\n            body: templates.render('local_edwiserreports/custom_reports_save_form', reportsData)\n        }).done(function(modal) {\n            var root = modal.getRoot();\n            root.find('.modal-dialog').addClass('modal-lg');\n            modal.getFooter().find('[data-action=\"save\"]').removeClass('btn-primary').addClass('theme-primary-bg text-white');\n            modal.show();\n\n            // Destroying modal on hide event.\n            root.on(modalEvents.hidden, function() {\n                modal.destroy();\n            });\n\n            // Saving modal data.\n            root.on(modalEvents.save, function(e) {\n                // Stop the default save button behaviour which is to close the modal.\n                e.preventDefault();\n\n                // Remove all error on type\n                root.find('input').on('input', function() {\n                    $('[id^=\"id_error_crb\"]').html('');\n                });\n\n                var data = $(cfSaveForm).serializeArray().reduce(function(obj, item) {\n                    obj[item.name] = item.value;\n                    return obj;\n                }, {});\n\n                if (validateCustomReprtsSaveData(data)) {\n                    // Prepare query data\n                    data.querydata = {\n                        'selectedfield': selectedFields,\n                        'cohorts': cohorts,\n                        'courses': courses\n                    };\n\n                    saveCustomReportsDataService(data, modal);\n                }\n            });\n        });\n    }\n\n    /**\n     * Save customo report data to database.\n     * @param {Object} data Custom report data\n     * @param {Moodle_Factory} modal Modal object\n     */\n    function saveCustomReportsDataService(data, modal) {\n        var saveCustomReportsData = ajax.call([{\n            methodname: 'local_edwiserreports_save_customreports_data',\n            args: {\n                params: JSON.stringify(data)\n            }\n        }]);\n\n        saveCustomReportsData[0].done(function(response) {\n            if (response.success) {\n                if (modal) {\n                    reportsData = JSON.parse(response.reportsdata);\n                    $(cpHeader).html(reportsData.reportname);\n                    $(cfSave).html(M.util.get_string('updatereports', 'local_edwiserreports'));\n                }\n                // $('#user-notifications .close').click();\n                Toast.add(M.util.get_string('reportssavesuccess', 'local_edwiserreports'), {\n                    type: 'success',\n                    delay: 3000\n                });\n            } else {\n                Toast.add(response.errormsg, {\n                    type: 'error',\n                    delay: 3000\n                });\n            }\n            if (modal) {\n                $(\"html, body\").animate({ scrollTop: 0 }, \"slow\");\n                getCustomReportsList();\n                modal.hide();\n            }\n        });\n    }\n\n    /**\n     * Get reports list of custom reports.\n     */\n    function getCustomReportsList() {\n        var getCustomReportsList = ajax.call([{\n            methodname: 'local_edwiserreports_get_customreports_list',\n            args: {\n                params: JSON.stringify({})\n            }\n        }]);\n        getCustomReportsList[0].done(function(response) {\n            var data = JSON.parse(response.data);\n            if (response.success) {\n                if (data.length == 0) {\n                    crList.empty();\n                } else {\n                    if (crListTable) {\n                        crListTable.clear().destroy();\n                    }\n\n                    crListTable = $('#cr-list-table').DataTable({\n                        columns: [{\n                                data: 'fullname',\n                                title: M.util.get_string('title', 'local_edwiserreports')\n                            },\n                            {\n                                data: 'createdby',\n                                title: M.util.get_string('createdby', 'local_edwiserreports')\n                            },\n                            {\n                                data: 'datecreated',\n                                title: M.util.get_string('datecreated', 'local_edwiserreports')\n                            },\n                            {\n                                data: 'datemodified',\n                                title: M.util.get_string('datemodified', 'local_edwiserreports')\n                            },\n                            {\n                                data: 'managehtml',\n                                title: M.util.get_string('manage', 'local_edwiserreports'),\n                                orderable: false\n                            }\n                        ],\n                        dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                        language: {\n                            info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                            infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                            emptyTable: M.util.get_string('nodata', 'local_edwiserreports'),\n                            zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                            paginate: {\n                                previous: \" \",\n                                next: \" \"\n                            }\n                        },\n                        order: [\n                            [0, 'asc']\n                        ],\n                        data: data,\n                        bInfo: false,\n                        lengthChange: false,\n                        drawCallback: function() {\n                            common.stylePaginationButton(this);\n                        }\n                    });\n                    crList.show();\n                }\n            }\n        });\n    }\n\n    /**\n     * Delete custom reports data.\n     * @param {Integer} reportsId Report id\n     */\n    function customReportDelete(reportsId) {\n        var deleteCustomReport = ajax.call([{\n            methodname: 'local_edwiserreports_delete_custom_report',\n            args: {\n                params: JSON.stringify({ reportsid: reportsId })\n            }\n        }]);\n        deleteCustomReport[0].done(function(response) {\n            Toast.add(response.message, {\n                type: response.success ? 'success' : 'error',\n                delay: 3000\n            });\n        }).always(function() {\n            $(\"html, body\").animate({ scrollTop: 0 }, \"slow\");\n            getCustomReportsList();\n        });\n    }\n\n    /**\n     * Initialise custom reports events.\n     */\n    function customReportServiceInit() {\n        $(cfCheckbox).on('change', function() {\n            getCustomReportsData();\n        });\n        $(cfSelect).on('change', function() {\n            getCustomReportsData();\n        });\n        $(cfSave).on('click', function() {\n            saveCustomReportsData();\n        });\n        getCustomReportsList();\n        $(document).on('change', crDesktopEnableSwitch, function() {\n            var enabledesktop = false;\n            if ($(this).is(\":checked\")) {\n                enabledesktop = true;\n            }\n            var updateData = {\n                reportsid: $(this).data('reportsid'),\n                enabledesktop: enabledesktop,\n                action: 'enabledesktop'\n            };\n\n            saveCustomReportsDataService(updateData, false);\n        });\n        $(document).on('click', crDeleteBtn, function(e) {\n            e.preventDefault();\n\n            var reportId = $(this).data('reportsid');\n            str.get_strings([{\n                    key: 'deletecustomreportstitle',\n                    component: 'local_edwiserreports'\n                },\n                {\n                    key: 'deletecustomreportsquestion',\n                    component: 'local_edwiserreports'\n                },\n                {\n                    key: 'yes',\n                    component: 'moodle'\n                },\n                {\n                    key: 'no',\n                    component: 'moodle'\n                }\n            ]).done(function(s) {\n                Notification.confirm(s[0], s[1], s[2], s[3], $.proxy(function() {\n                    customReportDelete(reportId);\n                }, e.currentTarget));\n            });\n        });\n        $(document).on('click', crHideBtn, function(e) {\n            e.preventDefault();\n\n            var checkboxId = $(this).data('target');\n            if ($(this).data('value')) {\n                $(this).attr('title', $(this).data('titlehide'));\n                $(this).attr('data-original-title', $(this).data('titlehide'));\n                $(this).data('value', 0);\n                $(this).attr('data-value', 0);\n            } else {\n                $(this).attr('title', $(this).data('titleshow'));\n                $(this).attr('data-original-title', $(this).data('titleshow'));\n                $(this).data('value', 1);\n                $(this).attr('data-value', 1);\n            }\n            $(this).find('.icon').toggleClass('fa-eye');\n            $(this).find('.icon').toggleClass('fa-eye-slash');\n            $(checkboxId).trigger('click');\n        });\n\n\n        // Search in table.\n        $('body').on('input', '.customreports-block-section .table-search-input input', function() {\n            crListTable.column(0).search(this.value).draw();\n        });\n\n        common.handleSearchInput();\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n\n                $(document).on('click', '.field-group', function() {\n                    var id = this.id;\n                    $(this).toggleClass('open');\n                    $(\"[aria-control='\" + id + \"']\").toggleClass('show');\n                });\n\n                $(document).on('click', function(e) {\n                    let wrap = $(e.target).closest(\".field-group-wrap\");\n                    if (wrap.length === 0) {\n                        $('.field-group-wrap .field-group').removeClass('open');\n                        $('.field-group-wrap .field').removeClass('show');\n                        return;\n                    }\n                    let current = wrap.data('key') === 'user' ? 'course' : 'user';\n                    $(`.field-group-wrap[data-key='${current}'] .field-group`).removeClass('open');\n                    $(`.field-group-wrap[data-key='${current}'] .field`).removeClass('show');\n                });\n\n                customReportServiceInit();\n                reportsId = $(crPageId).val();\n                if (reportsId !== 0) {\n                    reportsData.reportsid = reportsId;\n                    reportsData.reportname = $(crPageFullname).val();\n                    reportsData.reportshortname = $(crPageShortname).val();\n\n                    if ($(crPageDownloadEnable).val() != 0) {\n                        reportsData.downloadenable = true;\n                    } else {\n                        reportsData.downloadenable = false;\n                    }\n\n                    if ($(crPageDesktopEnable).val() != 0) {\n                        reportsData.enabledesktop = true;\n                    } else {\n                        reportsData.enabledesktop = false;\n                    }\n\n                    getCustomReportsData();\n                }\n            });\n        }\n    };\n});\n"],"file":"customreports.min.js"}
