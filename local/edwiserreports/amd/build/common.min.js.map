{"version":3,"sources":["common.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","$","Notification","Fragment","ModalFactory","ModalEvents","Ajax","Templates","CFG","EdwiserReportsEvents","v","selector","jsPDF","ApexCharts","SELECTOR","TABLE","FILTER","TAB","CAPEDIT","DATESELECTED","SEARCHTABLE","PAGINATION","PAGINATIONITEM","EXPORTGRAPHPDF","EXPORTGRAPHPNG","EXPORTGRAPHJPEG","EXPORTGRAPHSVG","direction","attr","PROMISE","GET_FILTER_DATA","types","cohortid","courseid","groupid","call","methodname","args","cohort","course","group","GET_TIMEPERIOD_LABEL","timeperiod","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","loader","show","id","position","$class","undefined","append","concat","util","get_string","hide","find","remove","setupBlockEditing","settingsSelector","document","on","e","preventDefault","contextid","currentTarget","blockname","create","title","body","loadFragment","done","modal","root","getRoot","addClass","bodyRendered","form","event","formData","serializeArray","each","$k","$d","name","value","JSON","stringify","sesskey","fail","error","console","log","addNotification","message","always","location","reload","setBlockPreference","hidden","destroy","this","_this","cfg","response","parse","success","closest","removeClass","html","capvalue","capabilities","js","css","replaceNodeContents","switchCapabilitiesBlock","setBlockCapabilities","permissions","current","filter","next","eq","index","length","prop","perStr","perClass","callback","timePlainFormat","h","m","s","handleFilterSize","PANEL","is","removeClasses","addClasses","splice","indexOf","join","refreshFilter","toggleClass","select2","render","replaceNode","filterToString","blockName","push","Object","entries","forEach","item","ready","target","exportEvent","CustomEvent","setTimeout","dispatchEvent","blockSettingsBtn","text-align","empty","editing","editingtxt","editForm","wwwroot","setupBlockHiding","toPrecision","precision","insight","details","ex","exception","timeFormatter","seconds","opts","Number","Math","floor","rtl","dataPointIndex","time","_short","dateChange","DATECHANGE","detail","date","formatDate","format","utc","MMMM","MMM","dddd","ddd","ii","i","len","y","getUTCFullYear","getFullYear","replace","toString","substr","getUTCMonth","getMonth","d","getUTCDate","getDate","H","getUTCHours","getHours","getUTCMinutes","getMinutes","getUTCSeconds","getSeconds","f","getUTCMilliseconds","getMilliseconds","round","T","charAt","t","toLowerCase","tz","getTimezoneOffset","K","tzMin","abs","day","getUTCDay","getDay","RegExp","stylePaginationButton","element","pagination","not","handleSearchInput","val","reloadFilter","refreshSummarycard","report","exportGraphPDF","chart","width","height","filename","dataURI","scale","then","uri","imageData","imgURI","replaceAll","style","canvas","get","ctx","getContext","image","Image","onload","drawImage","src","pageWidth","pageHeight","doc","margin","addImage","save","exportGraphJPEG","a","createElement","href","download","click","exportGraphPNG","exportGraphSVG","exec","toolbar","export","svg","exports","exportToSVG","headerNavigation","button","handleReportCapability","reportname","updateTimeLabel","startdate","Date","enddate","startDay","endDay","toLocaleString","month","exportDropdownHandler"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/notification',\n    'core/fragment',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/ajax',\n    'core/templates',\n    './defaultconfig',\n    './events',\n    './variables',\n    './selectors',\n    './vendor/jspdf',\n    './vendor/apexcharts',\n    './select2',\n    './jquery.dataTables',\n    './dataTables.bootstrap4'\n], function(\n    $,\n    Notification,\n    Fragment,\n    ModalFactory,\n    ModalEvents,\n    Ajax,\n    Templates,\n    CFG,\n    EdwiserReportsEvents,\n    v,\n    selector,\n    jsPDF,\n    ApexCharts\n) {\n\n    /**\n     * Selectors list.\n     */\n    let SELECTOR = {\n        TABLE: '.edwiserreports-table',\n        FILTER: '.table-filter',\n        TAB: '.edwiserreports-tabs .dropdown',\n        CAPEDIT: '.report-actions [data-action=\"editcap\"]',\n        DATESELECTED: '.selected-period span',\n        SEARCHTABLE: '.table-search-input input',\n        PAGINATION: '.table-pagination',\n        PAGINATIONITEM: '.paginate_button',\n        EXPORTGRAPHPDF: '.download-links button[value=\"pdfimage\"]',\n        EXPORTGRAPHPNG: '.download-links button[value=\"png\"]',\n        EXPORTGRAPHJPEG: '.download-links button[value=\"jpeg\"]',\n        EXPORTGRAPHSVG: '.download-links button[value=\"svg\"]'\n    };\n\n    /**\n     * Direction parameter.\n     */\n    var direction = $('html').attr('dir');\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get filter data.\n         *\n         * @param {Integer} cohortid    Cohort id\n         * @param {Integer} courseid    Course id\n         * @param {Integer} groupid     Group id\n         * @returns {PROMISE}\n         */\n        GET_FILTER_DATA: function(types, cohortid, courseid, groupid) {\n            return Ajax.call([{\n                methodname: 'local_edwiserreports_get_filter_data',\n                args: {\n                    types: types,\n                    cohort: cohortid,\n                    course: courseid,\n                    group: groupid\n                }\n            }], false)[0];\n        },\n        /**\n         * Get time period label to show in the header.\n         * @param {String} timeperiod Time period.\n         * @returns {Promise}\n         */\n        GET_TIMEPERIOD_LABEL: function(timeperiod) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_timeperiod_label_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: timeperiod\n                }\n            });\n        }\n    };\n\n    // Loader functions.\n    var loader = {\n        show: function(id, position) {\n            var $class;\n            if (id == undefined) {\n                id = 'body';\n                $class = 'position-fixed';\n            } else {\n                $class = 'position-absolute';\n            }\n            if (position != undefined) {\n                $class = position;\n            }\n            $(id).append(`\n            <div class=\"edwiserreports-loader ${$class}\">\n                <div class=\"animation-wrapper\">\n                    <div class=\"fa-animation\">\n                        <i class=\"fa fa-cog fa-lg fa-spin\"></i>\n                        <i class=\"fa fa-cog fa-md fa-spin spin-reverse\"></i>\n                        <i class=\"fa fa-cog fa-sm fa-spin spin-reverse\"></i>\n                    </div>\n                    ${M.util.get_string('loading', 'moodle')}\n                </div>\n            </div>\n            `);\n        },\n        hide: function(id) {\n            if (id == undefined) {\n                id = 'body';\n            }\n            $(id).find('.edwiserreports-loader').remove();\n        }\n    };\n\n    /**\n     * Email Shcedule Modal Related Parameters end\n     */\n\n    $(document).ready(function() {\n        // Trigger graphical export function\n        ['EXPORTGRAPHPDF', 'EXPORTGRAPHPNG', 'EXPORTGRAPHJPEG', 'EXPORTGRAPHSVG']\n        .forEach(function(id) {\n            $('body').on('click', SELECTOR[id], function() {\n                let target = $(this).closest('.edwiserReport-block').data('block');\n                let exportEvent = new CustomEvent(EdwiserReportsEvents[id] + '-' + target);\n                setTimeout(function() {\n                    document.dispatchEvent(exportEvent);\n                }, 0);\n            });\n        });\n\n        // Show reports page when document is ready\n        $('#wdm-edwiserreports').removeClass('d-none');\n\n        setupBlockEditing(selector.blockSettingsBtn);\n        setupBlockEditing('.erp-custom-edit-settings');\n        setupRtlSupport();\n        setupBlockHiding($('#wdm-edwiserreports').data(\"editing\"));\n    });\n\n\n    /**\n     * Check if RTL is enabled and then convert arrows direction\n     */\n    function setupRtlSupport() {\n\n        setTimeout(function(){\n            var attr = $('html').attr('dir');\n            // For some browsers, `attr` is undefined; for others,\n            // `attr` is false.  Check for both.\n            if (typeof attr !== 'undefined' && attr !== false && attr == 'rtl') {\n                $('.dropdown-item.custom').css({'direction':'ltr','text-align': 'right'});\n\n                $('.insight-wrapper .fa-arrow-left').removeClass(\"fa-arrow-left\").addClass(\"fa-arrow-right rtl-support\");\n                $('.insight-wrapper .fa-arrow-right:not(.rtl-support)').removeClass(\"fa-arrow-right\").addClass(\"fa-arrow-left rtl-support\");\n            }\n            $('.edwiserreports-table .page-item.next a').empty();\n            $('.edwiserreports-table .page-item.previous a').empty();\n        }, 1000);\n    }\n\n    /**\n     * Setup block hiding\n     * @param {Boolean} editing True if editing is on\n     */\n    function setupBlockHiding(editing) {\n        var editForm = '<div id=\"editing-btn\" class=\"d-flex flex-wrap\">';\n        editForm += '<div class=\"ml-auto d-flex\">';\n        var editingtxt;\n\n        // Change editing option\n        if (editing) {\n            editing = 0;\n            editingtxt = \"Stop Customising this page\";\n\n            editForm += '<div class=\"singlebutton\">';\n            editForm += '<form method=\"post\" action=\"' + M.cfg.wwwroot + '/local/edwiserreports/index.php\">';\n            editForm += '<input type=\"hidden\" name=\"reset\" value=\"1\">';\n            editForm += '<input type=\"hidden\" name=\"sesskey\" value=\"' + M.cfg.sesskey + '\">';\n            editForm += '<button type=\"submit\" class=\"btn btn-secondary\" title=\"\">Reset Page to Default</button>';\n            editForm += '</form>';\n            editForm += '</div>';\n        } else {\n            editing = 1;\n            editingtxt = \"Customise this page\";\n        }\n\n        editForm += '<div class=\"singlebutton\">';\n        editForm += '<form method=\"post\" action=\"' + M.cfg.wwwroot + '/local/edwiserreports/index.php\">';\n        editForm += '<input type=\"hidden\" name=\"edit\" value=\"' + editing + '\">';\n        editForm += '<input type=\"hidden\" name=\"sesskey\" value=\"' + M.cfg.sesskey + '\">';\n        editForm += '<button type=\"submit\" class=\"btn btn-secondary\" title=\"\">' + editingtxt + '</button>';\n        editForm += '</form>';\n        editForm += '</div>';\n\n        editForm += '</div></div>';\n\n        $(\"#page-local-edwiserreports-index #page-header .card-body\").append(editForm);\n    }\n\n    /**\n     * Setup block setting button\n     */\n    function setupBlockEditing(settingsSelector) {\n        $(document).on('click', settingsSelector, function(e) {\n\n\n            e.preventDefault();\n\n            var contextid = $(e.currentTarget).data('contextid');\n            var blockname = $(e.currentTarget).data('blockname');\n            var action = $(e.currentTarget).data('action');\n\n            if (action == 'edit') {\n                ModalFactory.create({\n                    title: M.util.get_string('editblocksetting', 'local_edwiserreports'),\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'get_blocksetting_form',\n                        contextid, {\n                            blockname: blockname\n                        }\n                    )\n                }).done(function(modal) {\n                    var root = modal.getRoot();\n                    modal.modal.addClass('modal-dialog-centered');\n\n                    root.on(ModalEvents.bodyRendered, function() {\n                        var form = modal.modal.find('.block-settings-form');\n                        modal.modal.find('.save-block-settings').on('click', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            // Set users preferences\n                            setBlockPreference(blockname, data);\n                        });\n                    });\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.show();\n                });\n            } else if (action == \"hide\") {\n                var hidden = $(this).data(\"hidden\");\n                var _this = $(this);\n                $.ajax({\n                    url: v.requestUrl,\n                    type: 'GET',\n                    data: {\n                        action: 'toggle_hide_block_ajax',\n                        sesskey: M.cfg.sesskey,\n                        data: JSON.stringify({\n                            'blockname': blockname,\n                            'hidden': hidden\n                        })\n                    }\n                }).done(function(response) {\n                    response = JSON.parse(response);\n                    if (response.success) {\n                        if (hidden) {\n                            _this.closest('.edwiserReport-block').removeClass('block-hidden');\n                            _this.data(\"hidden\", 0);\n                            _this.html(M.util.get_string('hide', 'local_edwiserreports'));\n                        } else {\n                            _this.closest('.edwiserReport-block').addClass('block-hidden');\n                            _this.data(\"hidden\", 1);\n                            _this.html(M.util.get_string('unhide', 'local_edwiserreports'));\n                        }\n                    }\n                });\n            } else if (action == \"editcap\") {\n                ModalFactory.create({\n                    title: M.util.get_string('editblockcapabilities', 'local_edwiserreports'),\n                    body: Fragment.loadFragment(\n                        'local_edwiserreports',\n                        'get_blockscap_form',\n                        contextid, {\n                            blockname: blockname\n                        }\n                    )\n                }).done(function(modal) {\n                    var root = modal.getRoot();\n                    modal.modal.addClass('modal-dialog-centered modal-lg');\n\n                    root.on(ModalEvents.bodyRendered, function() {\n                        var form = modal.modal.find('.block-cap-form');\n                        modal.modal.find('#menucapabilities').on('change', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            Fragment.loadFragment(\n                                'local_edwiserreports',\n                                'block_overview_display',\n                                contextid, {\n                                    capvalue: data.capabilities\n                                }\n                                // eslint-disable-next-line no-unused-vars\n                            ).done(function(html, js, css) {\n                                Templates.replaceNodeContents(modal.modal.find('.cap-overview'), html, js);\n                                switchCapabilitiesBlock(modal);\n                            });\n                        });\n\n                        switchCapabilitiesBlock(modal);\n\n                        form = modal.modal.find('.block-cap-form');\n                        modal.modal.find('.save-block-caps').on('click', function(event) {\n                            event.preventDefault();\n                            var formData = form.serializeArray();\n                            var data = {};\n                            $(formData).each(function($k, $d) {\n                                data[$d.name] = $d.value;\n                            });\n\n                            // Set block capabilities\n                            setBlockCapabilities(blockname, data, function() {\n                                modal.hide();\n                            });\n                        });\n                    });\n\n                    root.on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.show();\n                });\n            }\n        });\n    }\n\n    /**\n     * Switch capability block.\n     * @param {Object} modal Modal object\n     */\n    function switchCapabilitiesBlock(modal) {\n        modal.modal.find('.comparisontable .switch-capability').on('click', function(event) {\n            var permissions = $(event.currentTarget).find('input[type=radio]');\n            var current = permissions.filter(':checked');\n            var next = permissions.eq(permissions.index(current) + 1);\n            if (next.length === 0) {\n                next = permissions.eq(0);\n            }\n            next.prop('checked', true);\n\n            var perStr = next.data('strpermission');\n            var perClass = next.data('permissionclass');\n\n            $(event.currentTarget).removeClass('inherit allow prevent prohibit');\n            $(event.currentTarget).addClass(perClass);\n            $(event.currentTarget).find('label').html(perStr);\n        });\n    }\n\n    /**\n     * Set blocks capabilities\n     * @param {string} blockname\n     * @param {string} data\n     * @param {function} callback\n     */\n    function setBlockCapabilities(blockname, data, callback) {\n        data.blockname = blockname;\n        data = JSON.stringify(data);\n        var sesskey = $('#' + blockname).data('sesskey');\n\n        // Update users capability\n        $.ajax({\n            url: v.requestUrl,\n            type: 'GET',\n            data: {\n                action: 'set_block_capability_ajax',\n                sesskey: sesskey,\n                data: data\n            }\n        }).done(function(response) {\n            response = JSON.parse(response);\n            if (response.success) {\n                callback();\n                location.reload();\n            } else {\n                Notification.addNotification({\n                    message: \"Error\",\n                    type: \"error\"\n                });\n            }\n        }).fail(function(error) {\n            console.log(error);\n            Notification.addNotification({\n                message: error,\n                type: \"error\"\n            });\n        }).always(function() {\n            callback();\n            location.reload();\n        });\n    }\n\n    /**\n     * Set users preferences\n     * @param {string} blockname Block name\n     * @param {string} data Data for preference\n     */\n    function setBlockPreference(blockname, data) {\n        data.blockname = blockname;\n        data = JSON.stringify(data);\n        var sesskey = $('#' + blockname).data('sesskey');\n\n        // Set users preferences\n        $.ajax({\n            url: v.requestUrl,\n            type: 'GET',\n            data: {\n                action: 'set_block_preferences_ajax',\n                sesskey: sesskey,\n                data: data\n            }\n        }).fail(function(error) {\n            console.log(error);\n            Notification.addNotification({\n                message: error,\n                type: \"error\"\n            });\n        }).always(function() {\n            location.reload();\n        });\n    }\n\n    /**\n     * Send plain formatted time.\n     * @param {Number} h Hours\n     * @param {Number} m Minutes\n     * @param {Number} s Seconds\n     * @returns {String}\n     */\n    function timePlainFormat(h, m, s) {\n        if (h > 0) {\n            h = h < 10 ? \"0\" + h : h;\n        } else {\n            h = \"00\";\n        }\n        if (m > 0) {\n            m = m < 10 ? \"0\" + m : m;\n        } else {\n            m = \"00\";\n        }\n        if (s > 0) {\n            s = s < 10 ? \"0\" + s : s;\n        } else {\n            s = \"00\";\n        }\n        return h + \":\" + m + \":\" + s;\n    }\n\n    /**\n     * Convert seconds to HH:MM:SS\n     * @param {Integer} seconds Seconds\n     * @param {Object} opts Options\n     * @returns {String}\n     */\n    function timeFormatter(seconds, opts) {\n        seconds = Number(seconds);\n        var h = Math.floor(seconds / 3600);\n        var m = Math.floor(seconds % 3600 / 60);\n        var s = Math.floor(seconds % 3600 % 60);\n\n        rtl = $('html').attr('dir') == 'rtl' ? 1 : 0;\n\n\n        if (typeof opts == 'object' && opts.dataPointIndex !== undefined && opts.dataPointIndex !== -1) {\n            var time = [];\n            var short = opts.short !== undefined && opts.short;\n\n            if(rtl == 1){\n\n                if (s > 0) {\n                    if (short) {\n                        time.push(M.util.get_string('secondshort', 'local_edwiserreports')+ \" \" + s  );\n                    } else {\n                        time.push(M.util.get_string(s == 1 ? 'second' : 'seconds', 'local_edwiserreports')+ \" \" + s  );\n                    }\n                }\n                \n                if (m > 0) {\n                    if (short) {\n                        time.push(M.util.get_string('minuteshort', 'local_edwiserreports')+ \" \" + m);\n                    } else {\n                        time.push(M.util.get_string(m == 1 ? 'minute' : 'minutes', 'local_edwiserreports')+ \" \" + m);\n                    }\n                }\n                if (h > 0) {\n                    if (short) {\n                        time.push( M.util.get_string('hourshort', 'local_edwiserreports')+ \" \" + h);\n                    } else {\n                        time.push( M.util.get_string(h == 1 ? 'hour' : 'hours', 'local_edwiserreports')+ \" \" + h);\n                    }\n                }\n                \n            } else {\n\n                if (h > 0) {\n                    if (short) {\n                        time.push(h + \" \" + M.util.get_string('hourshort', 'local_edwiserreports'));\n                    } else {\n                        time.push(h + \" \" + M.util.get_string(h == 1 ? 'hour' : 'hours', 'local_edwiserreports'));\n                    }\n                }\n                if (m > 0) {\n                    if (short) {\n                        time.push(m + \" \" + M.util.get_string('minuteshort', 'local_edwiserreports'));\n                    } else {\n                        time.push(m + \" \" + M.util.get_string(m == 1 ? 'minute' : 'minutes', 'local_edwiserreports'));\n                    }\n                }\n                if (s > 0) {\n                    if (short) {\n                        time.push(s + \" \" + M.util.get_string('secondshort', 'local_edwiserreports'));\n                    } else {\n                        time.push(s + \" \" + M.util.get_string(s == 1 ? 'second' : 'seconds', 'local_edwiserreports'));\n                    }\n                }\n            }\n\n            if (time.length == 0) {\n                time.push(0);\n            }\n\n            return time.join(', ');\n        }\n\n        return rtl == 1 ? timePlainFormat(s, m, h) : timePlainFormat(h, m, s);\n    }\n\n    /**\n     * Render insight card.\n     * @param {String} selector DOM selector\n     * @param {Object} data     Insight data\n     */\n    function insight(selector, data) {\n        data.insight.title = M.util.get_string(data.insight.title, 'local_edwiserreports');\n        if (data.details !== undefined && data.details.data !== undefined) {\n            data.details.data.forEach(function(value, index) {\n                data.details.data[index].title = M.util.get_string(value.title, 'local_edwiserreports');\n            });\n        }\n        Templates.render('local_edwiserreports/insight-placeholder', {})\n            .done(function(html, js) {\n                Templates.replaceNodeContents(selector, html, js);\n                Templates.render('local_edwiserreports/insight', data)\n                    .done(function(html, js) {\n                        Templates.replaceNodeContents(selector, html, js);\n                    })\n                    .fail(function(ex) {\n                        Notification.exception(ex);\n                        $(selector).remove();\n                    });\n            });\n    }\n\n    /**\n     * Styling pagination button of data table.\n     * @param {DOM} element Table element\n     */\n    function stylePaginationButton(element) {\n        let pagination = $(element).closest(SELECTOR.TABLE).find(SELECTOR.PAGINATION);\n        if (pagination.find(SELECTOR.PAGINATIONITEM).length < 4) {\n            pagination.addClass('d-none');\n            return;\n        }\n        pagination.removeClass('d-none');\n        pagination.find(SELECTOR.PAGINATIONITEM).not('.previous').not('.next').not('.active').addClass('pagination-number');\n        pagination.find(SELECTOR.PAGINATIONITEM + ':not(.active) a').addClass('theme-primary-text');\n        pagination.find(SELECTOR.PAGINATIONITEM + '.active a').addClass('text-dark');\n        pagination.find(SELECTOR.PAGINATIONITEM + '.previous a').addClass('theme-primary-border rounded');\n        pagination.find(SELECTOR.PAGINATIONITEM + '.next a').addClass('theme-primary-border rounded');\n\n    }\n\n    /**\n     * This function calls callback function when user change the date.\n     *\n     * @param {function} callback Callback function to handle date change\n     */\n    function dateChange(callback) {\n        $(document).on(EdwiserReportsEvents.DATECHANGE, function(event) {\n            callback(event.detail.date);\n        });\n    }\n\n    /**\n     * Handling highlight of search input.\n     */\n    function handleSearchInput() {\n        /* Table search listener */\n        $('body').on('input', SELECTOR.SEARCHTABLE, function() {\n            $(this).toggleClass('empty', $(this).val() === '');\n        });\n    }\n\n    /**\n     * Handle filters size based on visibility.\n     * @param {String} PANEL Panel name\n     * @returns {Void}\n     */\n    function handleFilterSize(PANEL) {\n        // Skip if page is not dashboard.\n        if (!$(PANEL).closest('body').is('#page-local-edwiserreports-index')) {\n            return;\n        }\n\n        let removeClasses = ['col-md-3', 'col-md-4', 'col-md-6', 'col-md-12'];\n        let addClasses = [];\n        switch ($(PANEL).find('.filter-selector:not(.d-none)').length) {\n            case 1:\n                addClasses = removeClasses.splice(removeClasses.indexOf('col-md-12'), 1);\n                break;\n            case 2:\n                addClasses = removeClasses.splice(removeClasses.indexOf('col-md-6'), 1);\n                break;\n            case 3:\n                addClasses = removeClasses.splice(removeClasses.indexOf('col-md-4'), 1);\n                break;\n            case 4:\n                addClasses = removeClasses.splice(removeClasses.indexOf('col-md-3'), 1);\n                break;\n        }\n        $(PANEL).find('.filter-selector').addClass(addClasses.join(' ')).removeClass(removeClasses.join(' '));\n    }\n\n    /**\n     * Refresh filter based on response.\n     * @param {string} type Type of filter\n     * @param {object} response Response from server\n     * @param {sring} PANEL Panel name\n     * @param {function} callback Callback function\n     */\n    function refreshFilter(type, response, PANEL, callback) {\n        let length = response[type + 's'] !== undefined ? response[type + 's'].length : 0;\n        $(PANEL).find(`.${type}-select`).closest('.filter-selector').toggleClass('d-none', length === 0);\n        handleFilterSize(PANEL);\n        if (length !== 0) {\n            $(PANEL).find(`.${type}-select`).select2('destroy');\n            Templates.render('local_edwiserreports/filters/' + type + 's_filter', response)\n                .done(function(html, js) {\n\n\n                    Templates.replaceNode($(PANEL).find(`.${type}-select`), html, js);\n\n                    // Reinitialize student selector select2 instance.\n                    $(PANEL).find(`.${type}-select`).select2();\n                    if (callback !== undefined) {\n                        callback();\n                    }\n                });\n        } else if (callback !== undefined) {\n            callback();\n        }\n    }\n\n    /**\n     * Refresh filter based on response.\n     * @param {string} report Type of filter\n     * @param {object} response Response from server\n     * @param {sring} PANEL Panel name\n     * @param {function} callback Callback function\n     */\n    function refreshSummarycard(report, response, PANEL, callback) {\n\n        Templates.render('local_edwiserreports/summary/summary-card', response)\n        .done(function(html, js) {\n\n            Templates.replaceNode($(\".summary-card\"), html, js);\n            \n            // Reinitialize student selector select2 instance.\n            // $(PANEL).find(`.${type}-select`).select2();\n            if (callback !== undefined) {\n                callback();\n            }\n        });\n    }\n\n    /**\n     * Handling reloading of filters\n     * @param {String}      PANEL       selector\n     * @param {Array}       types       Types of filter fetch\n     * @param {Integer}     cohortid    Cohort id\n     * @param {Integer}     courseid    Course id\n     * @param {Integer}     groupid     Group id\n     * @param {Function}    callback    Callback function\n     */\n    function reloadFilter(PANEL, types, cohortid, courseid, groupid, callback) {\n        PROMISE.GET_FILTER_DATA(types, cohortid, courseid, groupid)\n            .done(function(response) {\n                // Remove flags.\n                if (types.indexOf('noallusers') !== -1) {\n                    types.splice(types.indexOf('noallusers'), 1);\n                }\n                if (types.indexOf('noallcourses') !== -1) {\n                    types.splice(types.indexOf('noallcourses'), 1);\n                }\n\n                response = JSON.parse(response);\n                let i = 0;\n                for (; i < types.length - 1; i++) {\n                    refreshFilter(types[i], response[types[i]], PANEL, undefined);\n                }\n                refreshFilter(types[i], response[types[i]], PANEL, callback);\n            });\n    }\n\n    /**\n     * Apply precision to number. If number is whole then return as it is.\n     * @param {Number} value     Value to apply precision\n     * @param {Number} precision Precision to apply\n     * @returns {Number}\n     */\n    function toPrecision(value, precision) {\n        if (value % 1 === 0) {\n            return value;\n        }\n        return value.toPrecision(precision);\n    }\n\n    /**\n     * Covert filter object to string for export postfix\n     * @param {String}  blockName Name of the block\n     * @param {Object}  filter    Filter parameter\n     * @return {String}           postfix for exporting filename\n     */\n    function filterToString(blockName, filter) {\n        let name = [];\n        name.push('block_' + blockName);\n        if (typeof filter === 'object') {\n            Object.entries(filter).forEach(function(item) {\n                name.push(item.join('-'));\n            });\n        } else {\n            name.push(filter);\n        }\n        return name.join('_');\n    }\n\n    /**\n     * Export Graph in PDF format\n     * @param {ApexChart} chart     ApexChart object\n     * @param {Object}    filter    Filter object\n     * @param {String}    filename  Name for file. Default undefined. If undefined then filename generated using filter parameter.\n     */\n    function exportGraphPDF(chart, filter, width, height, filename) {\n        if (filename == undefined) {\n            filename = filterToString(chart.opts.chart.id, filter);\n        }\n        chart.dataURI({\n            scale: 1.5\n        }).then(function(uri) {\n\n            const imageData = uri.imgURI.replaceAll('image/png', 'image/jpeg');\n\n            let style = \"\";\n            if (width !== undefined && height !== undefined) {\n                style = ` width=\"${width}\" height=\"${height}\"`;\n            }\n\n            var canvas = $(`<canvas${style}></canvas>`).get(0);\n            var ctx = canvas.getContext(\"2d\");\n\n            var image = new Image();\n            image.onload = function() {\n                ctx.drawImage(image, 0, 0);\n            };\n            image.src = imageData;\n\n            const margin = 15;\n\n            const pageWidth = canvas.width;\n            const pageHeight = canvas.height;\n\n            var doc = jsPDF('l', 'px', [pageWidth + (margin * 2), pageHeight + (margin * 2)]);\n\n            doc.addImage(imageData, 'png', margin, margin, pageWidth, pageHeight);\n            doc.save(filename + '.pdf');\n        });\n    }\n\n    /**\n     * Export chart in JPEG format.\n     * @param {ApexChart} chart     ApexChart object\n     * @param {Object}    filter    Filter object\n     * @param {String}    filename  Name for file. Default undefined. If undefined then filename generated using filter parameter.\n     */\n    function exportGraphJPEG(chart, filter, filename) {\n        if (filename == undefined) {\n            filename = filterToString(chart.opts.chart.id, filter);\n        }\n        chart.dataURI({\n            scale: 1.5\n        }).then(function(uri) {\n            var a = document.createElement(\"a\"); //Create <a>\n            a.href = uri.imgURI.replaceAll('image/png', 'image/jpeg'); //Image Base64 Goes here\n            a.download = filename + \".jpeg\"; //File name Here\n            a.click(); //Downloaded file\n        });\n    }\n\n    /**\n     * Export Graph in PNG format\n     * @param {ApexChart} chart     ApexChart object\n     * @param {Object}    filter    Filter object\n     * @param {String}    filename  Name for file. Default undefined. If undefined then filename generated using filter parameter.\n     */\n    function exportGraphPNG(chart, filter, filename) {\n        if (filename == undefined) {\n            filename = filterToString(chart.opts.chart.id, filter);\n        }\n        chart.dataURI({\n            scale: 1.5\n        }).then(function(uri) {\n            var a = document.createElement(\"a\"); //Create <a>\n            a.href = uri.imgURI; //Image Base64 Goes here\n            a.download = filename + \".png\"; //File name Here\n            a.click(); //Downloaded file\n        });\n    }\n\n    /**\n     * Export Graph in SVG format\n     * @param {ApexChart} chart     ApexChart object\n     * @param {Object}    filter    Filter object\n     * @param {String}    filename  Name for file. Default undefined. If undefined then filename generated using filter parameter.\n     */\n    function exportGraphSVG(chart, filter, filename) {\n        if (filename == undefined) {\n            filename = filterToString(chart.opts.chart.id, filter);\n        }\n        ApexCharts.exec(chart.opts.chart.id, 'updateOptions', {\n            chart: {\n                toolbar: {\n                    export: {\n                        svg: {\n                            filename: filename\n                        }\n                    }\n                }\n            }\n        }, false, true);\n        chart.exports.exportToSVG();\n    }\n\n    /**\n     * Header navigation dropdown handler.\n     */\n    function headerNavigation() {\n        // Explicitly handling dropdown issue.\n        $('body').on('click', function(e) {\n            let button = $(e.target).closest(SELECTOR.TAB);\n            $(`${SELECTOR.TAB}.show`).not(button)\n                .closest(SELECTOR.TAB).removeClass('show');\n            if (button.length) {\n                button.closest(SELECTOR.TAB).toggleClass('show');\n            }\n        });\n    }\n\n    /**\n     * Handling report page capabilities.\n     */\n    function handleReportCapability() {\n        let contextid = $(SELECTOR.CAPEDIT).data('contextid');\n        let reportname = $(SELECTOR.CAPEDIT).data('reportname');\n        $(SELECTOR.CAPEDIT).click(function() {\n            ModalFactory.create({\n                title: M.util.get_string('editreportcapabilities', 'local_edwiserreports'),\n                body: Fragment.loadFragment(\n                    'local_edwiserreports',\n                    'get_reportscap_form',\n                    contextid, {\n                        name: reportname\n                    }\n                )\n            }).done(function(modal) {\n                var root = modal.getRoot();\n                modal.modal.addClass('modal-dialog-centered modal-lg');\n\n                root.on(ModalEvents.bodyRendered, function() {\n                    var form = modal.modal.find('.block-cap-form');\n                    modal.modal.find('#menucapabilities').on('change', function(event) {\n                        event.preventDefault();\n                        var formData = form.serializeArray();\n                        var data = {};\n                        $(formData).each(function($k, $d) {\n                            data[$d.name] = $d.value;\n                        });\n\n                        Fragment.loadFragment(\n                            'local_edwiserreports',\n                            'block_overview_display',\n                            contextid, {\n                                capvalue: data.capabilities\n                            }\n                            // eslint-disable-next-line no-unused-vars\n                        ).done(function(html, js, css) {\n                            Templates.replaceNodeContents(modal.modal.find('.cap-overview'), html, js);\n                            switchCapabilitiesBlock(modal);\n                        });\n                    });\n\n                    switchCapabilitiesBlock(modal);\n\n                    form = modal.modal.find('.block-cap-form');\n                    modal.modal.find('.save-block-caps').on('click', function(event) {\n                        event.preventDefault();\n                        var formData = form.serializeArray();\n                        var data = {};\n                        $(formData).each(function($k, $d) {\n                            data[$d.name] = $d.value;\n                        });\n\n                        // Set block capabilities\n                        setBlockCapabilities(reportname, data, function() {\n                            modal.hide();\n                        });\n                    });\n                });\n\n                root.on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                modal.show();\n            });\n        });\n    }\n\n    /**\n     * Format epoch date in given format.\n     *\n     * @param {Integer} date   Epoch date\n     * @param {String}  format Date format\n     * @param {Boolean} utc    To return in utc format\n     * @returns {String}\n     */\n    function formatDate(date, format, utc) {\n        var MMMM = [\"\\x00\", \"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n            \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n        ];\n        var MMM = [\"\\x01\", \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n        var dddd = [\"\\x02\", \"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n        var ddd = [\"\\x03\", \"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\n        // eslint-disable-next-line require-jsdoc\n        function ii(i, len) {\n            var s = i + \"\";\n            len = len || 2;\n            while (s.length < len) {\n                s = \"0\" + s;\n            }\n            return s;\n        }\n\n        var y = utc ? date.getUTCFullYear() : date.getFullYear();\n        format = format.replace(/(^|[^\\\\])yyyy+/g, \"$1\" + y);\n        format = format.replace(/(^|[^\\\\])yy/g, \"$1\" + y.toString().substr(2, 2));\n        format = format.replace(/(^|[^\\\\])y/g, \"$1\" + y);\n\n        var M = (utc ? date.getUTCMonth() : date.getMonth()) + 1;\n        format = format.replace(/(^|[^\\\\])MMMM+/g, \"$1\" + MMMM[0]);\n        format = format.replace(/(^|[^\\\\])MMM/g, \"$1\" + MMM[0]);\n        format = format.replace(/(^|[^\\\\])MM/g, \"$1\" + ii(M));\n        format = format.replace(/(^|[^\\\\])M/g, \"$1\" + M);\n\n        var d = utc ? date.getUTCDate() : date.getDate();\n        format = format.replace(/(^|[^\\\\])dddd+/g, \"$1\" + dddd[0]);\n        format = format.replace(/(^|[^\\\\])ddd/g, \"$1\" + ddd[0]);\n        format = format.replace(/(^|[^\\\\])dd/g, \"$1\" + ii(d));\n        format = format.replace(/(^|[^\\\\])d/g, \"$1\" + d);\n\n        var H = utc ? date.getUTCHours() : date.getHours();\n        format = format.replace(/(^|[^\\\\])HH+/g, \"$1\" + ii(H));\n        format = format.replace(/(^|[^\\\\])H/g, \"$1\" + H);\n\n        // eslint-disable-next-line no-nested-ternary\n        var h = H > 12 ? H - 12 : H == 0 ? 12 : H;\n        format = format.replace(/(^|[^\\\\])hh+/g, \"$1\" + ii(h));\n        format = format.replace(/(^|[^\\\\])h/g, \"$1\" + h);\n\n        var m = utc ? date.getUTCMinutes() : date.getMinutes();\n        format = format.replace(/(^|[^\\\\])mm+/g, \"$1\" + ii(m));\n        format = format.replace(/(^|[^\\\\])m/g, \"$1\" + m);\n\n        var s = utc ? date.getUTCSeconds() : date.getSeconds();\n        format = format.replace(/(^|[^\\\\])ss+/g, \"$1\" + ii(s));\n        format = format.replace(/(^|[^\\\\])s/g, \"$1\" + s);\n\n        var f = utc ? date.getUTCMilliseconds() : date.getMilliseconds();\n        format = format.replace(/(^|[^\\\\])fff+/g, \"$1\" + ii(f, 3));\n        f = Math.round(f / 10);\n        format = format.replace(/(^|[^\\\\])ff/g, \"$1\" + ii(f));\n        f = Math.round(f / 10);\n        format = format.replace(/(^|[^\\\\])f/g, \"$1\" + f);\n\n        var T = H < 12 ? \"AM\" : \"PM\";\n        format = format.replace(/(^|[^\\\\])TT+/g, \"$1\" + T);\n        format = format.replace(/(^|[^\\\\])T/g, \"$1\" + T.charAt(0));\n\n        var t = T.toLowerCase();\n        format = format.replace(/(^|[^\\\\])tt+/g, \"$1\" + t);\n        format = format.replace(/(^|[^\\\\])t/g, \"$1\" + t.charAt(0));\n\n        var tz = -date.getTimezoneOffset();\n        // eslint-disable-next-line no-nested-ternary\n        var K = utc || !tz ? \"Z\" : tz > 0 ? \"+\" : \"-\";\n        if (!utc) {\n            tz = Math.abs(tz);\n            var tzHrs = Math.floor(tz / 60);\n            var tzMin = tz % 60;\n            K += ii(tzHrs) + \":\" + ii(tzMin);\n        }\n        format = format.replace(/(^|[^\\\\])K/g, \"$1\" + K);\n\n        var day = (utc ? date.getUTCDay() : date.getDay()) + 1;\n        format = format.replace(new RegExp(dddd[0], \"g\"), dddd[day]);\n        format = format.replace(new RegExp(ddd[0], \"g\"), ddd[day]);\n\n        format = format.replace(new RegExp(MMMM[0], \"g\"), MMMM[M]);\n        format = format.replace(new RegExp(MMM[0], \"g\"), MMM[M]);\n\n        format = format.replace(/\\\\(.)/g, \"$1\");\n\n        return format;\n    }\n\n    /**\n     * Update time duration in header.\n     * @param {String} date Time period.\n     */\n    function updateTimeLabel(timeperiod) {\n        if (timeperiod == 'all') {\n            $(SELECTOR.DATESELECTED).html(M.util.get_string('alltime', 'local_edwiserreports'));\n            return;\n        }\n        PROMISE.GET_TIMEPERIOD_LABEL(timeperiod).done(function(response) {\n            let startdate = new Date(response.startdate * 86400000);\n            let enddate = new Date(response.enddate * 86400000);\n            let startDay = startdate.getDate();\n            startDay = startDay < 10 ? '0' + startDay : startDay;\n            let endDay = enddate.getDate();\n            endDay = endDay < 10 ? '0' + endDay : endDay;\n\n            var date = `${startDay} ${startdate.toLocaleString('default', { month: 'long' })} ${startdate.getFullYear()} -\n            ${endDay} ${enddate.toLocaleString('default', { month: 'long' })} ${enddate.getFullYear()}</span>`;\n            if(direction == 'rtl'){\n                // format for rtl : yyyy mm dd\n                startdate = startdate.getFullYear() + ' ' + startdate.toLocaleString('default', { month: 'long' }) + ' ' + startDay;\n                enddate = enddate.getFullYear() + ' ' + enddate.toLocaleString('default', { month: 'long' }) + ' ' + endDay;\n                date = enddate + '-' + startdate;\n\n                // Making direction ltr for date selector and aligning text to right\n                $(SELECTOR.DATESELECTED).css({'direction':'ltr','text-align': 'right'});\n            }\n            $(SELECTOR.DATESELECTED).html(date);\n\n            // $(SELECTOR.DATESELECTED).html('<div style=\"display:flex;\"><div>' + `${startDay} ${startdate.toLocaleString('default', { month: 'long' })} ${startdate.getFullYear()}` + '</div> - <div>' +\n            // `${endDay} ${enddate.toLocaleString('default', { month: 'long' })} ${enddate.getFullYear()}</span>` + '</div>');\n        }).fail(function(ex) {\n            Notification.exception(ex);\n        });\n    }\n\n    /**\n     * Handle export options dropdown.\n     * @param {String} target Target id\n     */\n    function exportDropdownHandler(target) {\n        // Explicitly handling dropdown issue.\n        $('body').on('click', function(e) {\n            let button = $(e.target).closest(`${target} [role=\"button\"]`);\n            $(`${target}.show [role=\"button\"]`).not(button)\n                .closest(`${target}`).removeClass('show');\n            if (button.length) {\n                button.closest(`${target}`).toggleClass('show');\n            }\n        });\n    }\n\n    return {\n        loader: loader,\n        toPrecision: toPrecision,\n        insight: insight,\n        timeFormatter: timeFormatter,\n        dateChange: dateChange,\n        formatDate: formatDate,\n        stylePaginationButton: stylePaginationButton,\n        handleSearchInput: handleSearchInput,\n        reloadFilter: reloadFilter,\n        refreshFilter: refreshFilter,\n        refreshSummarycard: refreshSummarycard,\n        handleFilterSize: handleFilterSize,\n        filterToString: filterToString,\n        exportGraphPDF: exportGraphPDF,\n        exportGraphJPEG: exportGraphJPEG,\n        exportGraphPNG: exportGraphPNG,\n        exportGraphSVG: exportGraphSVG,\n        headerNavigation: headerNavigation,\n        handleReportCapability: handleReportCapability,\n        updateTimeLabel: updateTimeLabel,\n        exportDropdownHandler: exportDropdownHandler,\n        setupBlockEditing:setupBlockEditing\n    };\n});\n"],"file":"common.min.js"}
