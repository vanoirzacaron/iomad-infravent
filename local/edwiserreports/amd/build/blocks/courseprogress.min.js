"use strict";define("local_edwiserreports/blocks/courseprogress",["jquery","core/modal_factory","core/modal_events","core/templates","local_edwiserreports/vendor/apexcharts","local_edwiserreports/defaultconfig","local_edwiserreports/common","local_edwiserreports/events","local_edwiserreports/select2"],function(t,e,o,a,n,r,s,i){var c="courseprogressblock",l=null,d="right";"rtl"==t("html").attr("dir")&&(d="left");var p={cohort:0,course:0,group:0,dir:t("html").attr("dir")},u=["81to100","61to80","41to60","21to40","0to20"],g={PANEL:"#courseprogressblock",GRAPH:".graph",COHORT:".cohort-select",COURSE:".course-select",GROUP:".group-select",INSIGHT:"#courseprogressblock .insight",FORMFILTER:'.download-links input[name="filter"]'},f={data:[0,0,0,0,0,0],labels:["81% - 100%","61% - 80%","41% - 60%","21% - 40%","0% - 20%"]},h={plotOptions:{pie:{expandOnClick:!1}},chart:{id:"courseprogress",type:"donut",height:350,events:{dataPointSelection:function(n,r,s){var i,c,l;i=s.dataPointIndex,c=t("".concat(g.PANEL," ").concat(g.COURSE," option:selected")).text(),l=u[i].split("to"),e.create({body:'<label class="text-center w-100 py-2">\n                    <i class="fa fa-circle-o-notch fa-spin"></i>\n                </label>',title:"".concat(c," (").concat(l[0],"% - ").concat(l[1],"%)")}).then(function(t){var e=t.getRoot();e.find(".modal-dialog").addClass("modal-lg"),t.show(),e.on(o.hidden,function(){t.destroy()}),P.GET_TABLE_DATA(u[i]).done(function(e){a.render("local_edwiserreports/modal_table",e).done(function(e,o){a.replaceNodeContents(t.getBody(),e,o)}).fail(Notification.exception)})}).fail(Notification.exception)}}},colors:r.getColorTheme(),fill:{type:"solid"},dataLabels:{enabled:!1},tooltip:{custom:function(t){var e=t.series,o=t.seriesIndex,a=(t.dataPointIndex,t.w),n=e[o],r=n<2?f.tooltipStrings.single:f.tooltipStrings.plural,s=a.config.labels[o],i=a.config.colors[o];return'<div class="custom-donut-tooltip" style="text-align:center">\n                            <div style="color: '.concat(i,';">\n                                <span style="font-weight: 500;"> ').concat(s,':</span>\n                                <span style="font-weight: 700;"> ').concat(n," ").concat(M.util.get_string(r,"local_edwiserreports"),'</span>\n                            </div>\n                            <span style="color: black; font-size: 0.871rem;">').concat(M.util.get_string("clickonchartformoreinfo","local_edwiserreports"),"</span>\n                        </div>")}},legend:{position:d,formatter:function(t,e){return[t+": "+e.w.globals.series[e.seriesIndex]]}},noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},P={GET_COURSEPROGRESS:function(){return t.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_courseprogress_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:t("html").attr("lang"),data:JSON.stringify(p)}})},GET_TABLE_DATA:function(e){return t.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_courseprogress_modal_data",secret:M.local_edwiserreports.secret,lang:t("html").attr("lang"),data:JSON.stringify({filter:p,range:e})}})}};function E(t,e){s.loader.show(g.PANEL),s.reloadFilter(g.PANEL,t,p.cohort,p.course,p.group,e)}function A(t,e){null!==l&&l.destroy(),(l=new n(t.get(0),e)).render(),setTimeout(function(){s.loader.hide(g.PANEL)},1e3)}function G(){t(g.PANEL).find(g.FORMFILTER).val(JSON.stringify(p)),s.loader.show(g.PANEL),P.GET_COURSEPROGRESS().done(function(t){!0!==t.error||"invalidsecretkey"!==t.exception.errorcode?(f.data=t.data,f.average=s.toPrecision(t.average,2),f.tooltipStrings=t.tooltip):invalidUser("courseprogressblock",t)}).fail(function(t){f.average="0"}).always(function(){s.insight(g.INSIGHT,{insight:{value:f.average+"%",title:"averagecourseprogress"}}),data=Object.assign({},h),0!=f.data.length?(data.labels=f.labels,data.series=f.data.reverse()):(data.labels=[],data.series=[]),A(t(g.PANEL).find(g.GRAPH),data),s.loader.hide(g.PANEL)})}return{init:function(e){0!=t(g.COURSE).length&&0!=t(g.PANEL).length&&(p.course=t("".concat(g.PANEL," ").concat(g.COURSE)).val(),t(g.PANEL+" .singleselect").select2(),t("body").on("change","".concat(g.PANEL," ").concat(g.COHORT),function(){p.cohort=parseInt(t(this).val()),E(["course","noallcourses"],function(){setTimeout(function(){p.course=t("".concat(g.PANEL," ").concat(g.COURSE," option:first-child")).val(),t("".concat(g.PANEL," ").concat(g.COURSE)).val(p.course).trigger("change")},50)})}),t("body").on("change","".concat(g.PANEL," ").concat(g.COURSE),function(){p.course=parseInt(t(this).val()),p.group=0,E(["group"],function(){G()})}),t("body").on("change","".concat(g.PANEL," ").concat(g.GROUP),function(){p.group=parseInt(t(this).val()),G()}),t(document).on(i.EXPORTGRAPHPDF+"-"+c,function(){var e=t(g.PANEL).find(g.GRAPH);s.exportGraphPDF(l,p,e.width(),e.height())}),t(document).on(i.EXPORTGRAPHJPEG+"-"+c,function(){s.exportGraphJPEG(l,p)}),t(document).on(i.EXPORTGRAPHPNG+"-"+c,function(){s.exportGraphPNG(l,p)}),t(document).on(i.EXPORTGRAPHSVG+"-"+c,function(){s.exportGraphSVG(l,p)}),setInterval(function(){if(null!==l){var e=t(g.PANEL).find(".apexcharts-canvas").width(),o=e>=400?"right":"bottom";"rtl"==t("html").attr("dir")&&(o=e>=400?"left":"bottom"),o!=d&&(d=o,l.updateOptions({legend:{position:d}}))}},1e3),s.handleFilterSize(g.PANEL),G())},download:function(e,o,a){switch(f.data=a.data,data=Object.assign({},h),0!=f.data.length?(data.labels=f.labels,data.series=f.data.reverse()):(data.labels=[],data.series=[]),data.tooltip={enabled:!1},data.chart.animations={enabled:!1},t(g.PANEL).find(g.GRAPH).toggleClass("empty-donut",0==f.data.length),A(t(g.PANEL).find(g.GRAPH),data),e){case"pdfimage":var n=t(g.PANEL).find(g.GRAPH);s.exportGraphPDF(l,p,n.width(),n.height(),o);break;case"jpeg":s.exportGraphJPEG(l,p,o);break;case"png":s.exportGraphPNG(l,p,o);break;case"svg":s.exportGraphSVG(l,p,o)}}}});
//# sourceMappingURL=courseprogress.min.js.map
