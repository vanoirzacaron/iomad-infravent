"use strict";define("local_edwiserreports/blocks/learnertimespentonsite",["jquery","local_edwiserreports/vendor/apexcharts","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/select2"],function(e,t,a,n){var o=null,r={date:"last7days",dir:e("html").attr("dir")},i={series:[],chart:{type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0},y:{title:{}}},stroke:{curve:"smooth",width:2},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},dataLabels:{enabled:!1},colors:[n.getColorTheme()[2]]},l={chart:{type:"donut",height:350},legend:{position:"bottom",offsetY:0},noData:{text:M.util.get_string("nographdata","local_edwiserreports")},theme:{monochrome:{enabled:!0,color:n.getColorTheme()[2],shadeTo:"light",shadeIntensity:.65}}},s={PANEL:"#learnertimespentonsiteblock",DATE:".learnertimespentonsite-calendar",DATEMENU:".learnertimespentonsite-calendar + .dropdown-menu",DATEITEM:".learnertimespentonsite-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".learnertimespentonsite-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".learnertimespentonsite-calendar + .dropdown-menu .flatpickr",GRAPH:"#apex-chart-learnertimespentonsite-block"},d={GET_TIMESPENTONSITE:function(t){return e.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_learnertimespentonsite_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:t})}})}};function c(){a.loader.show(s.PANEL),d.GET_TIMESPENTONSITE(r).done(function(n){var d;r.date.includes(" to ")||-1!==["last7days","weekly","monthly","yearly"].indexOf(r.date)?((d=Object.assign({},i)).yaxis={labels:{formatter:a.timeFormatter}},d.xaxis.categories=n.dates.map(function(e){return 864e5*e}),d.series=[{name:M.util.get_string("timespentonlms","local_edwiserreports"),data:n.timespent}],d.chart.toolbar.show=n.dates.length>29,d.chart.zoom.enabled=n.dates.length>29,d.tooltip.y.title.formatter=function(e){return M.util.get_string("time","local_edwiserreports")+": "},e(s.PANEL).find(".panel-body").attr("data-charttype","line")):((d=Object.assign({},l)).labels=n.labels,d.series=n.timespent,d.tooltip={custom:function(e){var t=e.series,n=e.seriesIndex,o=e.dataPointIndex,r=e.w,i=a.timeFormatter(t[n],{dataPointIndex:o}),l=r.config.labels[n];return'<div class="custom-donut-tooltip theme-2-text">\n                                    <span style="font-weight: 500;"> '.concat(l,':</span>\n                                    <span style="font-weight: 700;"> ').concat(i," </span>\n                                </div>")}},d.legend={show:!1},e(s.PANEL).find(".panel-body").attr("data-charttype","donut")),function(e,n){null!==o&&o.destroy(),(o=new t(e.get(0),n)).render(),setTimeout(function(){a.loader.hide(s.PANEL)},1e3)}(e(s.PANEL).find(s.GRAPH),d),a.loader.hide(s.PANEL)}).fail(function(e){a.loader.hide(s.PANEL)})}function p(){e(s.PANEL).find(s.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(s.PANEL).find(s.DATEPICKER).get(0),onOpen:function(){e(s.PANEL).find(s.DATEMENU).addClass("withcalendar")},onClose:function(){e(s.PANEL).find(s.DATEMENU).removeClass("withcalendar"),function(t){var a=e(s.PANEL).find(s.DATEPICKERINPUT).val(),n=e(s.PANEL).find(s.DATEPICKERINPUT).next().val();if(""!=a){if("rtl"==r.dir){if(n.includes("to")){var o=n.split("to"),i=o[0].split("/"),l=o[1].split("/");i=i[2]+"/"+i[1]+"/"+i[0],n=(l=l[2]+"/"+l[1]+"/"+l[0])+"-"+i}else{var d=n.split("/");n=d=d[2]+"/"+d[1]+"/"+d[0]}e(s.DATE).css({direction:"ltr","text-align":"right"}),e(s.DATEPICKERINPUT).css({direction:"ltr","text-align":"right"})}e(s.PANEL).find(s.DATEITEM).removeClass("active"),e(s.PANEL).find(s.DATEITEM+".custom").addClass("active"),e(s.PANEL).find(s.DATE).html(n),r.date=a,c()}}()}}),e("body").on("click",s.DATEITEM+":not(.custom)",function(){e(s.PANEL).find(s.DATEITEM).removeClass("active"),e(this).addClass("active"),e(s.PANEL).find(s.DATE).html(e(this).text()),r.date=e(this).data("value"),c()})}return{init:function(t,a){r.date=a,0!=e(s.PANEL).length&&(p(),c())}}});
//# sourceMappingURL=learnertimespentonsite.min.js.map
