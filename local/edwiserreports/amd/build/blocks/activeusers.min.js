"use strict";define("local_edwiserreports/blocks/activeusers",["jquery","core/modal_factory","core/modal_events","core/templates","local_edwiserreports/vendor/apexcharts","core/notification","local_edwiserreports/defaultconfig","local_edwiserreports/events","local_edwiserreports/common","local_edwiserreports/flatpickr"],function(e,t,a,o,r,i,n,s,l){var c=null,d="activeusersblock",p=null,u=null,f=null,h={PANEL:"#activeusersblock",RESETTIME:"#activeusersblock #updated-time > span.minute",REFRESH:"#activeusersblock .refresh",CONTEXT:"[data-contextid]",FORMFILTER:"#activeusers .download-links input[name='filter']",MODALROOT:".siteoverview-modal-tables",MODALLINK:".siteoverview-modal-tables .nav .nav-link",MODALTAB:".siteoverview-modal-tables .tabs .tab"},g={GET_DATA:function(){return e.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_activeusers_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:u,graphajax:!0})}})},GET_TABLE_DATA:function(t,a){return e.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_siteoverviewstatus_block_modal_data",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({date:t,type:a})}})}},v={series:[],chart:{id:"activeusers",type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1},events:{click:function(e,r,n){if(-1!=n.dataPointIndex){var s={},c="active";["activeusers","enrolments","completions"].forEach(function(e,t){-1===n.globals.collapsedSeriesIndices.indexOf(t)&&(s[e]={active:c},c="")}),s.date=n.config.xaxis.categories[n.dataPointIndex]/864e5,function(e){o.render("local_edwiserreports/siteoverviewblock_modal_body",e).done(function(o,r){t.create({body:o,title:"".concat(M.util.get_string("activeusersheader","local_edwiserreports")," (").concat(l.formatDate(new Date(864e5*e.date),"d MMM yyyy"),")")}).then(function(t){var o=t.getRoot();o.find(".modal-dialog").addClass("modal-lg"),t.show(),o.on(a.hidden,function(){t.destroy()}),m(e.date,t.getBody().find(h.MODALROOT),t.getBody().find(".nav-link.active").data("target"))}).fail(i.exception)})}(s)}}}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0},custom:function(e){e.series,e.seriesIndex;for(var t=e.dataPointIndex,a=e.w,o='\n                <div class="apexcharts-tooltip-title" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;">\n                    '.concat(l.formatDate(new Date(a.config.xaxis.categories[t]),"d MMM yyyy"),"\n                </div>"),r=0;r<a.config.series.length;r++){0!=a.config.series[r].data.length&&(o+='<div class="apexcharts-tooltip-series-group apexcharts-active" style="order: '.concat(r,'; display: flex;">\n                        <span class="apexcharts-tooltip-marker" style="background-color: ').concat(a.config.colors[r],';"></span>\n                        <div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;">\n                            <div class="apexcharts-tooltip-y-group">\n                                <span class="apexcharts-tooltip-text-y-label">').concat(a.config.series[r].name,': </span>\n                                <span class="apexcharts-tooltip-text-y-value">').concat(a.config.series[r].data[t],"</span>\n                            </div>\n                        </div>\n                    </div>"))}return o+'\n                    <span style="color: black; font-size: 0.871rem; order: 4; padding: 0px 15px;">'.concat(M.util.get_string("clickondatapoint","local_edwiserreports"),"</span>\n                ")}},stroke:{curve:"smooth",width:2,lineCap:"round"},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},yaxis:{labels:{formatter:function(e,t){return void 0===e?e:e.toFixed(0)}}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},colors:n.getColorTheme(),dataLabels:{enabled:!1}};function m(e,t,a){g.GET_TABLE_DATA(e,a).done(function(e){o.render("local_edwiserreports/modal_table",e).done(function(e,r){var i=t.find('[data-id="'.concat(a,'"]'));i.data("loaded",!0),o.replaceNodeContents(i,e,r)}).fail(i.exception)})}function x(){l.loader.show(h.PANEL),g.GET_DATA().done(function(e){!0!==e.error||"invalidsecretkey"!==e.exception.errorcode?(c.graph.data=e.data,c.graph.labels=e.dates.map(function(e){return 864e5*e}),l.insight(h.PANEL+" .insight",e.insight)):invalidUser("activeusersblock",e)}).fail(function(e){i.exception(e)}).always(function(){p=function(){p&&p.destroy();return(p=new r(e("#apex-chart-active-users").get(0),function(){var e=Object.assign({},v);try{e.series=[{name:c.graph.labelName.activeUsers,data:c.graph.data.activeUsers},{name:c.graph.labelName.enrolments,data:c.graph.data.enrolments},{name:c.graph.labelName.completionRate,data:c.graph.data.completionRate}],e.xaxis.categories=c.graph.labels,e.chart.toolbar.show=c.graph.labels.length>29,e.chart.zoom.enabled=c.graph.labels.length>29}catch(t){e.series=[],e.xaxis.categories=[],e.chart.toolbar.show=!1,e.chart.zoom.enabled=!1}return e}())).render(),p}(),e(h.PANEL).find('.download-links input[name="filter"]').val(u),e(h.RESETTIME).html(0),clearInterval(f),f=setInterval(y,6e4),e(h.REFRESH).removeClass("refresh-spin"),l.loader.hide(h.PANEL)})}function y(){e(h.RESETTIME).html(parseInt(e(h.RESETTIME).text())+1)}return{init:function(t,a){u=a,console.log("filter::::"),console.log(u),e(h.FORMFILTER).val(u),(c=n.getActiveUsersBlock())&&x(),e(h.REFRESH).on("click",function(){e(this).addClass("refresh-spin"),x()}),l.dateChange(function(t){u=t,e(h.FORMFILTER).val(u),e("#userfilter .download-links input[name='filter']").val(u),x()}),e(document).on(s.EXPORTGRAPHPDF+"-"+d,function(){var t=e(h.PANEL).find(".apexcharts-canvas");l.exportGraphPDF(p,{date:u},t.width(),t.height())}),e(document).on(s.EXPORTGRAPHJPEG+"-"+d,function(){l.exportGraphJPEG(p,{date:u})}),e(document).on(s.EXPORTGRAPHPNG+"-"+d,function(){l.exportGraphPNG(p,{date:u})}),e(document).on(s.EXPORTGRAPHSVG+"-"+d,function(){l.exportGraphSVG(p,{date:u})}),e("body").on("click",h.MODALLINK,function(){var t=e(this).data("target");e(h.MODALLINK).removeClass("active"),e(this).addClass("active"),e(h.MODALTAB).removeClass("active"),e(h.MODALTAB+'[data-id="'.concat(t,'"]')).addClass("active"),e(h.MODALTAB+'[data-id="'.concat(t,'"]')).data("loaded")||m(e(h.MODALROOT).data("date"),e(h.MODALROOT),t)})},download:function(t,a,o){var i=Object.assign({},v);switch(i.series=[{name:M.util.get_string("activeusers","local_edwiserreports"),data:o.data.activeUsers},{name:M.util.get_string("courseenrolment","local_edwiserreports"),data:o.data.enrolments},{name:M.util.get_string("coursecompletionrate","local_edwiserreports"),data:o.data.completionRate}],i.xaxis.categories=o.dates.map(function(e){return 864e5*e}),i.chart.toolbar.show=!1,i.tooltip={enabled:!1},i.chart.animations={enabled:!1},(p=new r(e("#apex-chart-active-users").get(0),i)).render(),t){case"pdfimage":var n=e("#apex-chart-active-users");l.exportGraphPDF(p,u,n.width(),n.height(),a);break;case"jpeg":l.exportGraphJPEG(p,u,a);break;case"png":l.exportGraphPNG(p,u,a);break;case"svg":l.exportGraphSVG(p,u,a)}}}});
//# sourceMappingURL=activeusers.min.js.map
