{"version":3,"sources":["blocks/activecourses.js"],"names":["define","$","CFG","common","SELECTOR","PANEL","COHORT","TABLE","FORMFILTER","SEARCH","USERS","filter","cohort","dir","attr","dataTable","PROMISE","GET_ACTIVECOURSES","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","JSON","stringify","loadData","loader","show","done","response","destroy","DataTable","responsive","dom","aaSorting","aoColumns","orderSequence","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","columnDefs","targets","className","orderable","lengthChange","bInfo","on","column","order","nodes","each","cell","i","img","image_url","innerHTML","addClass","draw","fail","console","log","always","hide","init","invalidUser","length","val","find","select2","concat","columns","search"],"mappings":"AAAA,aAyBAA,OAAO,4CAA6C,CAAC,SAAU,qCAAsC,+BAAgC,SAAUC,EAAGC,EAAKC,GAIrJ,IAAIC,EAAW,CACbC,MAAO,sBACPC,OAAQ,iBACRC,MAAO,4BACPC,WAAY,sDACZC,OAAQ,4BACRC,MAAO,6CAMLC,EAAS,CACXC,OAAQ,EACRC,IAAKZ,EAAE,QAAQa,KAAK,QAMlBC,EAAY,KAKZC,EAAU,CAMZC,kBAAmB,SAA2BN,GAC5C,OAAOV,EAAEiB,KAAK,CACZC,IAAKjB,EAAIkB,WACTC,KAAMnB,EAAIoB,YACVC,SAAUrB,EAAIsB,gBACdC,KAAM,CACJC,OAAQ,8BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAM7B,EAAE,QAAQa,KAAK,QACrBW,KAAMM,KAAKC,UAAU,CACnBrB,OAAQA,SAUlB,SAASsB,IAEP9B,EAAO+B,OAAOC,KAAK/B,EAASC,OAC5BW,EAAQC,kBAAkBN,GAAQyB,KAAK,SAAUC,GAC7B,OAAdtB,GACFA,EAAUuB,WAEZvB,EAAYd,EAAEG,EAASG,OAAOgC,UAAU,CACtCC,YAAY,EACZf,KAAMY,EAASZ,KACfgB,IAAK,mDACLC,UAAW,CAAC,CAAC,EAAG,SAChBC,UAAW,CAAC,KAAM,KAAM,CACtBC,cAAiB,CAAC,SACjB,CACDA,cAAiB,CAAC,SACjB,CACDA,cAAiB,CAAC,UAEpBC,SAAU,CACRC,KAAMlB,EAAEmB,KAAKC,WAAW,YAAa,wBACrCC,UAAWrB,EAAEmB,KAAKC,WAAW,YAAa,wBAC1CE,WAAYtB,EAAEmB,KAAKC,WAAW,YAAa,wBAC3CG,YAAavB,EAAEmB,KAAKC,WAAW,cAAe,wBAC9CI,SAAU,CACRC,SAAU,IACVC,KAAM,MAGVC,aAAc,WACZpD,EAAOqD,sBAAsBC,OAE/BC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,iBACbC,WAAa,GACZ,CACDF,QAAW,EACXC,UAAa,YACbC,WAAa,GACZ,CACDF,QAAW,OACXC,UAAa,gBAEfE,cAAc,EACdC,OAAO,KAGCC,GAAG,WAAY,WACvBjD,EAAUkD,OAAO,EAAG,CAClBC,MAAO,YACNC,QAAQC,KAAK,SAAUC,EAAMC,GAC9B,IAAIC,EAAM,GACND,GAAK,GAAKA,GAAK,IACjBC,EAAM,0BAA4B3C,EAAEmB,KAAKyB,UAAU,UAAY,CAAC,OAAQ,SAAU,UAAUF,GAAI,wBAA0B,YAE5HD,EAAKI,UAAYH,EAAI,EAAIC,IAE3BtE,EAAEG,EAASG,MAAQ,0BAA0BmE,SAAS,cACrDC,SACFC,KAAK,SAAUnD,GAChBoD,QAAQC,IAAIrD,KACXsD,OAAO,WAER5E,EAAO+B,OAAO8C,KAAK5E,EAASC,SAqChC,MAAO,CACL4E,KA9BF,SAAcC,GAEqB,IAA7BjF,EAAEG,EAASC,OAAO8E,SAKtBxE,EAAOE,IAAMZ,EAAE,QAAQa,KAAK,OAC5Bb,EAAEG,EAASI,YAAY4E,IAAIrD,KAAKC,UAAUrB,IAG1CV,EAAEG,EAASC,OAAOgF,KAAK,iBAAiBC,UACxCrD,IAGAhC,EAAE,QAAQ+D,GAAG,SAAU,GAAGuB,OAAOnF,EAASC,MAAO,KAAKkF,OAAOnF,EAASE,QAAS,WAC7E,IAAIM,EAASX,EAAEwD,MAAM2B,MACrBzE,EAAOC,OAASA,EAChBX,EAAEG,EAASC,OAAOgF,KAAK,0CAA0CD,IAAIxE,GACrEqB,MAIFhC,EAAE,QAAQ+D,GAAG,QAAS,GAAGuB,OAAOnF,EAASC,MAAO,KAAKkF,OAAOnF,EAASK,QAAS,WAC5EM,EAAUyE,QAAQ,GAAGC,OAAOxF,EAAEwD,MAAM2B,OAAOT","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Active Courses / Popular Courses block.\n *\n * @package     local_edwiserreports\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine('local_edwiserreports/blocks/activecourses', [\n    'jquery',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/common',\n], function(\n    $,\n    CFG,\n    common\n) {\n\n    /**\n     * Selectors.\n     */\n    var SELECTOR = {\n        PANEL: '#activecoursesblock',\n        COHORT: '.cohort-select',\n        TABLE: '#activecoursesblock table',\n        FORMFILTER: '#activecoursesblock .download-links [name=\"filter\"]',\n        SEARCH: '.table-search-input input',\n        USERS: '#activecoursesblock table a.modal-trigger'\n    };\n\n    /**\n     * Filter.\n     */\n    var filter = {\n        cohort: 0,\n        dir: $('html').attr('dir')\n    };\n\n    /**\n     * Data table object.\n     */\n    var dataTable = null;\n\n    /**\n     * Promises list.\n     */\n    let PROMISE = {\n        /**\n         * Get timespent on site using filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_ACTIVECOURSES: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_activecourses_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        }\n    };\n\n    /**\n     * Load data to dataTable using ajax.\n     */\n    function loadData() {\n        // Show loader.\n        common.loader.show(SELECTOR.PANEL);\n\n        PROMISE.GET_ACTIVECOURSES(filter).done(function(response) {\n                if (dataTable !== null) {\n                    dataTable.destroy();\n                }\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    responsive: true,\n                    data: response.data,\n                    dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                    aaSorting: [\n                        [2, 'desc']\n                    ],\n                    aoColumns: [\n                        null,\n                        null,\n                        { \"orderSequence\": [\"desc\"] },\n                        { \"orderSequence\": [\"desc\"] },\n                        { \"orderSequence\": [\"desc\"] }\n                    ],\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('nocourses', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: \" \",\n                            next: \" \"\n                        }\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                    },\n                    columnDefs: [{\n                            \"targets\": 0,\n                            \"className\": \"text-left pl-5\",\n                            \"orderable\": false\n                        },\n                        {\n                            \"targets\": 1,\n                            \"className\": \"text-left\",\n                            \"orderable\": false\n                        },\n                        {\n                            \"targets\": \"_all\",\n                            \"className\": \"text-center\",\n                        }\n                    ],\n                    lengthChange: false,\n                    bInfo: false\n                });\n                /* Added fixed column rank in datatable */\n                dataTable.on('order.dt', function() {\n                    dataTable.column(0, { order: 'applied' }).nodes().each(function(cell, i) {\n                        let img = '';\n                        if (i >= 0 && i <= 2) {\n                            img = \"<img class='ml-1' src='\" + M.util.image_url('trophy/' + ['gold', 'silver', 'bronze'][i], 'local_edwiserreports') + \"'></img>\";\n                        }\n                        cell.innerHTML = (i + 1) + img;\n                    });\n                    $(SELECTOR.TABLE + \" td:not(.bg-secondary)\").addClass(\"bg-white\");\n                }).draw();\n            })\n            .fail(function(data) {\n                console.log(data);\n            })\n            .always(function() {\n                // Hide loader.\n                common.loader.hide(SELECTOR.PANEL);\n            });\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n\n        // Block not present on page.\n        if ($(SELECTOR.PANEL).length === 0) {\n            return;\n        }\n\n        // Updated export filter values.\n        filter.dir = $('html').attr('dir');\n        $(SELECTOR.FORMFILTER).val(JSON.stringify(filter));\n\n        // Enable select2 on cohort filter.\n        $(SELECTOR.PANEL).find('.singleselect').select2();\n\n        loadData();\n\n        // On change of cohort filter.\n        $('body').on('change', `${SELECTOR.PANEL} ${SELECTOR.COHORT}`, function() {\n            let cohort = $(this).val();\n            filter.cohort = cohort;\n            $(SELECTOR.PANEL).find('.download-links input[name=\"cohortid\"]').val(cohort);\n            loadData();\n        });\n\n        // Search in table.\n        $('body').on('input', `${SELECTOR.PANEL} ${SELECTOR.SEARCH}`, function() {\n            dataTable.columns(1).search($(this).val()).draw();\n        });\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"activecourses.min.js"}
