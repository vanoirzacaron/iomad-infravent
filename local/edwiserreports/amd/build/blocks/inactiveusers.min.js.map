{"version":3,"sources":["blocks/inactiveusers.js"],"names":["define","$","cfg","V","common","filter","dir","attr","init","invalidUser","panel","getPanel","panelBody","table","dropdown","dropdownToggle","inActiveUsersTable","exportUrlLink","searchTable","getInactiveUsersData","loader","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","JSON","stringify","done","response","error","exception","errorcode","clear","rows","add","draw","fail","always","hide","val","length","DataTable","dom","aaSorting","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","columnDefs","targets","className","drawCallback","stylePaginationButton","this","responsive","lengthChange","bInfo","on","find","html","changeExportUrl","filterReplaceFlag","search","value"],"mappings":"AAAA,aAwBAA,OAAO,4CAA6C,CAAC,SAAU,qCAAsC,iCAAkC,8BAA+B,yCAA0C,8CAA+C,SAAUC,EAAGC,EAAKC,EAAGC,GAIlR,IAAIC,EAAS,CACXC,IAAKL,EAAE,QAAQM,KAAK,QAuHtB,MAAO,CACLC,KAjHF,SAAcC,GACZ,IAAIC,EAAQR,EAAIS,SAAS,uBACrBC,EAAYV,EAAIS,SAAS,sBAAuB,QAEhDE,GADaX,EAAIS,SAAS,sBAAuB,SACzCC,EAAY,wBAGpBE,EAAWF,EAAY,iCACvBG,EAAiBH,EAAY,0BAC7BI,EAAqB,KACrBC,EAAgBP,EAAQ,oEACxBQ,EAAcR,EAAQ,6BAoE1B,SAASS,EAAqBd,GAE5BD,EAAOgB,OAAOC,KAAK,uBACnBpB,EAAEqB,KAAK,CACLC,IAAKrB,EAAIsB,WACTC,KAAMvB,EAAIwB,YACVC,SAAUzB,EAAI0B,gBACdC,KAAM,CACJC,OAAQ,8BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAMjC,EAAE,QAAQM,KAAK,QACrBsB,KAAMM,KAAKC,UAAU,CACnB/B,OAAQA,OAGXgC,KAAK,SAAUC,IACO,IAAnBA,EAASC,OAAmD,qBAAjCD,EAASE,UAAUC,WAIlDzB,EAAmB0B,QACnB1B,EAAmB2B,KAAKC,IAAIN,EAAST,MACrCb,EAAmB6B,QALjBpC,EAAY,qBAAsB6B,KAMnCQ,KAAK,SAAUP,MAEfQ,OAAO,WAER3C,EAAOgB,OAAO4B,KAAK,yBA5FvB3C,EAAOC,IAAML,EAAE,QAAQM,KAAK,OAC5BN,EAAE,uDAAuDgD,IAAId,KAAKC,UAAU/B,IACxEJ,EAAES,GAAOwC,SAEXlC,EAAqBf,EAAEY,GAAOsC,UAAU,CACtCC,IAAK,mDACLC,UAAW,CAAC,CAAC,EAAG,SAChBC,SAAU,CACRC,KAAMvB,EAAEwB,KAAKC,WAAW,YAAa,wBACrCC,UAAW1B,EAAEwB,KAAKC,WAAW,YAAa,wBAC1CE,WAAY3B,EAAEwB,KAAKC,WAAW,kBAAmB,wBACjDG,YAAa5B,EAAEwB,KAAKC,WAAW,cAAe,wBAC9CI,SAAU,CACRC,SAAU,IACVC,KAAM,MAGVC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,qDACZ,CACDD,QAAW,EACXC,UAAa,gBAEfC,aAAc,WACZ/D,EAAOgE,sBAAsBC,MAE7BjE,EAAOgB,OAAO4B,KAAK,wBAErBsB,YAAY,EACZC,cAAc,EACdC,OAAO,IAITrD,EAAqBlB,EAAEa,GAAUe,KAAK,UAKtC5B,EAAEa,GAAU2D,GAAG,QAAS,WAEtB,IAAIpE,EAASJ,EAAEoE,MAAMxC,KAAK,SAC1B5B,EAAES,GAAOgE,KAAK,wCAAwCzB,IAAI5C,GAG1DJ,EAAEc,GAAgB4D,KAAK1E,EAAEoE,MAAMM,QAG/BzE,EAAI0E,gBAAgBvE,EAAQY,EAAed,EAAE0E,mBAG7C1D,EAAqBlB,EAAEoE,MAAMxC,KAAK,YAIpC5B,EAAE,QAAQwE,GAAG,QAASvD,EAAa,WACjCF,EAAmB8D,OAAOT,KAAKU,OAAOlC","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine('local_edwiserreports/blocks/inactiveusers', [\n    'jquery',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/variables',\n    'local_edwiserreports/common',\n    'local_edwiserreports/jquery.dataTables',\n    'local_edwiserreports/dataTables.bootstrap4'\n], function(\n    $,\n    cfg,\n    V,\n    common\n) {\n\n    /**\n     * Filter.\n     */\n    var filter = {\n        dir: $('html').attr('dir')\n    };\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        var panel = cfg.getPanel(\"#inactiveusersblock\");\n        var panelBody = cfg.getPanel(\"#inactiveusersblock\", \"body\");\n        var panelTitle = cfg.getPanel(\"#inactiveusersblock\", \"title\");\n        var table = panelBody + \" #inactiveuserstable\";\n        var tableWrapper = panelBody + \" #inactiveuserstable_wrapper\";\n        var loader = panelBody + \" .loader\";\n        var dropdown = panelBody + \" .dropdown-menu .dropdown-item\";\n        var dropdownToggle = panelBody + \" button.dropdown-toggle\";\n        var inActiveUsersTable = null;\n        var exportUrlLink = panel + \" .dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item\";\n        var searchTable = panel + \" .table-search-input input\";\n\n        // Updated export filter values.\n        filter.dir = $('html').attr('dir');\n        $('#inactiveusersblock .download-links [name=\"filter\"]').val(JSON.stringify(filter));\n\n        if ($(panel).length) {\n            // Rending data table.\n            inActiveUsersTable = $(table).DataTable({\n                dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                aaSorting: [\n                    [2, 'desc']\n                ],\n                language: {\n                    info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                    infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                    emptyTable: M.util.get_string('noinactiveusers', 'local_edwiserreports'),\n                    zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                    paginate: {\n                        previous: \" \",\n                        next: \" \"\n                    }\n                },\n                columnDefs: [{\n                    \"targets\": 1,\n                    \"className\": \"d-none d-sm-none d-md-table-cell d-lg-table-cell \"\n                }, {\n                    \"targets\": 2,\n                    \"className\": \"text-center\"\n                }],\n                drawCallback: function() {\n                    common.stylePaginationButton(this);\n                    // Hide loader.\n                    common.loader.hide('#inactiveusersblock');\n                },\n                responsive: true,\n                lengthChange: false,\n                bInfo: false\n            });\n\n            // Get inactive users data on load\n            getInactiveUsersData($(dropdown).data(\"value\"));\n\n            /**\n             * On click of dropdown get inactive user list based on filter\n             */\n            $(dropdown).on(\"click\", function() {\n                // Get filter\n                var filter = $(this).data(\"value\");\n                $(panel).find('.download-links input[name=\"filter\"]').val(filter);\n\n                // Set dropdown button value\n                $(dropdownToggle).html($(this).html());\n\n                // Change export data url\n                cfg.changeExportUrl(filter, exportUrlLink, V.filterReplaceFlag);\n\n                // Get inactive users\n                getInactiveUsersData($(this).data(\"value\"));\n            });\n\n            // Search in table.\n            $('body').on('input', searchTable, function() {\n                inActiveUsersTable.search(this.value).draw();\n            });\n        }\n\n        /**\n         * Get inactive users list based on filter\n         * @param  {string} filter Filter\n         */\n        function getInactiveUsersData(filter) {\n\n            // Show loader.\n            common.loader.show('#inactiveusersblock');\n\n            $.ajax({\n                    url: cfg.requestUrl,\n                    type: cfg.requestType,\n                    dataType: cfg.requestDataType,\n                    data: {\n                        action: 'get_inactiveusers_data_ajax',\n                        secret: M.local_edwiserreports.secret,\n                        lang: $('html').attr('lang'),\n                        data: JSON.stringify({\n                            filter: filter\n                        })\n                    },\n                })\n                .done(function(response) {\n                    if (response.error === true && response.exception.errorcode === 'invalidsecretkey') {\n                        invalidUser('inactiveusersblock', response);\n                        return;\n                    }\n                    inActiveUsersTable.clear();\n                    inActiveUsersTable.rows.add(response.data);\n                    inActiveUsersTable.draw();\n                })\n                .fail(function(error) {\n                    // console.log(error);\n                }).always(function() {\n                    // Hide loader.\n                    common.loader.hide('#inactiveusersblock');\n                });\n        }\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"inactiveusers.min.js"}
