{"version":3,"sources":["blocks/certificatestats.js"],"names":["define","$","CFG","common","SELECTOR","PANEL","COHORT","TABLE","SEARCH","USERS","FORMFILTER","filter","cohort","dir","attr","dataTable","PROMISE","GET_CERTIFICATES","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","lang","JSON","stringify","loadData","loader","show","done","response","destroy","DataTable","responsive","dom","columns","columnDefs","targets","className","language","info","util","get_string","infoEmpty","emptyTable","zeroRecords","paginate","previous","next","drawCallback","stylePaginationButton","this","lengthChange","bInfo","fail","console","log","always","hide","init","invalidUser","length","val","find","select2","on","concat","search","draw"],"mappings":"AAAA,aAyBAA,OAAO,+CAAgD,CAAC,SAAU,qCAAsC,+BAAgC,SAAUC,EAAGC,EAAKC,GAIxJ,IAAIC,EAAW,CACbC,MAAO,qBACPC,OAAQ,iBACRC,MAAO,2BACPC,OAAQ,4BACRC,MAAO,2CACPC,WAAY,sDAMVC,EAAS,CACXC,OAAQ,EACRC,IAAKZ,EAAE,QAAQa,KAAK,QAMlBC,EAAY,KAKZC,EAAU,CAMZC,iBAAkB,SAA0BN,GAC1C,OAAOV,EAAEiB,KAAK,CACZC,IAAKjB,EAAIkB,WACTC,KAAMnB,EAAIoB,YACVC,SAAUrB,EAAIsB,gBACdC,KAAM,CACJC,OAAQ,6BACRC,OAAQC,EAAEC,qBAAqBF,OAC/BG,KAAM7B,EAAE,QAAQa,KAAK,QACrBW,KAAMM,KAAKC,UAAU,CACnBrB,OAAQA,SAUlB,SAASsB,IAEP9B,EAAO+B,OAAOC,KAAK/B,EAASC,OAC5BW,EAAQC,iBAAiBN,GAAQyB,KAAK,SAAUC,GAC5B,OAAdtB,GACFA,EAAUuB,UAEZvB,EAAYd,EAAEG,EAASG,OAAOgC,UAAU,CACtCC,YAAY,EACZf,KAAMY,EAASZ,KACfgB,IAAK,mDACLC,QAAS,CAAC,CACRjB,KAAQ,QACP,CACDA,KAAQ,cACP,CACDA,KAAQ,UACP,CACDA,KAAQ,cAEVkB,WAAY,CAAC,CACXC,QAAW,CAAC,EAAG,GACfC,UAAa,aACZ,CACDD,QAAW,OACXC,UAAa,gBAEfC,SAAU,CACRC,KAAMnB,EAAEoB,KAAKC,WAAW,YAAa,wBACrCC,UAAWtB,EAAEoB,KAAKC,WAAW,YAAa,wBAC1CE,WAAYvB,EAAEoB,KAAKC,WAAW,iBAAkB,wBAChDG,YAAaxB,EAAEoB,KAAKC,WAAW,cAAe,wBAC9CI,SAAU,CACRC,SAAU,IACVC,KAAM,MAGVC,aAAc,WACZrD,EAAOsD,sBAAsBC,OAE/BC,cAAc,EACdC,OAAO,MAERC,KAAK,SAAUpC,GAChBqC,QAAQC,IAAItC,KACXuC,OAAO,WAER7D,EAAO+B,OAAO+B,KAAK7D,EAASC,SAkChC,MAAO,CACL6D,KA3BF,SAAcC,GAEqB,IAA7BlE,EAAEG,EAASC,OAAO+D,SAGtBnE,EAAEG,EAASM,YAAY2D,IAAItC,KAAKC,UAAUrB,IAG1CV,EAAEG,EAASC,OAAOiE,KAAK,iBAAiBC,UACxCtC,IAGAhC,EAAE,QAAQuE,GAAG,SAAU,GAAGC,OAAOrE,EAASC,MAAO,KAAKoE,OAAOrE,EAASE,QAAS,WAC7E,IAAIM,EAASX,EAAEyD,MAAMW,MACrB1D,EAAOC,OAASA,EAChBX,EAAEG,EAASC,OAAOiE,KAAK,0CAA0CD,IAAIzD,GACrEqB,MAIFhC,EAAE,QAAQuE,GAAG,QAAS,GAAGC,OAAOrE,EAASC,MAAO,KAAKoE,OAAOrE,EAASI,QAAS,WAC5EO,EAAU2B,QAAQ,GAAGgC,OAAOzE,EAAEyD,MAAMW,OAAOM","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Certificate block.\n *\n * @package     local_edwiserreports\n * @copyright   2022 Wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-disable no-console */\ndefine('local_edwiserreports/blocks/certificatestats', [\n    'jquery',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/common',\n], function(\n    $,\n    CFG,\n    common\n) {\n\n    /**\n     * Selectors.\n     */\n    var SELECTOR = {\n        PANEL: '#certificatesblock',\n        COHORT: '.cohort-select',\n        TABLE: '#certificatesblock table',\n        SEARCH: '.table-search-input input',\n        USERS: '#certificatesblock table a.modal-trigger',\n        FORMFILTER: '#certificatesblock .download-links [name=\"filter\"]'\n    };\n\n    /**\n     * Filter.\n     */\n    var filter = {\n        cohort: 0,\n        dir: $('html').attr('dir')\n    };\n\n    /**\n     * Data table object.\n     */\n    var dataTable = null;\n\n    /**\n     * Promises list.\n     */\n    let PROMISE = {\n        /**\n         * Get timespent on site using filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n        GET_CERTIFICATES: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_certificates_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        }\n    };\n\n    /**\n     * Load data to dataTable using ajax.\n     */\n    function loadData() {\n        // Show loader.\n        common.loader.show(SELECTOR.PANEL);\n\n        PROMISE.GET_CERTIFICATES(filter).done(function(response) {\n                if (dataTable !== null) {\n                    dataTable.destroy();\n                }\n                dataTable = $(SELECTOR.TABLE).DataTable({\n                    responsive: true,\n                    data: response.data,\n                    dom: '<\"edwiserreports-table\"<t><\"table-pagination\"p>>',\n                    columns: [\n                        { \"data\": \"name\" },\n                        { \"data\": \"coursename\" },\n                        { \"data\": \"issued\" },\n                        { \"data\": \"notissued\" }\n                    ],\n                    columnDefs: [{\n                        \"targets\": [0, 1],\n                        \"className\": \"text-left\"\n                    }, {\n                        \"targets\": \"_all\",\n                        \"className\": \"text-center\",\n                    }],\n                    language: {\n                        info: M.util.get_string('tableinfo', 'local_edwiserreports'),\n                        infoEmpty: M.util.get_string('infoempty', 'local_edwiserreports'),\n                        emptyTable: M.util.get_string('nocertificates', 'local_edwiserreports'),\n                        zeroRecords: M.util.get_string('zerorecords', 'local_edwiserreports'),\n                        paginate: {\n                            previous: \" \",\n                            next: \" \"\n                        }\n                    },\n                    drawCallback: function() {\n                        common.stylePaginationButton(this);\n                    },\n                    lengthChange: false,\n                    bInfo: false\n                });\n            })\n            .fail(function(data) {\n                console.log(data);\n            })\n            .always(function() {\n                // Hide loader.\n                common.loader.hide(SELECTOR.PANEL);\n            });\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n\n        // Block not present on page.\n        if ($(SELECTOR.PANEL).length === 0) {\n            return;\n        }\n        $(SELECTOR.FORMFILTER).val(JSON.stringify(filter));\n\n        // Enable select2 on cohort filter.\n        $(SELECTOR.PANEL).find('.singleselect').select2();\n\n        loadData();\n\n        // On change of cohort filter.\n        $('body').on('change', `${SELECTOR.PANEL} ${SELECTOR.COHORT}`, function() {\n            let cohort = $(this).val();\n            filter.cohort = cohort;\n            $(SELECTOR.PANEL).find('.download-links input[name=\"cohortid\"]').val(cohort);\n            loadData();\n        });\n\n        // Search in table.\n        $('body').on('input', `${SELECTOR.PANEL} ${SELECTOR.SEARCH}`, function() {\n            dataTable.columns(0).search($(this).val()).draw();\n        });\n    }\n\n    // Must return the init function\n    return {\n        init: init\n    };\n});\n"],"file":"certificatestats.min.js"}
