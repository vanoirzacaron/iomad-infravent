"use strict";define("local_edwiserreports/blocks/timespentonsite",["jquery","local_edwiserreports/vendor/apexcharts","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/events"],function(e,t,a,i,r){var o="timespentonsiteblock",n={PANEL:"#timespentonsiteblock",INSIGHT:"#timespentonsiteblock .insight",FORMFILTER:'.download-links [name="filter"]',GRAPH:"#apex-chart-timespentonsite-block",STUDENT:"#timespentonsite-student-select"},s={GET_TIMESPENTONSITE:function(t){return e.ajax({url:i.requestUrl,type:i.requestType,dataType:i.requestDataType,data:{action:"get_timespentonsite_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:t})}})}},l={date:null,student:0,dir:e("html").attr("dir"),rtl:"rtl"==e("html").attr("dir")?1:0},d=null,c={series:[],chart:{id:"timespentonsite",type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},stroke:{curve:"smooth",width:2},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},dataLabels:{enabled:!1},colors:[i.getColorTheme()[2]],noData:{text:M.util.get_string("nographdata","local_edwiserreports")}};function p(e,i){null!==d&&d.destroy(),(d=new t(e.get(0),i)).render(),setTimeout(function(){a.loader.hide(n.PANEL)},1e3)}function h(t){a.loader.show(n.PANEL);var i=Object.keys(l).map(function(e){return l[e]}).join("-");e(n.PANEL).find(n.FORMFILTER).val(i),s.GET_TIMESPENTONSITE(l).done(function(t){var i=Object.assign({},c);i.series=[{name:M.util.get_string("timespentonsite","local_edwiserreports"),data:t.timespent}],i.yaxis={labels:{formatter:a.timeFormatter}},i.xaxis.categories=t.dates.map(function(e){return 864e5*e}),i.chart.toolbar.show=t.dates.length>29,i.chart.zoom.enabled=t.dates.length>29,i.tooltip.y.title.formatter=function(){return M.util.get_string("time","local_edwiserreports")+": "},t.insight.insight.value=a.timeFormatter(t.insight.insight.value,{dataPointIndex:0,short:!0},l.rtl).replaceAll(","," "),t.insight.details.data[0].value=a.timeFormatter(t.insight.details.data[0].value,{dataPointIndex:0},l.rtl),a.insight(n.INSIGHT,t.insight),p(e(n.PANEL).find(n.GRAPH),i)}).fail(function(e){a.loader.hide(n.PANEL)})}return{init:function(t,i){l.date=i,e(n.PANEL).length&&(h(),a.dateChange(function(e){l.date=e,h()}),e("body").on("change","".concat(n.PANEL," ").concat(n.STUDENT),function(){l.student=parseInt(e(this).val()),h()}),e(document).on(r.EXPORTGRAPHPDF+"-"+o,function(){var t=e(n.PANEL).find(".apexcharts-canvas");a.exportGraphPDF(d,l,t.width(),t.height())}),e(document).on(r.EXPORTGRAPHJPEG+"-"+o,function(){a.exportGraphJPEG(d,l)}),e(document).on(r.EXPORTGRAPHPNG+"-"+o,function(){a.exportGraphPNG(d,l)}),e(document).on(r.EXPORTGRAPHSVG+"-"+o,function(){a.exportGraphSVG(d,l)}),e(n.PANEL).find(".singleselect").select2())},download:function(t,i,r){var o=Object.assign({},c);switch(o.series=[{name:M.util.get_string("timespentonsite","local_edwiserreports"),data:r.timespent}],o.yaxis={labels:{formatter:a.timeFormatter}},o.xaxis.categories=r.dates.map(function(e){return 864e5*e}),o.chart.toolbar.show=!1,o.tooltip={enabled:!1},o.chart.animations={enabled:!1},p(e(n.PANEL).find(n.GRAPH),o),t){case"pdfimage":var s=e(n.PANEL).find(n.GRAPH);a.exportGraphPDF(d,l,s.width(),s.height(),i);break;case"jpeg":a.exportGraphJPEG(d,l,i);break;case"png":a.exportGraphPNG(d,l,i);break;case"svg":a.exportGraphSVG(d,l,i)}}}});
//# sourceMappingURL=timespentonsite.min.js.map
