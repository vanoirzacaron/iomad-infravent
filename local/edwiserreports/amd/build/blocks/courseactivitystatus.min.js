"use strict";define("local_edwiserreports/blocks/courseactivitystatus",["jquery","local_edwiserreports/vendor/apexcharts","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/events"],function(t,e,o,a,r){var s="courseactivitystatusblock",i={PANEL:"#courseactivitystatusblock",INSIGHT:"#courseactivitystatusblock .insight",FORMFILTER:'.download-links [name="filter"]',GRAPH:"#apex-chart-courseactivitystatus-block",COHORT:".cohort-select",COURSE:".course-select",GROUP:".group-select",STUDENT:".student-select"},n={GET_COURSEACTIVITYSTATUS:function(e){return t.ajax({url:a.requestUrl,type:a.requestType,dataType:a.requestDataType,data:{action:"get_courseactivitystatus_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:t("html").attr("lang"),data:JSON.stringify({filter:e})}})}},c={date:null,cohort:0,course:0,group:0,student:0},l=null,d={series:[],chart:{id:"courseactivitystatus",type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},stroke:{curve:"smooth",width:2},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},yaxis:{labels:{formatter:function(t,e){return void 0===t?t:t.toFixed(0)}}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},dataLabels:{enabled:!1},colors:a.getColorTheme(),noData:{text:M.util.get_string("nographdata","local_edwiserreports")}};function u(t,a){null!==l&&l.destroy(),(l=new e(t.get(0),a)).render(),setTimeout(function(){o.loader.hide(i.PANEL)},1e3)}function p(e){o.loader.show(i.PANEL),t(i.PANEL).find(i.FORMFILTER).val(JSON.stringify(c)),n.GET_COURSEACTIVITYSTATUS(c).done(function(e){var a=Object.assign({},d);a.series=[{name:M.util.get_string("courseactivitystatus-submissions","local_edwiserreports"),data:e.submissions},{name:M.util.get_string("courseactivitystatus-completions","local_edwiserreports"),data:e.completions}],a.xaxis.categories=e.dates.map(function(t){return 864e5*t}),a.chart.toolbar.show=e.dates.length>29,a.chart.zoom.enabled=e.dates.length>29,a.tooltip.y.title.formatter=null,o.insight(i.INSIGHT,e.insight),u(t(i.PANEL).find(i.GRAPH),a)}).fail(function(t){o.loader.hide(i.PANEL)})}function h(t){o.loader.show(i.PANEL),o.reloadFilter(i.PANEL,t,c.cohort,c.course,c.group,function(){p()})}return{init:function(e,a){c.date=a,t(i.PANEL).length&&(t(i.PANEL).find(".singleselect").select2(),o.handleFilterSize(i.PANEL),o.dateChange(function(t){c.date=t,p()}),t("body").on("change","".concat(i.PANEL," ").concat(i.COHORT),function(){c.cohort=parseInt(t(this).val()),c.course=0,c.group=0,c.student=0,h(["course","group","student"])}),t("body").on("change","".concat(i.PANEL," ").concat(i.COURSE),function(){c.course=parseInt(t(this).val()),c.group=0,c.student=0,h(["group","student"])}),t("body").on("change","".concat(i.PANEL," ").concat(i.GROUP),function(){c.group=parseInt(t(this).val()),c.student=0,h(["student"])}),t("body").on("change","".concat(i.PANEL," ").concat(i.STUDENT),function(){c.student=parseInt(t(this).val()),p()}),t(document).on(r.EXPORTGRAPHPDF+"-"+s,function(){var e=t(i.PANEL).find(".apexcharts-canvas");o.exportGraphPDF(l,c,e.width(),e.height())}),t(document).on(r.EXPORTGRAPHJPEG+"-"+s,function(){o.exportGraphJPEG(l,c)}),t(document).on(r.EXPORTGRAPHPNG+"-"+s,function(){o.exportGraphPNG(l,c)}),t(document).on(r.EXPORTGRAPHSVG+"-"+s,function(){o.exportGraphSVG(l,c)}),p())},download:function(e,a,r){var s=Object.assign({},d);switch(s.series=[{name:M.util.get_string("courseactivitystatus-submissions","local_edwiserreports"),data:r.submissions},{name:M.util.get_string("courseactivitystatus-completions","local_edwiserreports"),data:r.completions}],s.xaxis.categories=r.dates.map(function(t){return 864e5*t}),s.chart.toolbar.show=!1,s.tooltip={enabled:!1},s.chart.animations={enabled:!1},u(t(i.PANEL).find(i.GRAPH),s),e){case"pdfimage":var n=t(i.PANEL).find(i.GRAPH);o.exportGraphPDF(l,c,n.width(),n.height(),a);break;case"jpeg":o.exportGraphJPEG(l,c,a);break;case"png":o.exportGraphPNG(l,c,a);break;case"svg":o.exportGraphSVG(l,c,a)}}}});
//# sourceMappingURL=courseactivitystatus.min.js.map
