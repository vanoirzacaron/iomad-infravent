{"version":3,"sources":["blocks/grade.js"],"names":["define","$","ModalFactory","ModalEvents","Templates","ApexCharts","common","CFG","EdwiserReportsEvents","blockName","chart","filter","cohort","course","group","student","dir","attr","SELECTOR","PANEL","COHORT","COURSE","GROUP","STUDENT","GRAPH","GRAPHLABEL","FORMFILTER","FILTERS","position","ranges","pieChartDefault","plotOptions","pie","expandOnClick","id","type","height","events","fill","legend","formatter","seriesName","opts","w","globals","series","seriesIndex","colors","getColorTheme","dataLabels","enabled","noData","text","M","util","get_string","PROMISE","GET_GRAPH_DATA","ajax","url","requestUrl","requestType","dataType","requestDataType","data","action","secret","local_edwiserreports","lang","JSON","stringify","GET_TABLE_DATA","range","renderGraph","graph","destroy","get","render","setTimeout","loader","hide","loadGraph","show","find","val","done","response","Object","assign","labels","length","reverse","grades","header","responseTitle","tooltip","custom","_ref","dataPointIndex","value","single","plural","label","config","color","concat","updated","mounted","prepend","dataPointSelection","event","chartContext","title","rangeSplit","split","create","body","then","modal","modalRoot","getRoot","addClass","on","hidden","html","js","replaceNodeContents","getBody","fail","Notification","exception","insight","toPrecision","average","reloadFilter","types","init","invalidUser","select2","parseInt","this","document","EXPORTGRAPHPDF","graphElement","exportGraphPDF","width","EXPORTGRAPHJPEG","exportGraphJPEG","EXPORTGRAPHPNG","exportGraphPNG","EXPORTGRAPHSVG","exportGraphSVG","setInterval","newPosition","updateOptions","handleFilterSize","download","format","filename","animations"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Grade table js.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @author      Yogesh Shirsath\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine('local_edwiserreports/blocks/grade', [\n    'jquery',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'local_edwiserreports/vendor/apexcharts',\n    'local_edwiserreports/common',\n    'local_edwiserreports/defaultconfig',\n    'local_edwiserreports/events',\n    'local_edwiserreports/select2'\n], function(\n    $,\n    ModalFactory,\n    ModalEvents,\n    Templates,\n    ApexCharts,\n    common,\n    CFG,\n    EdwiserReportsEvents\n) {\n\n    let blockName = 'gradeblock';\n\n    /**\n     * Chart.\n     */\n    var chart = null;\n\n    /**\n     * Filter for ajax.\n     */\n    var filter = {\n        cohort: 0,\n        course: 0,\n        group: 0,\n        student: 0,\n        dir: $('html').attr('dir')\n    };\n\n    /**\n     * Selectors list.\n     */\n    var SELECTOR = {\n        PANEL: '#gradeblock',\n        COHORT: '.cohort-select',\n        COURSE: '.course-select',\n        GROUP: '.group-select',\n        STUDENT: '.student-select',\n        GRAPH: '.graph',\n        GRAPHLABEL: '.graph-label',\n        FORMFILTER: '.download-links [name=\"filter\"]',\n        FILTERS: '.filters'\n    };\n\n    /**\n     * Legend position.\n     */\n    var position = 'right';\n\n    /**\n     * Ranges\n     */\n    var ranges = [\"81to100\", \"61to80\", \"41to60\", \"21to40\", \"0to20\"];\n\n    /**\n     * Pie chart default config.\n     */\n    const pieChartDefault = {\n        plotOptions: {\n            pie: {\n                expandOnClick: false\n            }\n        },\n        chart: {\n            id: 'grade',\n            type: 'donut',\n            height: 350,\n            events: {}\n        },\n        fill: {\n            type: 'solid',\n        },\n        legend: {\n            position: position,\n            formatter: function(seriesName, opts) {\n                return [seriesName + \": \" + opts.w.globals.series[opts.seriesIndex]]\n            }\n        },\n        colors: CFG.getColorTheme(),\n        dataLabels: {\n            enabled: false\n        },\n        noData: {\n            text: M.util.get_string('nographdata', 'local_edwiserreports')\n        }\n    };\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get graph data using filters.\n         * @returns {PROMISE}\n         */\n        GET_GRAPH_DATA: function() {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_grade_graph_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        },\n\n        /**\n         * Get table data for popup modal based on filters and range\n         * @param   {string}  range Grade range\n         * @returns {PROMISE}\n         */\n        GET_TABLE_DATA: function(range) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_grade_modal_data',\n                    secret: M.local_edwiserreports.secret,\n                    lang: $('html').attr('lang'),\n                    data: JSON.stringify({\n                        filter: filter,\n                        range: range\n                    })\n                }\n            });\n        }\n    };\n\n    /**\n     * Create Grade Table.\n     * @param {string} range Grade range.\n     * @param {string} title Modal title.\n     */\n    function createGradeTable(range, title) {\n        let rangeSplit = ranges[range].split('to');\n        ModalFactory.create({\n            body: `<label class=\"text-center w-100 py-2\">\n                    <i class=\"fa fa-circle-o-notch fa-spin\"></i>\n                </label>`,\n            title: `${title} (${rangeSplit[0]}% - ${rangeSplit[1]}%)`\n        }).then(function(modal) {\n            let modalRoot = modal.getRoot();\n            modalRoot.find('.modal-dialog').addClass('modal-lg');\n            modal.show();\n            modalRoot.on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n\n            // Get data for modal table.\n            PROMISE.GET_TABLE_DATA(ranges[range])\n                .done(function(response) {\n                    Templates.render('local_edwiserreports/modal_table', response)\n                        .done(function(html, js) {\n                            Templates.replaceNodeContents(modal.getBody(), html, js);\n                        })\n                        .fail(Notification.exception);\n                });\n        }).fail(Notification.exception);\n    }\n\n    /**\n     * Render graph.\n     * @param {DOM} graph Graph element\n     * @param {Object} data Graph data\n     */\n    function renderGraph(graph, data) {\n        if (chart !== null) {\n            chart.destroy();\n        }\n        chart = new ApexCharts(graph.get(0), data);\n        chart.render();\n        setTimeout(function() {\n            common.loader.hide(SELECTOR.PANEL);\n        }, 1000);\n    }\n\n    /**\n     * Load graph\n     */\n    function loadGraph() {\n        let data;\n        common.loader.show(SELECTOR.PANEL);\n\n        // Set export filter to download link.\n        $(SELECTOR.PANEL).find(SELECTOR.FORMFILTER).val(JSON.stringify(filter));\n\n        PROMISE.GET_GRAPH_DATA()\n            .done(function(response) {\n                data = Object.assign({}, pieChartDefault);\n                data.legend.position = position;\n                if (response.labels.length != 0) {\n                    data.labels = response.labels.reverse();\n                    data.series = response.grades.reverse();\n                } else {\n                    data.labels = [];\n                    data.series = [];\n                }\n                $(SELECTOR.PANEL).find(SELECTOR.GRAPH).data(\n                    'responseTitle',\n                    M.util.get_string(response.header, 'local_edwiserreports')\n                );\n                data.responseTitle = M.util.get_string(response.header, 'local_edwiserreports');\n                data.tooltip = {\n                    custom: function({ series, seriesIndex, dataPointIndex, w }) {\n                        let value = series[seriesIndex];\n                        let tooltip = value < 2 ? response.tooltip.single : response.tooltip.plural;\n                        let label = w.config.labels[seriesIndex];\n                        let color = w.config.colors[seriesIndex];\n                        return `<div class=\"custom-donut-tooltip\" style=\"text-align:center\">\n                                <div style=\"color: ${color};\">\n                                    <span style=\"font-weight: 500;\"> ${label}:</span>\n                                    <span style=\"font-weight: 700;\"> ${value} ${M.util.get_string(tooltip, 'local_edwiserreports')}</span>\n                                </div>\n                                <span style=\"color: black; font-size: 0.871rem;\">${M.util.get_string('clickonchartformoreinfo', 'local_edwiserreports')}</span>\n                            </div>`;\n                    }\n                };\n                data.chart.events.updated = data.chart.events.mounted = function() {\n                    if (response.labels.length != 0) {\n                        $(SELECTOR.PANEL).find(SELECTOR.GRAPH).find('.apexcharts-legend')\n                            .prepend(`\n                                <label class=\"graph-label w-100 text-center\">\n                                    ${$(SELECTOR.PANEL).find(SELECTOR.GRAPH).data('responseTitle')}\n                                </label>\n                            `);\n                    }\n                };\n                data.chart.events.dataPointSelection = function(event, chartContext, config) {\n                    createGradeTable(config.dataPointIndex, $(SELECTOR.PANEL).find(SELECTOR.GRAPH).data('responseTitle'));\n                };\n                common.insight('#gradeblock .insight', {\n                    'insight': {\n                        'value': common.toPrecision(response.average, 2) + '%',\n                        'title': 'averagegrade'\n                    }\n                });\n                renderGraph($(SELECTOR.PANEL).find(SELECTOR.GRAPH), data);\n            });\n    }\n\n    /**\n     * Reload filters.\n     */\n    function reloadFilter(types) {\n        common.loader.show(SELECTOR.PANEL);\n        common.reloadFilter(\n            SELECTOR.PANEL,\n            types,\n            filter.cohort,\n            filter.course,\n            filter.group,\n            function() {\n                loadGraph();\n            });\n    }\n\n    /**\n     * Initialize event listeners.\n     */\n    function initEvents() {\n\n        // Cohort selector listener.\n        $('body').on('change', `${SELECTOR.PANEL} ${SELECTOR.COHORT}`, function() {\n            filter.cohort = parseInt($(this).val());\n            filter.course = 0;\n            filter.group = 0;\n            filter.student = 0;\n            reloadFilter(['course', 'group', 'student']);\n        });\n\n        // Course selector listener.\n        $('body').on('change', `${SELECTOR.PANEL} ${SELECTOR.COURSE}`, function() {\n            filter.course = parseInt($(this).val());\n            filter.group = 0;\n            filter.student = 0;\n            reloadFilter(['group', 'student']);\n\n        });\n\n        // Group selector listener.\n        $('body').on('change', `${SELECTOR.PANEL} ${SELECTOR.GROUP}`, function() {\n            filter.group = parseInt($(this).val());\n            filter.student = 0;\n            reloadFilter(['student']);\n        });\n\n        // Student selector listener.\n        $('body').on('change', `${SELECTOR.PANEL} ${SELECTOR.STUDENT}`, function() {\n            filter.student = parseInt($(this).val());\n            // Load graph data.\n            loadGraph();\n        });\n\n        // Export to PDF.\n        $(document).on(EdwiserReportsEvents.EXPORTGRAPHPDF + '-' + blockName, function() {\n            let graphElement = $(SELECTOR.PANEL).find(SELECTOR.GRAPH);\n            common.exportGraphPDF(chart, filter, graphElement.width(), graphElement.height());\n        });\n\n        // Export to JPEG.\n        $(document).on(EdwiserReportsEvents.EXPORTGRAPHJPEG + '-' + blockName, function() {\n            common.exportGraphJPEG(chart, filter);\n        });\n\n        // Export to PNG.\n        $(document).on(EdwiserReportsEvents.EXPORTGRAPHPNG + '-' + blockName, function() {\n            common.exportGraphPNG(chart, filter);\n        });\n\n        // Export to SVG.\n        $(document).on(EdwiserReportsEvents.EXPORTGRAPHSVG + '-' + blockName, function() {\n            common.exportGraphSVG(chart, filter);\n        });\n\n        // Handling legend position based on width.\n        setInterval(function() {\n            if (chart === null) {\n                return;\n            }\n            let width = $(SELECTOR.PANEL).find(SELECTOR.GRAPH).width();\n            var attr = $('html').attr('dir');\n            let newPosition = width >= 400 ? 'right' : 'bottom';\n            if (attr == 'rtl') {\n                newPosition = width >= 400 ? 'left' : 'bottom';\n            }\n            if (newPosition == position) {\n                return;\n            }\n            position = newPosition;\n            chart.updateOptions({\n                legend: {\n                    position: position\n                }\n            })\n        }, 1000);\n    }\n\n    /**\n     * Initialize\n     * @param {function} invalidUser Callback function\n     */\n    function init(invalidUser) {\n        if ($(SELECTOR.PANEL).length == 0) {\n            return;\n        }\n        $(SELECTOR.PANEL).find('.singleselect').select2();\n        initEvents();\n        common.handleFilterSize(SELECTOR.PANEL);\n        loadGraph();\n    }\n\n    /**\n     * Download grade block's graph in specified format.\n     *\n     * @param {String} format   Format of downloading file\n     * @param {String} filename Name of file\n     * @param {String} data     Exported data\n     */\n    function download(format, filename, response) {\n        data = Object.assign({}, pieChartDefault);\n        data.legend.position = position;\n        if (response.labels.length != 0) {\n            data.labels = response.labels.reverse();\n            data.series = response.grades.reverse();\n        } else {\n            data.labels = [];\n            data.series = [];\n        }\n        $(SELECTOR.PANEL).find(SELECTOR.GRAPH).data(\n            'responseTitle',\n            M.util.get_string(response.header, 'local_edwiserreports')\n        );\n        data.responseTitle = M.util.get_string(response.header, 'local_edwiserreports');\n        data.tooltip = {\n            enabled: false\n        };\n        data.chart.animations = {\n            enabled: false\n        };\n        data.chart.events = {\n            mounted: function() {\n                if (response.labels.length != 0) {\n                    $(SELECTOR.PANEL).find(SELECTOR.GRAPH).find('.apexcharts-legend')\n                        .prepend(`<label class=\"graph-label w-100 text-center font-weight-700\">${$(SELECTOR.PANEL).find(SELECTOR.GRAPH).data('responseTitle')}</label>`);\n                }\n            }\n        };\n        data.chart.events.updated = data.chart.events.mounted;\n        renderGraph($(SELECTOR.PANEL).find(SELECTOR.GRAPH), data);\n\n        switch (format) {\n            case 'pdfimage':\n                let graphElement = $(SELECTOR.PANEL).find(SELECTOR.GRAPH);\n                common.exportGraphPDF(chart, filter, graphElement.width(), graphElement.height(), filename);\n                break;\n            case 'jpeg':\n                common.exportGraphJPEG(chart, filter, filename);\n                break;\n            case 'png':\n                common.exportGraphPNG(chart, filter, filename);\n                break;\n            case 'svg':\n                common.exportGraphSVG(chart, filter, filename);\n                break;\n        }\n    }\n\n    return {\n        init: init,\n        download: download\n    };\n});\n"],"file":"grade.min.js"}
