"use strict";define("local_edwiserreports/blocks/courseengagement",["jquery","core/modal_factory","core/modal_events","core/fragment","local_edwiserreports/defaultconfig","local_edwiserreports/common"],function(e,t,a,o,n,r){var i={PANEL:"#courseengagementblock",COHORT:".cohort-select",TABLE:"#courseengagementblock table",SEARCH:".table-search-input input",FORMFILTER:'#courseengagementblock .download-links [name="filter"]',USERS:"#courseengagementblock table a.modal-trigger",MODALSEARCH:".courseengage-modal .table-search-input input"},l={cohort:0,dir:e("html").attr("dir")},s=null,c=null,d={GET_COURSEENGAGEMENT:function(t){return e.ajax({url:n.requestUrl,type:n.requestType,dataType:n.requestDataType,data:{action:"get_courseengagement_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:t})}})}};function u(){r.loader.show(i.PANEL),d.GET_COURSEENGAGEMENT(l).done(function(t){null!==s&&s.destroy(),s=e(i.TABLE).DataTable({data:t.data,dom:'<"edwiserreports-table"<t><"table-pagination"p>>',columnDefs:[{className:"fixed-column",targets:0},{className:"text-left",targets:[0,1]},{className:"text-right",targets:"_all"}],columns:[{data:"coursename",width:"15rem"},{data:"category",width:"17rem"},{data:"enrolment"},{data:"coursecompleted"},{data:"completionspercentage"},{data:"visited"},{data:"averagevisits"},{data:"timespent"},{data:"averagetimespent"}],info:!1,language:{infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nocourses","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},drawCallback:function(){r.stylePaginationButton(this)}})}).fail(function(e){console.log(e)}).always(function(){r.loader.hide(i.PANEL)})}return{init:function(n){l.dir=e("html").attr("dir"),e(i.FORMFILTER).val(JSON.stringify(l)),0!==e(i.PANEL).length&&(e(i.PANEL).find(".singleselect").select2(),u(),e("body").on("change","".concat(i.PANEL," ").concat(i.COHORT),function(){var t=e(this).val();l.cohort=t,e(i.PANEL).find('.download-links input[name="cohortid"]').val(t),u()}),e("body").on("input","".concat(i.PANEL," ").concat(i.SEARCH),function(){s.columns(0).search(e(this).val()).draw()}),e("body").on("input",i.MODALSEARCH,function(){c.search(this.value).draw()}),e(document).on("click",i.USERS,function(){var n=e(this).data("action"),l=e(this).data("courseid"),s=e(this).data("coursename"),d=e(i.PANEL).find(i.COHORT).length?e(i.PANEL).find(i.COHORT).val():0,u=null;t.create({body:o.loadFragment("local_edwiserreports","userslist",1,{page:"courseengage",courseid:l,action:n,cohortid:d})}).then(function(t){u=t.getRoot(),t.getBody().addClass("courseengage-modal"),u.find(".modal-dialog").addClass("modal-lg"),t.setTitle(s),t.show(),u.on(a.hidden,function(){t.destroy()}),u.on(a.shown,function(){e(window).resize()}),u.on(a.bodyRendered,function(){var e=u.find(".modal-table");e.find("tbody").hasClass("empty")&&e.find("tbody").empty(),c=e.DataTable({language:{info:M.util.get_string("tableinfo","local_edwiserreports"),infoEmpty:M.util.get_string("infoempty","local_edwiserreports"),emptyTable:M.util.get_string("nousers","local_edwiserreports"),zeroRecords:M.util.get_string("zerorecords","local_edwiserreports"),paginate:{previous:" ",next:" "}},dom:'<"edwiserreports-table"i<t><"table-pagination"p>>',drawCallback:function(){r.stylePaginationButton(this)},lengthChange:!1})})})}))}}});
//# sourceMappingURL=courseengagement.min.js.map
