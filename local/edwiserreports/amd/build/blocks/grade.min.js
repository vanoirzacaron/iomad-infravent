"use strict";define("local_edwiserreports/blocks/grade",["jquery","core/modal_factory","core/modal_events","core/templates","local_edwiserreports/vendor/apexcharts","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/events","local_edwiserreports/select2"],function(e,t,a,n,o,r,s,l){var i="gradeblock",c=null,d={cohort:0,course:0,group:0,student:0,dir:e("html").attr("dir")},p={PANEL:"#gradeblock",COHORT:".cohort-select",COURSE:".course-select",GROUP:".group-select",STUDENT:".student-select",GRAPH:".graph",GRAPHLABEL:".graph-label",FORMFILTER:'.download-links [name="filter"]',FILTERS:".filters"},g="right",u=["81to100","61to80","41to60","21to40","0to20"],h={plotOptions:{pie:{expandOnClick:!1}},chart:{id:"grade",type:"donut",height:350,events:{}},fill:{type:"solid"},legend:{position:g,formatter:function(e,t){return[e+": "+t.w.globals.series[t.seriesIndex]]}},colors:s.getColorTheme(),dataLabels:{enabled:!1},noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},f={GET_GRAPH_DATA:function(){return e.ajax({url:s.requestUrl,type:s.requestType,dataType:s.requestDataType,data:{action:"get_grade_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:d})}})},GET_TABLE_DATA:function(t){return e.ajax({url:s.requestUrl,type:s.requestType,dataType:s.requestDataType,data:{action:"get_grade_modal_data",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:d,range:t})}})}};function P(e,t){null!==c&&c.destroy(),(c=new o(e.get(0),t)).render(),setTimeout(function(){r.loader.hide(p.PANEL)},1e3)}function A(){var o;r.loader.show(p.PANEL),e(p.PANEL).find(p.FORMFILTER).val(JSON.stringify(d)),f.GET_GRAPH_DATA().done(function(s){(o=Object.assign({},h)).legend.position=g,0!=s.labels.length?(o.labels=s.labels.reverse(),o.series=s.grades.reverse()):(o.labels=[],o.series=[]),e(p.PANEL).find(p.GRAPH).data("responseTitle",M.util.get_string(s.header,"local_edwiserreports")),o.responseTitle=M.util.get_string(s.header,"local_edwiserreports"),o.tooltip={custom:function(e){var t=e.series,a=e.seriesIndex,n=(e.dataPointIndex,e.w),o=t[a],r=o<2?s.tooltip.single:s.tooltip.plural,l=n.config.labels[a],i=n.config.colors[a];return'<div class="custom-donut-tooltip" style="text-align:center">\n                                <div style="color: '.concat(i,';">\n                                    <span style="font-weight: 500;"> ').concat(l,':</span>\n                                    <span style="font-weight: 700;"> ').concat(o," ").concat(M.util.get_string(r,"local_edwiserreports"),'</span>\n                                </div>\n                                <span style="color: black; font-size: 0.871rem;">').concat(M.util.get_string("clickonchartformoreinfo","local_edwiserreports"),"</span>\n                            </div>")}},o.chart.events.updated=o.chart.events.mounted=function(){0!=s.labels.length&&e(p.PANEL).find(p.GRAPH).find(".apexcharts-legend").prepend('\n                                <label class="graph-label w-100 text-center">\n                                    '.concat(e(p.PANEL).find(p.GRAPH).data("responseTitle"),"\n                                </label>\n                            "))},o.chart.events.dataPointSelection=function(o,r,s){var l,i,c;l=s.dataPointIndex,i=e(p.PANEL).find(p.GRAPH).data("responseTitle"),c=u[l].split("to"),t.create({body:'<label class="text-center w-100 py-2">\n                    <i class="fa fa-circle-o-notch fa-spin"></i>\n                </label>',title:"".concat(i," (").concat(c[0],"% - ").concat(c[1],"%)")}).then(function(e){var t=e.getRoot();t.find(".modal-dialog").addClass("modal-lg"),e.show(),t.on(a.hidden,function(){e.destroy()}),f.GET_TABLE_DATA(u[l]).done(function(t){n.render("local_edwiserreports/modal_table",t).done(function(t,a){n.replaceNodeContents(e.getBody(),t,a)}).fail(Notification.exception)})}).fail(Notification.exception)},r.insight("#gradeblock .insight",{insight:{value:r.toPrecision(s.average,2)+"%",title:"averagegrade"}}),P(e(p.PANEL).find(p.GRAPH),o)})}function E(e){r.loader.show(p.PANEL),r.reloadFilter(p.PANEL,e,d.cohort,d.course,d.group,function(){A()})}return{init:function(t){0!=e(p.PANEL).length&&(e(p.PANEL).find(".singleselect").select2(),e("body").on("change","".concat(p.PANEL," ").concat(p.COHORT),function(){d.cohort=parseInt(e(this).val()),d.course=0,d.group=0,d.student=0,E(["course","group","student"])}),e("body").on("change","".concat(p.PANEL," ").concat(p.COURSE),function(){d.course=parseInt(e(this).val()),d.group=0,d.student=0,E(["group","student"])}),e("body").on("change","".concat(p.PANEL," ").concat(p.GROUP),function(){d.group=parseInt(e(this).val()),d.student=0,E(["student"])}),e("body").on("change","".concat(p.PANEL," ").concat(p.STUDENT),function(){d.student=parseInt(e(this).val()),A()}),e(document).on(l.EXPORTGRAPHPDF+"-"+i,function(){var t=e(p.PANEL).find(p.GRAPH);r.exportGraphPDF(c,d,t.width(),t.height())}),e(document).on(l.EXPORTGRAPHJPEG+"-"+i,function(){r.exportGraphJPEG(c,d)}),e(document).on(l.EXPORTGRAPHPNG+"-"+i,function(){r.exportGraphPNG(c,d)}),e(document).on(l.EXPORTGRAPHSVG+"-"+i,function(){r.exportGraphSVG(c,d)}),setInterval(function(){if(null!==c){var t=e(p.PANEL).find(p.GRAPH).width(),a=t>=400?"right":"bottom";"rtl"==e("html").attr("dir")&&(a=t>=400?"left":"bottom"),a!=g&&(g=a,c.updateOptions({legend:{position:g}}))}},1e3),r.handleFilterSize(p.PANEL),A())},download:function(t,a,n){switch(data=Object.assign({},h),data.legend.position=g,0!=n.labels.length?(data.labels=n.labels.reverse(),data.series=n.grades.reverse()):(data.labels=[],data.series=[]),e(p.PANEL).find(p.GRAPH).data("responseTitle",M.util.get_string(n.header,"local_edwiserreports")),data.responseTitle=M.util.get_string(n.header,"local_edwiserreports"),data.tooltip={enabled:!1},data.chart.animations={enabled:!1},data.chart.events={mounted:function(){0!=n.labels.length&&e(p.PANEL).find(p.GRAPH).find(".apexcharts-legend").prepend('<label class="graph-label w-100 text-center font-weight-700">'.concat(e(p.PANEL).find(p.GRAPH).data("responseTitle"),"</label>"))}},data.chart.events.updated=data.chart.events.mounted,P(e(p.PANEL).find(p.GRAPH),data),t){case"pdfimage":var o=e(p.PANEL).find(p.GRAPH);r.exportGraphPDF(c,d,o.width(),o.height(),a);break;case"jpeg":r.exportGraphJPEG(c,d,a);break;case"png":r.exportGraphPNG(c,d,a);break;case"svg":r.exportGraphSVG(c,d,a)}}}});
//# sourceMappingURL=grade.min.js.map
