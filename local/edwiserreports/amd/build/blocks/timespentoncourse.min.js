"use strict";define("local_edwiserreports/blocks/timespentoncourse",["jquery","local_edwiserreports/vendor/apexcharts","local_edwiserreports/common","local_edwiserreports/defaultconfig","local_edwiserreports/events"],function(e,t,o,r,a){var i="timespentoncourseblock",n={PANEL:"#timespentoncourseblock",INSIGHT:"#timespentoncourseblock .insight",FORMFILTER:'.download-links [name="filter"]',GRAPH:"#apex-chart-timespentoncourse-block",COHORT:".cohort-select",COURSE:".course-select",GROUP:".group-select",STUDENT:".student-select"},s={GET_TIMESPENTONCOURSE:function(t){return e.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_timespentoncourse_graph_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:JSON.stringify({filter:t})}})}},l={date:null,cohort:0,course:0,group:0,student:0,dir:e("html").attr("dir"),rtl:"rtl"==e("html").attr("dir")?1:0},c=null,d={series:[],chart:{id:"timespentoncourse",type:"line",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},markers:{size:0},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},stroke:{curve:"smooth",width:2},grid:{borderColor:"#e7e7e7"},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,rotate:-45,minHeight:100,maxHeight:180,rotateAlways:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},dataLabels:{enabled:!1},colors:[r.getColorTheme()[2]],noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},h={series:[],chart:{id:"timespentoncourse",type:"bar",height:350,toolbar:{show:!0,tools:{download:!1,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:'<i class="fa fa-refresh"></i>'}}},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},marker:{show:!0},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},plotOptions:{bar:{columnWidth:"50%"}},grid:{borderColor:"#e7e7e7"},dataLabels:{enabled:!1},xaxis:{categories:null,labels:{hideOverlappingLabels:!0,rotate:-45,minHeight:100,maxHeight:180,rotateAlways:!0,trim:!0},tickPlacement:"on"},legend:{position:"top",horizontalAlign:"left",offsetY:"-20",itemMargin:{horizontal:10,vertical:0}},colors:[r.getColorTheme()[2]],noData:{text:M.util.get_string("nographdata","local_edwiserreports")}};function p(e,r){null!==c&&c.destroy(),(c=new t(e.get(0),r)).render(),setTimeout(function(){o.loader.hide(n.PANEL)},1e3)}function u(t){o.loader.show(n.PANEL),e(n.PANEL).find(n.FORMFILTER).val(JSON.stringify(l)),s.GET_TIMESPENTONCOURSE(l).done(function(t){var r;0==l.course?(r=Object.assign({},h)).xaxis.categories=t.labels:(r=Object.assign({},d)).xaxis.categories=t.dates.map(function(e){return 864e5*e}),r.series=[{name:M.util.get_string("timespentoncourse","local_edwiserreports"),data:t.timespent}],r.yaxis={labels:{formatter:o.timeFormatter}},r.chart.toolbar.show=t.labels.length>29,r.chart.zoom={enabled:t.labels.length>29},r.tooltip.y.title.formatter=function(){return M.util.get_string("time","local_edwiserreports")+": "},t.insight.insight.value=o.timeFormatter(t.insight.insight.value,{dataPointIndex:0,short:!0},l.rtl).replaceAll(","," "),t.insight.details.data[0].value=o.timeFormatter(t.insight.details.data[0].value,{dataPointIndex:0},l.rtl),o.insight(n.INSIGHT,t.insight),p(e(n.PANEL).find(n.GRAPH),r)}).fail(function(e){o.loader.hide(n.PANEL)})}function g(e){o.loader.show(n.PANEL),o.reloadFilter(n.PANEL,e,l.cohort,l.course,l.group,function(){u()})}return{init:function(t,r){l.date=r,e(n.PANEL).length&&(e(n.PANEL).find(".singleselect").select2(),o.dateChange(function(e){l.date=e,u()}),e("body").on("change","".concat(n.PANEL," ").concat(n.COHORT),function(){l.cohort=parseInt(e(this).val()),l.course=0,l.group=0,l.student=0,g(["course","group","student"])}),e("body").on("change","".concat(n.PANEL," ").concat(n.COURSE),function(){l.course=parseInt(e(this).val()),l.group=0,l.student=0,g(["group","student"])}),e("body").on("change","".concat(n.PANEL," ").concat(n.GROUP),function(){l.group=parseInt(e(this).val()),l.student=0,g(["student"])}),e("body").on("change","".concat(n.PANEL," ").concat(n.STUDENT),function(){l.student=parseInt(e(this).val()),u()}),e(document).on(a.EXPORTGRAPHPDF+"-"+i,function(){var t=e(n.PANEL).find(".apexcharts-canvas");o.exportGraphPDF(c,l,t.width(),t.height())}),e(document).on(a.EXPORTGRAPHJPEG+"-"+i,function(){o.exportGraphJPEG(c,l)}),e(document).on(a.EXPORTGRAPHPNG+"-"+i,function(){o.exportGraphPNG(c,l)}),e(document).on(a.EXPORTGRAPHSVG+"-"+i,function(){o.exportGraphSVG(c,l)}),o.handleFilterSize(n.PANEL),u())},download:function(t,r,a){var i;switch(void 0===a.dates?(i=Object.assign({},h)).xaxis.categories=a.labels:(i=Object.assign({},d)).xaxis.categories=a.dates.map(function(e){return 864e5*e}),i.series=[{name:M.util.get_string("timespentoncourse","local_edwiserreports"),data:a.timespent}],i.yaxis={labels:{formatter:o.timeFormatter}},i.chart.toolbar.show=!1,i.tooltip={enabled:!1},i.chart.animations={enabled:!1},p(e(n.PANEL).find(n.GRAPH),i),t){case"pdfimage":var s=e(n.PANEL).find(n.GRAPH);o.exportGraphPDF(c,l,s.width(),s.height(),r);break;case"jpeg":o.exportGraphJPEG(c,l,r);break;case"png":o.exportGraphPNG(c,l,r);break;case"svg":o.exportGraphSVG(c,l,r)}}}});
//# sourceMappingURL=timespentoncourse.min.js.map
