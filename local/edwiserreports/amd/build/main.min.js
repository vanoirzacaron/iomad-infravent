"use strict";define(["jquery","core/modal_factory","core/notification","./events","./common","./email","./defaultconfig","./insights","./modal-migration","./blocks/siteaccess","./blocks/activecourses","./blocks/activeusers","./blocks/courseprogress","./blocks/inactiveusers","./blocks/realtimeusers","./blocks/todaysactivity","./blocks/grade","./blocks/visitsonsite","./blocks/timespentonsite","./blocks/timespentoncourse","./blocks/courseactivitystatus","./blocks/learnercourseprogress","./blocks/learnertimespentonsite","./blocks/courseengagement","./blocks/certificatestats"],function(e,t,a,r,o,n,i,s,c,l,d,E,u,T,p,m,D,g,A,f,h,w,v,I,P){var _={ROOT:"#wdm-edwiserreports",EXPORT:"#wdm-edwiserreports .export-options",DATESELECTED:".selected-period",DATE:".edwiserreports-header .edwiserreports-calendar",DATEMENU:".edwiserreports-header .edwiserreports-calendar + .dropdown-menu",DATEITEM:".edwiserreports-header .edwiserreports-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".edwiserreports-header .edwiserreports-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".edwiserreports-header .edwiserreports-calendar + .dropdown-menu .flatpickr"},b={GET_TIMEPERIOD_LABEL:function(t){return e.ajax({url:i.requestUrl,type:i.requestType,dataType:i.requestDataType,data:{action:"get_timeperiod_label_data_ajax",secret:M.local_edwiserreports.secret,lang:e("html").attr("lang"),data:t}})},GET_EXPORT_DATA_FOR_GRAPH:function(t){return e.ajax({url:i.requestUrl,type:i.requestType,dataType:i.requestDataType,data:{action:"get_export_data_for_graph",lang:e("html").attr("lang"),download:t}})}},k=[l,d,E,u,T,p,m,D,g,A,f,h,w,v,I,P],C=null;function R(t,a){e("#".concat(t," .panel-body")).html(a.exception.message)}function y(t){b.GET_TIMEPERIOD_LABEL(t).done(function(t){var a=new Date(864e5*t.startdate),r=new Date(864e5*t.enddate),o=a.getDate();o=o<10?"0"+o:o;var n=r.getDate();n=n<10?"0"+n:n;var i="".concat(o," ").concat(a.toLocaleString("default",{month:"long"})," ").concat(a.getFullYear())+" - "+"".concat(n," ").concat(r.toLocaleString("default",{month:"long"})," ").concat(r.getFullYear());"rtl"==e("html").attr("dir")&&(a=a.getFullYear()+" "+a.toLocaleString("default",{month:"long"})+" "+o,i=(r=r.getFullYear()+" "+r.toLocaleString("default",{month:"long"})+" "+n)+"-"+a,e(_.DATE).css({direction:"ltr","text-align":"right"}),e(_.DATEPICKERINPUT).css({direction:"ltr","text-align":"right"})),e(_.DATESELECTED).html(i)}).fail(function(e){a.exception(e)})}function x(e,t){var a=new CustomEvent(r.DATECHANGE,{detail:{date:e}});document.dispatchEvent(a),y(e)}return{init:function(){e(document).ready(function(){n.init(),s.init();var t=e(_.DATEITEM+".active").data("value");y(t,e(_.DATEITEM+".active").text()),o.handleSearchInput(),k.forEach(function(e){e.init(R,t)}),C=e(_.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d M Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(_.DATEPICKER).get(0),onOpen:function(){e(_.DATEMENU).addClass("withcalendar"),e(_.DATE).dropdown("update")},onClose:function(){e(_.DATEMENU).removeClass("withcalendar"),function(){var t=e(_.DATEPICKERINPUT).val(),a=e(_.DATEPICKERINPUT).next().val().replace("to","-"),r=e("html").attr("dir"),o=a.split("-");if("rtl"==r){var n=o[0].split(" "),i=o[1].split(" ");n=n[2]+" "+n[1]+" "+n[0],a=(i=i[3]+" "+i[2]+" "+i[1])+"-"+n,e(_.DATE).css({direction:"ltr","text-align":"right"}),e(_.DATEPICKERINPUT).css({direction:"ltr","text-align":"right"})}e(_.DATEPICKERINPUT).next().val(e.trim(a)),t.includes(" to ")?(e(_.DATEITEM).removeClass("active"),e(_.DATEITEM+".custom").addClass("active"),e(_.DATE).html(a),x(t)):C.clear()}()}}),e("body").on("click",_.DATEITEM+":not(.custom)",function(){e(_.DATEITEM).removeClass("active"),e(this).addClass("active"),e(_.DATE).html(e(this).text()),C.clear(),x(e(this).data("value"),e(this).text())}),o.exportDropdownHandler(_.EXPORT)})},initMigration:function(){t.create({type:c.TYPE},e("#create"))},download:function(t,a,r,o){e(document).ready(function(){require(["local_edwiserreports/blocks/"+a],function(e){b.GET_EXPORT_DATA_FOR_GRAPH(t).done(function(t){e.download(r,o,t)})})})}}});
//# sourceMappingURL=main.min.js.map
